{"version":3,"sources":["meteor://ğŸ’»app/imports/api/annotations/server/handlers/whiteboardAnnotations.js","meteor://ğŸ’»app/imports/api/annotations/server/handlers/whiteboardCleared.js","meteor://ğŸ’»app/imports/api/annotations/server/handlers/whiteboardSend.js","meteor://ğŸ’»app/imports/api/annotations/server/handlers/whiteboardUndo.js","meteor://ğŸ’»app/imports/api/annotations/server/methods/clearWhiteboard.js","meteor://ğŸ’»app/imports/api/annotations/server/methods/sendAnnotation.js","meteor://ğŸ’»app/imports/api/annotations/server/methods/sendAnnotationHelper.js","meteor://ğŸ’»app/imports/api/annotations/server/methods/sendBulkAnnotations.js","meteor://ğŸ’»app/imports/api/annotations/server/methods/undoAnnotation.js","meteor://ğŸ’»app/imports/api/annotations/server/modifiers/addAnnotation.js","meteor://ğŸ’»app/imports/api/annotations/server/modifiers/clearAnnotations.js","meteor://ğŸ’»app/imports/api/annotations/server/modifiers/removeAnnotation.js","meteor://ğŸ’»app/imports/api/annotations/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/annotations/server/index.js","meteor://ğŸ’»app/imports/api/annotations/server/methods.js","meteor://ğŸ’»app/imports/api/annotations/server/publishers.js","meteor://ğŸ’»app/imports/api/annotations/server/streamer.js","meteor://ğŸ’»app/imports/api/annotations/addAnnotation.js","meteor://ğŸ’»app/imports/api/annotations/index.js","meteor://ğŸ’»app/imports/api/breakouts/server/handlers/breakoutClosed.js","meteor://ğŸ’»app/imports/api/breakouts/server/handlers/breakoutJoinURL.js","meteor://ğŸ’»app/imports/api/breakouts/server/handlers/breakoutStarted.js","meteor://ğŸ’»app/imports/api/breakouts/server/handlers/joinedUsersChanged.js","meteor://ğŸ’»app/imports/api/breakouts/server/handlers/updateTimeRemaining.js","meteor://ğŸ’»app/imports/api/breakouts/server/methods/createBreakout.js","meteor://ğŸ’»app/imports/api/breakouts/server/methods/endAllBreakouts.js","meteor://ğŸ’»app/imports/api/breakouts/server/methods/requestJoinURL.js","meteor://ğŸ’»app/imports/api/breakouts/server/modifiers/clearBreakouts.js","meteor://ğŸ’»app/imports/api/breakouts/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/breakouts/server/index.js","meteor://ğŸ’»app/imports/api/breakouts/server/methods.js","meteor://ğŸ’»app/imports/api/breakouts/server/publishers.js","meteor://ğŸ’»app/imports/api/breakouts/index.js","meteor://ğŸ’»app/imports/api/captions/server/handlers/padCreate.js","meteor://ğŸ’»app/imports/api/captions/server/handlers/padUpdate.js","meteor://ğŸ’»app/imports/api/captions/server/methods/addCaptionsPads.js","meteor://ğŸ’»app/imports/api/captions/server/methods/addPad.js","meteor://ğŸ’»app/imports/api/captions/server/methods/appendText.js","meteor://ğŸ’»app/imports/api/captions/server/methods/createCaptions.js","meteor://ğŸ’»app/imports/api/captions/server/methods/editCaptions.js","meteor://ğŸ’»app/imports/api/captions/server/methods/fetchReadOnlyPadId.js","meteor://ğŸ’»app/imports/api/captions/server/methods/takeOwnership.js","meteor://ğŸ’»app/imports/api/captions/server/methods/updateOwner.js","meteor://ğŸ’»app/imports/api/captions/server/modifiers/addCaption.js","meteor://ğŸ’»app/imports/api/captions/server/modifiers/clearCaptions.js","meteor://ğŸ’»app/imports/api/captions/server/modifiers/updateOwnerId.js","meteor://ğŸ’»app/imports/api/captions/server/modifiers/updatePad.js","meteor://ğŸ’»app/imports/api/captions/server/modifiers/updateReadOnlyPadId.js","meteor://ğŸ’»app/imports/api/captions/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/captions/server/helpers.js","meteor://ğŸ’»app/imports/api/captions/server/index.js","meteor://ğŸ’»app/imports/api/captions/server/methods.js","meteor://ğŸ’»app/imports/api/captions/server/publishers.js","meteor://ğŸ’»app/imports/api/captions/index.js","meteor://ğŸ’»app/imports/api/cursor/server/handlers/cursorUpdate.js","meteor://ğŸ’»app/imports/api/cursor/server/methods/publishCursorUpdate.js","meteor://ğŸ’»app/imports/api/cursor/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/cursor/server/index.js","meteor://ğŸ’»app/imports/api/cursor/server/methods.js","meteor://ğŸ’»app/imports/api/cursor/server/streamer.js","meteor://ğŸ’»app/imports/api/external-videos/server/methods/destroyExternalVideo.js","meteor://ğŸ’»app/imports/api/external-videos/server/methods/emitExternalVideoEvent.js","meteor://ğŸ’»app/imports/api/external-videos/server/methods/initializeExternalVideo.js","meteor://ğŸ’»app/imports/api/external-videos/server/methods/startWatchingExternalVideo.js","meteor://ğŸ’»app/imports/api/external-videos/server/methods/stopWatchingExternalVideo.js","meteor://ğŸ’»app/imports/api/external-videos/server/index.js","meteor://ğŸ’»app/imports/api/external-videos/server/methods.js","meteor://ğŸ’»app/imports/api/group-chat/server/handlers/groupChatCreated.js","meteor://ğŸ’»app/imports/api/group-chat/server/handlers/groupChatDestroyed.js","meteor://ğŸ’»app/imports/api/group-chat/server/handlers/groupChats.js","meteor://ğŸ’»app/imports/api/group-chat/server/methods/createGroupChat.js","meteor://ğŸ’»app/imports/api/group-chat/server/methods/destroyGroupChat.js","meteor://ğŸ’»app/imports/api/group-chat/server/modifiers/addGroupChat.js","meteor://ğŸ’»app/imports/api/group-chat/server/modifiers/clearGroupChat.js","meteor://ğŸ’»app/imports/api/group-chat/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/group-chat/server/index.js","meteor://ğŸ’»app/imports/api/group-chat/server/methods.js","meteor://ğŸ’»app/imports/api/group-chat/server/publishers.js","meteor://ğŸ’»app/imports/api/group-chat/index.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/handlers/clearPublicGroupChat.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/handlers/groupChatMsgBroadcast.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/handlers/syncGroupsChat.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/handlers/userTyping.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/methods/clearPublicChatHistory.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/methods/sendGroupChatMsg.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/methods/startUserTyping.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/methods/stopUserTyping.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/modifiers/addBulkGroupChatMsgs.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/modifiers/addGroupChatMsg.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/modifiers/clearGroupChatMsg.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/modifiers/startTyping.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/modifiers/stopTyping.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/modifiers/syncMeetingChatMsgs.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/index.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/methods.js","meteor://ğŸ’»app/imports/api/group-chat-msg/server/publishers.js","meteor://ğŸ’»app/imports/api/group-chat-msg/index.js","meteor://ğŸ’»app/imports/api/guest-users/server/handlers/guestApproved.js","meteor://ğŸ’»app/imports/api/guest-users/server/handlers/guestsWaitingForApproval.js","meteor://ğŸ’»app/imports/api/guest-users/server/methods/allowPendingUsers.js","meteor://ğŸ’»app/imports/api/guest-users/server/methods/changeGuestPolicy.js","meteor://ğŸ’»app/imports/api/guest-users/server/modifiers/clearGuestUsers.js","meteor://ğŸ’»app/imports/api/guest-users/server/modifiers/setGuestStatus.js","meteor://ğŸ’»app/imports/api/guest-users/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/guest-users/server/index.js","meteor://ğŸ’»app/imports/api/guest-users/server/methods.js","meteor://ğŸ’»app/imports/api/guest-users/server/publishers.js","meteor://ğŸ’»app/imports/api/guest-users/index.js","meteor://ğŸ’»app/imports/api/local-settings/server/methods/userChangedLocalSettings.js","meteor://ğŸ’»app/imports/api/local-settings/server/modifiers/clearLocalSettings.js","meteor://ğŸ’»app/imports/api/local-settings/server/modifiers/setChangedLocalSettings.js","meteor://ğŸ’»app/imports/api/local-settings/server/index.js","meteor://ğŸ’»app/imports/api/local-settings/server/methods.js","meteor://ğŸ’»app/imports/api/local-settings/server/publishers.js","meteor://ğŸ’»app/imports/api/local-settings/index.js","meteor://ğŸ’»app/imports/api/log-client/server/methods/logClient.js","meteor://ğŸ’»app/imports/api/log-client/server/index.js","meteor://ğŸ’»app/imports/api/log-client/server/methods.js","meteor://ğŸ’»app/imports/api/meetings/server/handlers/getAllMeetings.js","meteor://ğŸ’»app/imports/api/meetings/server/handlers/meetingCreation.js","meteor://ğŸ’»app/imports/api/meetings/server/handlers/meetingDestruction.js","meteor://ğŸ’»app/imports/api/meetings/server/handlers/meetingEnd.js","meteor://ğŸ’»app/imports/api/meetings/server/handlers/meetingLockChange.js","meteor://ğŸ’»app/imports/api/meetings/server/handlers/recordingStatusChange.js","meteor://ğŸ’»app/imports/api/meetings/server/handlers/recordingTimerChange.js","meteor://ğŸ’»app/imports/api/meetings/server/handlers/timeRemainingUpdate.js","meteor://ğŸ’»app/imports/api/meetings/server/handlers/userLockChange.js","meteor://ğŸ’»app/imports/api/meetings/server/handlers/webcamOnlyModerator.js","meteor://ğŸ’»app/imports/api/meetings/server/methods/endMeeting.js","meteor://ğŸ’»app/imports/api/meetings/server/methods/toggleLockSettings.js","meteor://ğŸ’»app/imports/api/meetings/server/methods/toggleRecording.js","meteor://ğŸ’»app/imports/api/meetings/server/methods/toggleWebcamsOnlyForModerator.js","meteor://ğŸ’»app/imports/api/meetings/server/methods/transferUser.js","meteor://ğŸ’»app/imports/api/meetings/server/modifiers/addMeeting.js","meteor://ğŸ’»app/imports/api/meetings/server/modifiers/changeLockSettings.js","meteor://ğŸ’»app/imports/api/meetings/server/modifiers/changeUserLock.js","meteor://ğŸ’»app/imports/api/meetings/server/modifiers/clearMeetingTimeRemaining.js","meteor://ğŸ’»app/imports/api/meetings/server/modifiers/clearRecordMeeting.js","meteor://ğŸ’»app/imports/api/meetings/server/modifiers/meetingHasEnded.js","meteor://ğŸ’»app/imports/api/meetings/server/modifiers/setPublishedPoll.js","meteor://ğŸ’»app/imports/api/meetings/server/modifiers/webcamOnlyModerator.js","meteor://ğŸ’»app/imports/api/meetings/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/meetings/server/index.js","meteor://ğŸ’»app/imports/api/meetings/server/methods.js","meteor://ğŸ’»app/imports/api/meetings/server/publishers.js","meteor://ğŸ’»app/imports/api/meetings/index.js","meteor://ğŸ’»app/imports/api/network-information/server/methods/userInstabilityDetected.js","meteor://ğŸ’»app/imports/api/network-information/server/modifiers/clearNetworkInformation.js","meteor://ğŸ’»app/imports/api/network-information/server/index.js","meteor://ğŸ’»app/imports/api/network-information/server/methods.js","meteor://ğŸ’»app/imports/api/network-information/server/publisher.js","meteor://ğŸ’»app/imports/api/network-information/index.js","meteor://ğŸ’»app/imports/api/note/server/handlers/padUpdate.js","meteor://ğŸ’»app/imports/api/note/server/methods/addPad.js","meteor://ğŸ’»app/imports/api/note/server/methods/createNote.js","meteor://ğŸ’»app/imports/api/note/server/modifiers/addNote.js","meteor://ğŸ’»app/imports/api/note/server/modifiers/clearNote.js","meteor://ğŸ’»app/imports/api/note/server/modifiers/updateNote.js","meteor://ğŸ’»app/imports/api/note/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/note/server/helpers.js","meteor://ğŸ’»app/imports/api/note/server/index.js","meteor://ğŸ’»app/imports/api/note/server/publishers.js","meteor://ğŸ’»app/imports/api/note/index.js","meteor://ğŸ’»app/imports/api/ping-pong/server/methods/ping.js","meteor://ğŸ’»app/imports/api/ping-pong/server/index.js","meteor://ğŸ’»app/imports/api/ping-pong/server/methods.js","meteor://ğŸ’»app/imports/api/ping-pong/server/publishers.js","meteor://ğŸ’»app/imports/api/polls/server/handlers/pollPublished.js","meteor://ğŸ’»app/imports/api/polls/server/handlers/pollStarted.js","meteor://ğŸ’»app/imports/api/polls/server/handlers/pollStopped.js","meteor://ğŸ’»app/imports/api/polls/server/handlers/userResponded.js","meteor://ğŸ’»app/imports/api/polls/server/handlers/userVoted.js","meteor://ğŸ’»app/imports/api/polls/server/methods/publishPoll.js","meteor://ğŸ’»app/imports/api/polls/server/methods/publishVote.js","meteor://ğŸ’»app/imports/api/polls/server/methods/startPoll.js","meteor://ğŸ’»app/imports/api/polls/server/methods/stopPoll.js","meteor://ğŸ’»app/imports/api/polls/server/modifiers/addPoll.js","meteor://ğŸ’»app/imports/api/polls/server/modifiers/clearPolls.js","meteor://ğŸ’»app/imports/api/polls/server/modifiers/removePoll.js","meteor://ğŸ’»app/imports/api/polls/server/modifiers/updateVotes.js","meteor://ğŸ’»app/imports/api/polls/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/polls/server/index.js","meteor://ğŸ’»app/imports/api/polls/server/methods.js","meteor://ğŸ’»app/imports/api/polls/server/publishers.js","meteor://ğŸ’»app/imports/api/polls/index.js","meteor://ğŸ’»app/imports/api/presentation-pods/server/handlers/createNewPresentationPod.js","meteor://ğŸ’»app/imports/api/presentation-pods/server/handlers/removePresentationPod.js","meteor://ğŸ’»app/imports/api/presentation-pods/server/handlers/setPresenterInPod.js","meteor://ğŸ’»app/imports/api/presentation-pods/server/handlers/syncGetPresentationPods.js","meteor://ğŸ’»app/imports/api/presentation-pods/server/modifiers/addPresentationPod.js","meteor://ğŸ’»app/imports/api/presentation-pods/server/modifiers/clearPresentationPods.js","meteor://ğŸ’»app/imports/api/presentation-pods/server/modifiers/removePresentationPod.js","meteor://ğŸ’»app/imports/api/presentation-pods/server/modifiers/setPresenterInPod.js","meteor://ğŸ’»app/imports/api/presentation-pods/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/presentation-pods/server/index.js","meteor://ğŸ’»app/imports/api/presentation-pods/server/publishers.js","meteor://ğŸ’»app/imports/api/presentation-pods/index.js","meteor://ğŸ’»app/imports/api/presentation-upload-token/server/handlers/presentationUploadTokenFail.js","meteor://ğŸ’»app/imports/api/presentation-upload-token/server/handlers/presentationUploadTokenPass.js","meteor://ğŸ’»app/imports/api/presentation-upload-token/server/methods/requestPresentationUploadToken.js","meteor://ğŸ’»app/imports/api/presentation-upload-token/server/methods/setUsedToken.js","meteor://ğŸ’»app/imports/api/presentation-upload-token/server/modifiers/clearPresentationUploadToken.js","meteor://ğŸ’»app/imports/api/presentation-upload-token/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/presentation-upload-token/server/index.js","meteor://ğŸ’»app/imports/api/presentation-upload-token/server/methods.js","meteor://ğŸ’»app/imports/api/presentation-upload-token/server/publishers.js","meteor://ğŸ’»app/imports/api/presentation-upload-token/index.js","meteor://ğŸ’»app/imports/api/presentations/server/handlers/presentationAdded.js","meteor://ğŸ’»app/imports/api/presentations/server/handlers/presentationConversionUpdate.js","meteor://ğŸ’»app/imports/api/presentations/server/handlers/presentationCurrentSet.js","meteor://ğŸ’»app/imports/api/presentations/server/handlers/presentationDownloadableSet.js","meteor://ğŸ’»app/imports/api/presentations/server/handlers/presentationRemove.js","meteor://ğŸ’»app/imports/api/presentations/server/methods/removePresentation.js","meteor://ğŸ’»app/imports/api/presentations/server/methods/setPresentation.js","meteor://ğŸ’»app/imports/api/presentations/server/methods/setPresentationDownloadable.js","meteor://ğŸ’»app/imports/api/presentations/server/modifiers/addPresentation.js","meteor://ğŸ’»app/imports/api/presentations/server/modifiers/clearPresentations.js","meteor://ğŸ’»app/imports/api/presentations/server/modifiers/removePresentation.js","meteor://ğŸ’»app/imports/api/presentations/server/modifiers/setCurrentPresentation.js","meteor://ğŸ’»app/imports/api/presentations/server/modifiers/setPresentationDownloadable.js","meteor://ğŸ’»app/imports/api/presentations/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/presentations/server/index.js","meteor://ğŸ’»app/imports/api/presentations/server/methods.js","meteor://ğŸ’»app/imports/api/presentations/server/publishers.js","meteor://ğŸ’»app/imports/api/presentations/index.js","meteor://ğŸ’»app/imports/api/screenshare/server/handlers/screenshareStarted.js","meteor://ğŸ’»app/imports/api/screenshare/server/handlers/screenshareStopped.js","meteor://ğŸ’»app/imports/api/screenshare/server/modifiers/addScreenshare.js","meteor://ğŸ’»app/imports/api/screenshare/server/modifiers/clearScreenshare.js","meteor://ğŸ’»app/imports/api/screenshare/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/screenshare/server/index.js","meteor://ğŸ’»app/imports/api/screenshare/server/methods.js","meteor://ğŸ’»app/imports/api/screenshare/server/publishers.js","meteor://ğŸ’»app/imports/api/screenshare/index.js","meteor://ğŸ’»app/imports/api/slides/server/handlers/slideChange.js","meteor://ğŸ’»app/imports/api/slides/server/handlers/slideResize.js","meteor://ğŸ’»app/imports/api/slides/server/methods/switchSlide.js","meteor://ğŸ’»app/imports/api/slides/server/methods/zoomSlide.js","meteor://ğŸ’»app/imports/api/slides/server/modifiers/addSlide.js","meteor://ğŸ’»app/imports/api/slides/server/modifiers/addSlidePositions.js","meteor://ğŸ’»app/imports/api/slides/server/modifiers/changeCurrentSlide.js","meteor://ğŸ’»app/imports/api/slides/server/modifiers/clearSlides.js","meteor://ğŸ’»app/imports/api/slides/server/modifiers/clearSlidesPresentation.js","meteor://ğŸ’»app/imports/api/slides/server/modifiers/resizeSlide.js","meteor://ğŸ’»app/imports/api/slides/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/slides/server/helpers.js","meteor://ğŸ’»app/imports/api/slides/server/index.js","meteor://ğŸ’»app/imports/api/slides/server/methods.js","meteor://ğŸ’»app/imports/api/slides/server/publishers.js","meteor://ğŸ’»app/imports/api/slides/index.js","meteor://ğŸ’»app/imports/api/users/server/handlers/changeRole.js","meteor://ğŸ’»app/imports/api/users/server/handlers/emojiStatus.js","meteor://ğŸ’»app/imports/api/users/server/handlers/getUsers.js","meteor://ğŸ’»app/imports/api/users/server/handlers/presenterAssigned.js","meteor://ğŸ’»app/imports/api/users/server/handlers/removeUser.js","meteor://ğŸ’»app/imports/api/users/server/handlers/userEjected.js","meteor://ğŸ’»app/imports/api/users/server/handlers/userInactivityInspect.js","meteor://ğŸ’»app/imports/api/users/server/handlers/userJoin.js","meteor://ğŸ’»app/imports/api/users/server/handlers/userJoined.js","meteor://ğŸ’»app/imports/api/users/server/handlers/validateAuthToken.js","meteor://ğŸ’»app/imports/api/users/server/methods/assignPresenter.js","meteor://ğŸ’»app/imports/api/users/server/methods/changeRole.js","meteor://ğŸ’»app/imports/api/users/server/methods/removeUser.js","meteor://ğŸ’»app/imports/api/users/server/methods/setEmojiStatus.js","meteor://ğŸ’»app/imports/api/users/server/methods/setUserEffectiveConnectionType.js","meteor://ğŸ’»app/imports/api/users/server/methods/toggleUserLock.js","meteor://ğŸ’»app/imports/api/users/server/methods/userActivitySign.js","meteor://ğŸ’»app/imports/api/users/server/methods/userLeaving.js","meteor://ğŸ’»app/imports/api/users/server/methods/userLeftMeeting.js","meteor://ğŸ’»app/imports/api/users/server/methods/validateAuthToken.js","meteor://ğŸ’»app/imports/api/users/server/modifiers/addDialInUser.js","meteor://ğŸ’»app/imports/api/users/server/modifiers/addUser.js","meteor://ğŸ’»app/imports/api/users/server/modifiers/changePresenter.js","meteor://ğŸ’»app/imports/api/users/server/modifiers/changeRole.js","meteor://ğŸ’»app/imports/api/users/server/modifiers/clearUsers.js","meteor://ğŸ’»app/imports/api/users/server/modifiers/createDummyUser.js","meteor://ğŸ’»app/imports/api/users/server/modifiers/removeUser.js","meteor://ğŸ’»app/imports/api/users/server/modifiers/setConnectionIdAndAuthToken.js","meteor://ğŸ’»app/imports/api/users/server/modifiers/setUserEffectiveConnectionType.js","meteor://ğŸ’»app/imports/api/users/server/modifiers/userEjected.js","meteor://ğŸ’»app/imports/api/users/server/modifiers/userInactivityInspect.js","meteor://ğŸ’»app/imports/api/users/server/store/bannedUsers.js","meteor://ğŸ’»app/imports/api/users/server/store/pendingAuthentications.js","meteor://ğŸ’»app/imports/api/users/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/users/server/index.js","meteor://ğŸ’»app/imports/api/users/server/methods.js","meteor://ğŸ’»app/imports/api/users/server/publishers.js","meteor://ğŸ’»app/imports/api/users/index.js","meteor://ğŸ’»app/imports/api/users-infos/server/handlers/userInformation.js","meteor://ğŸ’»app/imports/api/users-infos/server/methods/removeUserInformation.js","meteor://ğŸ’»app/imports/api/users-infos/server/methods/requestUserInformation.js","meteor://ğŸ’»app/imports/api/users-infos/server/modifiers/addUserInfo.js","meteor://ğŸ’»app/imports/api/users-infos/server/modifiers/clearUserInfo.js","meteor://ğŸ’»app/imports/api/users-infos/server/modifiers/clearUserInfoForRequester.js","meteor://ğŸ’»app/imports/api/users-infos/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/users-infos/server/index.js","meteor://ğŸ’»app/imports/api/users-infos/server/methods.js","meteor://ğŸ’»app/imports/api/users-infos/server/publishers.js","meteor://ğŸ’»app/imports/api/users-infos/index.js","meteor://ğŸ’»app/imports/api/users-settings/server/methods/addUserSettings.js","meteor://ğŸ’»app/imports/api/users-settings/server/modifiers/addUserSetting.js","meteor://ğŸ’»app/imports/api/users-settings/server/modifiers/clearUsersSettings.js","meteor://ğŸ’»app/imports/api/users-settings/server/index.js","meteor://ğŸ’»app/imports/api/users-settings/server/methods.js","meteor://ğŸ’»app/imports/api/users-settings/server/publishers.js","meteor://ğŸ’»app/imports/api/users-settings/index.js","meteor://ğŸ’»app/imports/api/video-streams/server/handlers/userSharedHtml5Webcam.js","meteor://ğŸ’»app/imports/api/video-streams/server/handlers/userUnsharedHtml5Webcam.js","meteor://ğŸ’»app/imports/api/video-streams/server/methods/userShareWebcam.js","meteor://ğŸ’»app/imports/api/video-streams/server/methods/userUnshareWebcam.js","meteor://ğŸ’»app/imports/api/video-streams/server/modifiers/clearVideoStreams.js","meteor://ğŸ’»app/imports/api/video-streams/server/modifiers/sharedWebcam.js","meteor://ğŸ’»app/imports/api/video-streams/server/modifiers/unsharedWebcam.js","meteor://ğŸ’»app/imports/api/video-streams/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/video-streams/server/helpers.js","meteor://ğŸ’»app/imports/api/video-streams/server/index.js","meteor://ğŸ’»app/imports/api/video-streams/server/methods.js","meteor://ğŸ’»app/imports/api/video-streams/server/publisher.js","meteor://ğŸ’»app/imports/api/video-streams/index.js","meteor://ğŸ’»app/imports/api/voice-call-states/server/handlers/voiceCallStateEvent.js","meteor://ğŸ’»app/imports/api/voice-call-states/server/modifiers/clearVoiceCallStates.js","meteor://ğŸ’»app/imports/api/voice-call-states/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/voice-call-states/server/index.js","meteor://ğŸ’»app/imports/api/voice-call-states/server/publishers.js","meteor://ğŸ’»app/imports/api/voice-call-states/index.js","meteor://ğŸ’»app/imports/api/voice-users/server/handlers/getVoiceUsers.js","meteor://ğŸ’»app/imports/api/voice-users/server/handlers/joinVoiceUser.js","meteor://ğŸ’»app/imports/api/voice-users/server/handlers/leftVoiceUser.js","meteor://ğŸ’»app/imports/api/voice-users/server/handlers/meetingMuted.js","meteor://ğŸ’»app/imports/api/voice-users/server/handlers/mutedVoiceUser.js","meteor://ğŸ’»app/imports/api/voice-users/server/handlers/talkingVoiceUser.js","meteor://ğŸ’»app/imports/api/voice-users/server/handlers/voiceUsers.js","meteor://ğŸ’»app/imports/api/voice-users/server/methods/ejectUserFromVoice.js","meteor://ğŸ’»app/imports/api/voice-users/server/methods/muteAllExceptPresenterToggle.js","meteor://ğŸ’»app/imports/api/voice-users/server/methods/muteAllToggle.js","meteor://ğŸ’»app/imports/api/voice-users/server/methods/muteToggle.js","meteor://ğŸ’»app/imports/api/voice-users/server/modifiers/addVoiceUser.js","meteor://ğŸ’»app/imports/api/voice-users/server/modifiers/changeMuteMeeting.js","meteor://ğŸ’»app/imports/api/voice-users/server/modifiers/clearVoiceUsers.js","meteor://ğŸ’»app/imports/api/voice-users/server/modifiers/removeVoiceUser.js","meteor://ğŸ’»app/imports/api/voice-users/server/modifiers/updateVoiceUser.js","meteor://ğŸ’»app/imports/api/voice-users/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/voice-users/server/index.js","meteor://ğŸ’»app/imports/api/voice-users/server/methods.js","meteor://ğŸ’»app/imports/api/voice-users/server/publishers.js","meteor://ğŸ’»app/imports/api/voice-users/index.js","meteor://ğŸ’»app/imports/api/whiteboard-multi-user/server/handlers/modifyWhiteboardAccess.js","meteor://ğŸ’»app/imports/api/whiteboard-multi-user/server/methods/changeWhiteboardAccess.js","meteor://ğŸ’»app/imports/api/whiteboard-multi-user/server/modifiers/clearWhiteboardMultiUser.js","meteor://ğŸ’»app/imports/api/whiteboard-multi-user/server/modifiers/modifyWhiteboardAccess.js","meteor://ğŸ’»app/imports/api/whiteboard-multi-user/server/eventHandlers.js","meteor://ğŸ’»app/imports/api/whiteboard-multi-user/server/index.js","meteor://ğŸ’»app/imports/api/whiteboard-multi-user/server/methods.js","meteor://ğŸ’»app/imports/api/whiteboard-multi-user/server/publishers.js","meteor://ğŸ’»app/imports/api/whiteboard-multi-user/index.js","meteor://ğŸ’»app/imports/api/common/server/helpers.js","meteor://ğŸ’»app/imports/startup/server/index.js","meteor://ğŸ’»app/imports/startup/server/logger.js","meteor://ğŸ’»app/imports/startup/server/metrics.js","meteor://ğŸ’»app/imports/startup/server/minBrowserVersion.js","meteor://ğŸ’»app/imports/startup/server/redis.js","meteor://ğŸ’»app/imports/startup/server/settings.js","meteor://ğŸ’»app/imports/utils/lineEndings.js","meteor://ğŸ’»app/imports/utils/mimeTypes.js","meteor://ğŸ’»app/imports/utils/regex-weburl.js","meteor://ğŸ’»app/server/main.js"],"names":["body","check","header","multiUser","clearAnnotations","annotationsAdded","_","annotation","userId","addAnnotation","modifyWhiteboardAccess","whiteboardId","fullClear","Boolean","AnnotationsStreamer","queueMetrics","Meteor","annotationsQueueProcessInterval","ANNOTATION_PROCESS_INTERVAL","annotationsQueue","annotationsRecieverIsRunning","process","Object","meetingId","annotations","Metrics","shapeId","removeAnnotation","RedisPubSub","REDIS_CONFIG","CHANNEL","EVENT_NAME","requesterUserId","extractCredentials","payload","sendAnnotationHelper","id","status","annotationType","annotationInfo","x","y","fontColor","calcedFontSize","textBoxWidth","text","textBoxHeight","fontSize","dataPoints","type","String","wbId","position","Number","color","thickness","points","dimensions","Match","query","addAnnotationQuery","insertedId","Annotations","Logger","err","selector","numberAffected","processForHTML5ServerOnly","sendBulkAnnotations","boundAnnotations","streamer","retransmit","ANNOTATION_TYPE_TEXT","ANNOTATION_TYPE_PENCIL","modifier","$set","$setOnInsert","$inc","version","DRAW_START","DRAW_UPDATE","DRAW_END","baseSelector","baseModifier","$push","$each","handleTextUpdate","handlePencilUpdate","handleCommonAnnotation","Mongo","breakoutId","clearBreakouts","users","insertedTime","Breakouts","DEFAULT_TIME_REMAINING","breakout","joinedUsers","timeRemaining","parentMeetingId","flat","usersMapped","user","name","options","multi","record","BREAKOUT_LIM","MIN_BREAKOUT_ROOMS","MAX_BREAKOUT_ROOMS","eventName","rooms","userIdToInvite","endAllBreakouts","ROLE_MODERATOR","User","fields","role","presenterSelector","$or","freeJoin","boundBreakouts","breakouts","pad","fetchReadOnlyPadId","changeset","data","getDataFromChangeset","updatePad","padIds","padId","readOnlyId","generatePadId","axios","method","url","appendTextURL","responseType","response","error","isEnabled","getLocalesURL","locales","locale","addCaption","addCaptionsPads","getIndex","length","index","startIndex","localeCode","endIndex","readOnlyURL","getReadOnlyIdURL","readOnlyPadId","getDataFromResponse","updateReadOnlyPadId","$regex","CAPTIONS_TOKEN","updateOwnerId","ownerId","revs","Captions","updateOwner","editCaptions","addPad","processForCaptionsPadOnly","ETHERPAD","CAPTIONS_CONFIG","BASENAME","APP","LOCALES_URL","host","port","localesUrl","TOKEN","hashSHA1","isCaptionsPad","splitPadId","splitChangeset","fn","appendText","boundCaptions","captions","streamerLog","CURSOR_PROCCESS_INTERVAL","cursorQueue","proccess","cursors","CursorStreamer","publishCursorUpdate","message","streamName","streamerName","allowRecentMessages","state","externalVideoUrl","presenter","Meetings","meeting","emitExternalVideoEvent","addGroupChat","chats","chat","correlationId","Date","msg","receiver","access","chatId","createdBy","chatDocument","u","safe","GroupChat","clearGroupChatMsg","destroyGroupChat","CHAT_CONFIG","PUBLIC_CHAT_TYPE","$all","boundGroupChat","groupChat","CHAT_ACCESS","PUBLIC","PRIVATE","CHAT_ACCESS_PUBLIC","CHAT_ACCESS_PRIVATE","bufferChatInsertsMs","msgBuffer","bulkFn","addGroupChatMsg","msgs","syncMeetingChatMsgs","startTyping","PUBLIC_GROUP_CHAT_ID","HTML_SAFE_MAP","parseMessage","parsedMessage","c","UsersTyping","userTyping","stopTyping","GroupChatMsg","mappedMsgs","_id","sender","el","insertedCount","BREAK_LINE","timestamp","msgDocument","PUBLIC_CHAT_SYSTEM_ID","CHAT_CLEAR_MESSAGE","clearMsg","$eq","TYPING_TIMEOUT","isTypingTo","time","typingUser","sendMsgInitiated","stillTyping","bulkOperations","msgToSync","_str","stopUserTyping","$in","chatsIds","groupChatMsg","boundUsersTyping","usersTyping","guests","guest","setGuestStatus","stringHash","COLOR_LIST","intId","approved","denied","loginTime","mappedGuests","approvedBy","JSON","setBy","policy","policyRule","GuestUsers","GUEST_STATUS_ALLOW","GUEST_STATUS_DENY","changeGuestPolicy","boundSlides","guestUsers","userLocalSettings","settings","setChangedLocalSettings","LocalSettings","numChanged","userChangedLocalSettings","boundLocalSettings","localSettings","logClient","logCode","extraInfo","userInfo","connectionId","logContents","level","handleMeetingCreation","durationInSecods","addMeeting","destroyExternalVideo","removeAnnotationsStreamer","removeCursorStreamer","cb","meetingType","Users","connectionStatus","meetingHasEnded","meetingEnded","changeLockSettings","recording","RecordMeetings","timeLeftInSec","MeetingTimeRemaining","changeUserLock","changeWebcamOnlyModerator","disableCam","disableMic","disablePrivateChat","disablePublicChat","disableNote","hideUserList","lockedLayout","lockOnJoin","lockOnJoinConfigurable","recordObject","meetingRecorded","allowedToRecord","toMeetingId","breakoutProps","sequence","breakoutRooms","parentId","enabled","privateChatEnabled","meetingProp","extId","isBreakout","usersProp","webcamsOnlyForModerator","guestPolicy","maxUsers","allowModsToUnmuteUsers","durationProps","createdTime","duration","createdDate","maxInactivityTimeoutMinutes","warnMinutesBeforeMax","meetingExpireIfNoUserJoinedInMinutes","meetingExpireWhenLastUserLeftInMinutes","userInactivityInspectTimerInMinutes","userInactivityThresholdInMinutes","userActivitySignResponseDelayInMinutes","welcomeProp","welcomeMsg","modOnlyMessage","welcomeMsgTemplate","recordProp","allowStartStopRecording","autoStartRecording","password","viewerPass","moderatorPass","voiceProp","voiceConf","dialNumber","telVoice","muteOnStart","screenshareProps","red5ScreenshareIp","red5ScreenshareApp","screenshareConf","metadataProp","lockSettingsProps","restProps","newMeeting","sanitizeTextInChat","original","SanitizeHTML","allowedTags","allowedAttributes","a","img","allowedSchemes","sanitizedWelcomeText","insertBlankTarget","s","linkWithoutTarget","publishedPoll","addAnnotationsStreamer","addCursorStreamer","createNote","createCaptions","BannedUsers","disablePrivChat","disablePubChat","locked","lockedBy","clearCaptions","clearGroupChat","clearGuestUsers","clearPresentationPods","clearPolls","clearSlides","clearUsers","clearUsersSettings","clearVoiceUsers","clearUserInfo","clearNote","clearNetworkInformation","clearLocalSettings","clearMeetingTimeRemaining","clearRecordMeeting","clearVoiceCallStates","clearVideoStreams","clearWhiteboardMultiUser","clearScreenshare","isPublished","toggleWebcamsOnlyForModerator","boundMeetings","meetings","boundRecordMeetings","recordMeetings","boundtimeRemaining","meetingTimeRemaining","NetworkInformation","userInstabilityDetected","boundNetworkInformation","networkInformation","updateNote","noteId","generateNoteId","createURL","createPadURL","responseOuter","readOnlyNoteId","addNote","Note","processForNotePadOnly","NOTE_CONFIG","BASE_URL","apikey","encodeURIComponent","innerData","isNotePad","boundNote","note","lastPing","ping","COLLECTION_NAME","INTERVAL_IN_SETTINGS","INTERVAL_TIME","PONG_INTERVAL_IN_SETTINGS","PONG_INTERVAL","pongSender","interval","pong","pollId","setPublishedPoll","removePoll","poll","addPoll","answerId","$pull","responses","Polls","answers","key","numVotes","numRespondents","numResponders","updateVotes","requesterId","allowedToVote","pollAnswerId","questionId","pollType","userSelector","$ne","clientType","userIds","requester","stopPoll","boundPolls","currentPoll","polls","currentPresenterId","podId","pod","addPresentationPod","removePresentationPod","nextPresenterId","setPresenterInPod","pods","presentationPodIds","presentationPodsToRemove","$nin","p","currentPresenter","presentations","PresentationPods","presentation","addPresentation","clearPresentations","clearPresentationUploadToken","boundPresentationPods","presentationPods","filename","failed","authzToken","used","PresentationUploadToken","setUsedToken","boundPresentationUploadToken","presentationUploadToken","OFFICE_DOC_CONVERSION_FAILED_KEY","OFFICE_DOC_CONVERSION_INVALID_KEY","SUPPORTED_DOCUMENT_KEY","UNSUPPORTED_DOCUMENT_KEY","PAGE_COUNT_FAILED_KEY","PAGE_COUNT_EXCEEDED_KEY","PDF_HAS_BIG_PAGE_KEY","GENERATED_SLIDE_KEY","messageKey","presName","presentationName","statusModifier","presentationId","Presentations","setCurrentPresentation","downloadable","setPresentationDownloadable","removePresentation","getSlideText","content","HTTP","addSlides","slides","slide","addSlide","current","pages","num","thumbUri","swfUri","txtUri","svgUri","xOffset","yOffset","widthRatio","heightRatio","clearSlidesPresentation","oldCurrent","callback","newCurrent","oldPresentation","newPresentation","boundPresentations","presenterId","stopWatchingExternalVideo","addScreenshare","screenshare","Screenshare","boundScreenshare","changeCurrentSlide","resizeSlide","Presentation","Slide","slideNumber","pageId","loadSlidesFromHttpAlways","requestWhiteboardHistory","USER_ID","slideId","SUPPORTED_TYPES","fetchImageSizes","imageUri","result","mime","width","height","reason","restSlide","imageSizeUri","slideData","slidePosition","calculateSlideData","addSlidePositions","Slides","SlidePositions","viewBoxWidth","viewBoxHeight","oldSlide","newSlide","numberAffectedSlidePositions","whiteboardIds","row","SlidePosition","calculatedData","zoomSlide","boundSlidePositions","slidePositions","changedBy","changeRole","emoji","emojiTime","usersIds","m","usersToRemove","removeUser","usersAdded","addUser","assignedBy","changePresenter","prevPresenter","setPresenterPayload","defaultPodSelector","currentDefaultPodPresenter","setPresenterInPodReqMsg","oldPresenter","userEjected","reasonCode","responseDelay","userInactivityInspect","authToken","clearOtherSessions","serverSessions","i","waitForApproval","pendingAuths","pendingAuthenticationsStore","pendingAuth","methodInvocationObject","sessionId","createDummyUser","setConnectionIdAndAuthToken","valid","userJoin","validated","inactivityCheck","sessionUserId","currentConnectionId","newPresenterId","newPresenterName","ejectedBy","banUser","removedUser","effectiveConnectionType","setEffectiveConnectionType","lock","loggedOut","externalId","invalid","error_type","isUserInvalid","ejected","requesterToken","USER_CONFIG","ROLE_VIEWER","callerName","voiceOnlyUser","authed","waitingForAcceptance","guestStatus","avatar","sanitizedName","userData","Meeting","sortName","isBreakoutUser","addVoiceUser","voiceUserId","callerNum","muted","talking","callingWith","listenOnly","joined","doc","clearAllSessions","userToRemove","VideoStreams","clearUserInfoForRequester","ejectedReason","constructor","init","add","delete","has","generateKey","take","matches","e","userLeftMeeting","onCloseConnection","userLeaving","boundUsers","currentUser","addUserInfo","UserInfos","externalUserId","info","removeUserInformation","boundUserInfos","userInfos","oldParameters","askForFeedbackOnLogout","autoJoin","autoShareWebcam","autoSwapLayout","clientTitle","customStyle","customStyleUrl","displayBrandingArea","enableScreensharing","enableVideo","forceListenOnly","hidePresentation","listenOnlyMode","multiUserPenOnly","multiUserTools","outsideToggleRecording","outsideToggleSelfVoice","presenterTools","shortcuts","skipCheck","oldParametersKeys","currentParameters","parsedValue","val","logger","parameters","settingKey","normalizedKey","valueParser","matchingNewKey","settingsAdded","setting","value","addUserSetting","UserSettings","addUserSettings","mainRoomUserSettings","boundUserSettings","userSettings","stream","isValidStream","sharedWebcam","unsharedWebcam","deviceId","getDeviceId","getUserName","FLASH_STREAM_REGEX","splitStream","userUnshareWebcam","boundVideoStreams","videoStreams","callState","clientSession","VoiceCallState","VoiceCallStates","boundVoiceCallStates","voiceCallStates","voiceUsersIdsToUpdate","voiceUsersUpdated","updateVoiceUser","voiceUsersToRemove","removeVoiceUser","voiceUser","addDialInUser","isDialInUser","changeMuteMeeting","VoiceUsers","voiceUsers","voice","toggleMeetingMuted","mutedBy","mute","userToMute","uId","toggle","_muted","spoke","clearSpokeTimeout","TALKING_TIMEOUT","startTime","timeoutHandle","endTime","spokeDelay","spokeTimeoutHandles","toggleVoice","muteAllUsers","muteAllExceptPresenter","ejectUserFromVoice","boundVoiceUser","WhiteboardMultiUser","changeWhiteboardAccess","boundMultiUser","whiteboardMultiUser","MSG_DIRECT_TYPE","NODE_USER","indexOf","l","envelope","routing","shouldSkip","msgType","str","sha1","credentials","credentialsArray","AVAILABLE_LOCALES","fs","APP_CONFIG","env","CDN_URL","customHeartbeat","newHeartbeat","currentTime","lastSentFrameTimestamp","supportsHeartbeats","clearTimeout","setTimeout","sentAt","now","newSend","console","socket","recv","session","memoryMonitoringSettings","heapDumpMbThreshold","heapdumpFolderPath","memwatch","stats","heapDumpTriggered","heapdump","path","BrowserPolicy","WebAppInternals","fontRegExp","WebApp","req","res","next","setMinBrowserVersions","$lt","html5clientStatus","fallback","override","browserLocale","localeList","usableLocales","file","regionDefault","messages","normalizedLocale","Assets","Langmap","nativeName","userName","rating","reqUserName","feedback","userAgent","lookupUserAgent","eventEmitter","Redis","redisPubSub","LOG_CONFIG","createLogger","format","transports","prettyPrint","humanReadableUnhandledException","colorize","handleExceptions","removeMeetingOnEnd","addEvent","currentlyInQueue","wasInQueue","count","payloadSize","messageLength","processEvent","currentProcessingTimestamp","processTime","min","max","last","total","avg","size","processingTime","setAnnotationQueueLength","startDumpFile","fileDate","fullYear","month","day","hour","minutes","seconds","folderName","fileName","folderPath","fullFilePath","removeMeeting","metricsSingleton","minBrowserVersions","versions","elem","setMinimumBrowserVersions","NO_MEETING_ID","makeEnvelope","core","asyncMessages","redisDebugEnabled","handleTask","channel","isAsync","beginHandleTimestamp","called","callNext","queueId","dataLength","queueLength","onError","config","redisConf","channelsToSubscribe","updateConfig","handleSubscribe","handleMessage","ignored","async","ignoredMessages","destroyMeetingQueue","on","publishVoiceMessage","publishSystemMessage","publishMeetingMessage","publishUserMessage","RedisPubSubSingleton","YAML_FILE_PATH","SETTINGS","YAML","__meteor_runtime_config__","CARRIAGE_RETURN","NEW_LINE","XLS","XLSX","DOC","DOCX","PPT","PPTX","ODT","RTF","TXT","ODS","ODP","PDF","JPEG","PNG","SVG","UPLOAD_SUPORTED","global"],"mappings":"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","file":"/app.js","sourcesContent":["import _ from 'lodash';\nimport { check } from 'meteor/check';\nimport modifyWhiteboardAccess from '/imports/api/whiteboard-multi-user/server/modifiers/modifyWhiteboardAccess';\nimport clearAnnotations from '../modifiers/clearAnnotations';\nimport addAnnotation from '../modifiers/addAnnotation';\n\nexport default function handleWhiteboardAnnotations({ header, body }, meetingId) {\n  check(header, Object);\n  if (header.userId !== 'nodeJSapp') { return false; }\n\n  check(meetingId, String);\n  check(body, Object);\n\n  const { annotations, whiteboardId, multiUser } = body;\n\n  check(annotations, Array);\n  check(whiteboardId, String);\n  check(multiUser, Boolean);\n\n  clearAnnotations(meetingId, whiteboardId);\n\n  const annotationsAdded = [];\n  _.each(annotations, (annotation) => {\n    const { wbId, userId } = annotation;\n    annotationsAdded.push(addAnnotation(meetingId, wbId, userId, annotation));\n  });\n\n  modifyWhiteboardAccess(meetingId, whiteboardId, multiUser);\n\n  return annotationsAdded;\n}\n","import { check } from 'meteor/check';\nimport AnnotationsStreamer from '/imports/api/annotations/server/streamer';\n\nimport clearAnnotations from '../modifiers/clearAnnotations';\n\nexport default function handleWhiteboardCleared({ body }, meetingId) {\n  check(body, {\n    userId: String,\n    whiteboardId: String,\n    fullClear: Boolean,\n  });\n\n  const { whiteboardId, fullClear, userId } = body;\n\n  if (fullClear) {\n    AnnotationsStreamer(meetingId).emit('removed', { meetingId, whiteboardId });\n    return clearAnnotations(meetingId, whiteboardId);\n  }\n\n  AnnotationsStreamer(meetingId).emit('removed', { meetingId, whiteboardId, userId });\n  return clearAnnotations(meetingId, whiteboardId, userId);\n}\n","import { check } from 'meteor/check';\nimport AnnotationsStreamer from '/imports/api/annotations/server/streamer';\nimport addAnnotation from '../modifiers/addAnnotation';\nimport Metrics from '/imports/startup/server/metrics';\n\nconst { queueMetrics } = Meteor.settings.private.redis.metrics;\n\nconst {\n  annotationsQueueProcessInterval: ANNOTATION_PROCESS_INTERVAL,\n} = Meteor.settings.public.whiteboard;\n\nlet annotationsQueue = {};\nlet annotationsRecieverIsRunning = false;\n\nconst process = () => {\n  if (!Object.keys(annotationsQueue).length) {\n    annotationsRecieverIsRunning = false;\n    return;\n  }\n  annotationsRecieverIsRunning = true;\n  Object.keys(annotationsQueue).forEach((meetingId) => {\n    AnnotationsStreamer(meetingId).emit('added', { meetingId, annotations: annotationsQueue[meetingId] });\n    if (queueMetrics) {\n      Metrics.setAnnotationQueueLength(meetingId, 0);\n    }\n  });\n  annotationsQueue = {};\n\n  Meteor.setTimeout(process, ANNOTATION_PROCESS_INTERVAL);\n};\n\nexport default function handleWhiteboardSend({ header, body }, meetingId) {\n  const userId = header.userId;\n  const annotation = body.annotation;\n\n  check(userId, String);\n  check(annotation, Object);\n\n  const whiteboardId = annotation.wbId;\n  check(whiteboardId, String);\n\n  if (!annotationsQueue.hasOwnProperty(meetingId)) {\n    annotationsQueue[meetingId] = [];\n  }\n\n  annotationsQueue[meetingId].push({ meetingId, whiteboardId, userId, annotation });\n  if (queueMetrics) {\n    Metrics.setAnnotationQueueLength(meetingId, annotationsQueue[meetingId].length);\n  }\n  if (!annotationsRecieverIsRunning) process();\n\n  return addAnnotation(meetingId, whiteboardId, userId, annotation);\n}\n","import { check } from 'meteor/check';\n\nimport AnnotationsStreamer from '/imports/api/annotations/server/streamer';\nimport removeAnnotation from '../modifiers/removeAnnotation';\n\nexport default function handleWhiteboardUndo({ body }, meetingId) {\n  const whiteboardId = body.whiteboardId;\n  const shapeId = body.annotationId;\n\n  check(whiteboardId, String);\n  check(shapeId, String);\n\n  AnnotationsStreamer(meetingId).emit('removed', { meetingId, whiteboardId, shapeId });\n  return removeAnnotation(meetingId, whiteboardId, shapeId);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function clearWhiteboard(whiteboardId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'ClearWhiteboardPubMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(whiteboardId, String);\n\n  const payload = {\n    whiteboardId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import sendAnnotationHelper from './sendAnnotationHelper';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function sendAnnotation(annotation) {\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  sendAnnotationHelper(annotation, meetingId, requesterUserId);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\n\nexport default function sendAnnotationHelper(annotation, meetingId, requesterUserId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'SendWhiteboardAnnotationPubMsg';\n\n  const whiteboardId = annotation.wbId;\n\n  check(annotation, Object);\n  check(whiteboardId, String);\n\n  if (annotation.annotationType === 'text') {\n    check(annotation, {\n      id: String,\n      status: String,\n      annotationType: String,\n      annotationInfo: {\n        x: Number,\n        y: Number,\n        fontColor: Number,\n        calcedFontSize: Number,\n        textBoxWidth: Number,\n        text: String,\n        textBoxHeight: Number,\n        id: String,\n        whiteboardId: String,\n        status: String,\n        fontSize: Number,\n        dataPoints: String,\n        type: String,\n      },\n      wbId: String,\n      userId: String,\n      position: Number,\n    });\n  } else {\n    check(annotation, {\n      id: String,\n      status: String,\n      annotationType: String,\n      annotationInfo: {\n        color: Number,\n        thickness: Number,\n        points: Array,\n        id: String,\n        whiteboardId: String,\n        status: String,\n        type: String,\n        dimensions: Match.Maybe([Number]),\n      },\n      wbId: String,\n      userId: String,\n      position: Number,\n    });\n  }\n\n  const payload = {\n    annotation,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { extractCredentials } from '/imports/api/common/server/helpers';\nimport sendAnnotationHelper from './sendAnnotationHelper';\n\nexport default function sendBulkAnnotations(payload) {\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  payload.forEach(annotation => sendAnnotationHelper(annotation, meetingId, requesterUserId));\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function undoAnnotation(whiteboardId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'UndoWhiteboardPubMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(whiteboardId, String);\n\n  const payload = {\n    whiteboardId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport Annotations from '/imports/api/annotations';\nimport addAnnotationQuery from '/imports/api/annotations/addAnnotation';\n\nexport default function addAnnotation(meetingId, whiteboardId, userId, annotation) {\n  check(meetingId, String);\n  check(whiteboardId, String);\n  check(annotation, Object);\n\n  const query = addAnnotationQuery(meetingId, whiteboardId, userId, annotation);\n\n  try {\n    const { insertedId } = Annotations.upsert(query.selector, query.modifier);\n\n    if (insertedId) {\n      Logger.info(`Added annotation id=${annotation.id} whiteboard=${whiteboardId}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding annotation to collection: ${err}`);\n  }\n}\n","import Annotations from '/imports/api/annotations';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearAnnotations(meetingId, whiteboardId, userId) {\n  const selector = {};\n\n  if (meetingId) {\n    selector.meetingId = meetingId;\n  }\n\n  if (whiteboardId) {\n    selector.whiteboardId = whiteboardId;\n  }\n\n  if (userId) {\n    selector.userId = userId;\n  }\n\n  try {\n    const numberAffected = Annotations.remove(selector);\n\n    if (numberAffected) {\n      if (userId) {\n        Logger.info(`Cleared Annotations for userId=${userId} where whiteboard=${whiteboardId}`);\n        return;\n      }\n\n      if (whiteboardId) {\n        Logger.info(`Cleared Annotations for whiteboard=${whiteboardId}`);\n        return;\n      }\n\n      if (meetingId) {\n        Logger.info(`Cleared Annotations (${meetingId})`);\n        return;\n      }\n\n      Logger.info('Cleared Annotations (all)');\n    }\n  } catch (err) {\n    Logger.error(`Removing Annotations from collection: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport Annotations from '/imports/api/annotations';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function removeAnnotation(meetingId, whiteboardId, shapeId) {\n  check(meetingId, String);\n  check(whiteboardId, String);\n  check(shapeId, String);\n\n  const selector = {\n    meetingId,\n    whiteboardId,\n    id: shapeId,\n  };\n\n  try {\n    const numberAffected = Annotations.remove(selector);\n\n    if (numberAffected) {\n      Logger.info(`Removed annotation id=${shapeId} whiteboard=${whiteboardId}`);\n    }\n  } catch (err) {\n    Logger.error(`Removing annotation from collection: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { processForHTML5ServerOnly } from '/imports/api/common/server/helpers';\nimport handleWhiteboardCleared from './handlers/whiteboardCleared';\nimport handleWhiteboardUndo from './handlers/whiteboardUndo';\nimport handleWhiteboardSend from './handlers/whiteboardSend';\nimport handleWhiteboardAnnotations from './handlers/whiteboardAnnotations';\n\nRedisPubSub.on('ClearWhiteboardEvtMsg', handleWhiteboardCleared);\nRedisPubSub.on('UndoWhiteboardEvtMsg', handleWhiteboardUndo);\nRedisPubSub.on('SendWhiteboardAnnotationEvtMsg', handleWhiteboardSend);\nRedisPubSub.on('GetWhiteboardAnnotationsRespMsg', processForHTML5ServerOnly(handleWhiteboardAnnotations));\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport undoAnnotation from './methods/undoAnnotation';\nimport clearWhiteboard from './methods/clearWhiteboard';\nimport sendAnnotation from './methods/sendAnnotation';\nimport sendBulkAnnotations from './methods/sendBulkAnnotations';\n\nMeteor.methods({\n  undoAnnotation,\n  clearWhiteboard,\n  sendAnnotation,\n  sendBulkAnnotations,\n});\n","import Annotations from '/imports/api/annotations';\nimport { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction annotations() {\n  if (!this.userId) {\n    return Annotations.find({ meetingId: '' });\n  }\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing Annotations', { meetingId, requesterUserId });\n\n  return Annotations.find({ meetingId });\n}\n\nfunction publish(...args) {\n  const boundAnnotations = annotations.bind(this);\n  return boundAnnotations(...args);\n}\n\nMeteor.publish('annotations', publish);\n","import Logger from '/imports/startup/server/logger';\n\nexport function removeAnnotationsStreamer(meetingId) {\n  Logger.info(`Removing Annotations streamer object for meeting ${meetingId}`);\n  delete Meteor.StreamerCentral.instances[`annotations-${meetingId}`];\n}\n\nexport function addAnnotationsStreamer(meetingId) {\n  const streamer = new Meteor.Streamer(`annotations-${meetingId}`, { retransmit: false });\n\n  streamer.allowRead(function allowRead() {\n    if (!this.userId) return false;\n\n    return this.userId && this.userId.includes(meetingId);\n  });\n\n  streamer.allowWrite(function allowWrite() {\n    return false;\n  });\n}\n\nexport default function get(meetingId) {\n  return Meteor.StreamerCentral.instances[`annotations-${meetingId}`];\n}\n","import { check } from 'meteor/check';\n\nconst ANNOTATION_TYPE_TEXT = 'text';\nconst ANNOTATION_TYPE_PENCIL = 'pencil';\n\n// line, triangle, ellipse, rectangle\nfunction handleCommonAnnotation(meetingId, whiteboardId, userId, annotation) {\n  const {\n    id, status, annotationType, annotationInfo, wbId, position,\n  } = annotation;\n\n  const selector = {\n    meetingId,\n    id,\n    userId,\n  };\n\n  const modifier = {\n    $set: {\n      whiteboardId,\n      meetingId,\n      id,\n      status,\n      annotationType,\n      annotationInfo,\n      wbId,\n    },\n    $setOnInsert: {\n      position,\n    },\n    $inc: { version: 1 },\n  };\n\n  return { selector, modifier };\n}\n\nfunction handleTextUpdate(meetingId, whiteboardId, userId, annotation) {\n  const {\n    id, status, annotationType, annotationInfo, wbId, position,\n  } = annotation;\n\n  const selector = {\n    meetingId,\n    id,\n    userId,\n  };\n\n  annotationInfo.text = annotationInfo.text.replace(/[\\r]/g, '\\n');\n\n  const modifier = {\n    $set: {\n      whiteboardId,\n      meetingId,\n      id,\n      status,\n      annotationType,\n      annotationInfo,\n      wbId,\n    },\n    $setOnInsert: {\n      position,\n    },\n    $inc: { version: 1 },\n  };\n\n  return { selector, modifier };\n}\n\nfunction handlePencilUpdate(meetingId, whiteboardId, userId, annotation) {\n  const DRAW_START = 'DRAW_START';\n  const DRAW_UPDATE = 'DRAW_UPDATE';\n  const DRAW_END = 'DRAW_END';\n\n  const {\n    id, status, annotationType, annotationInfo, wbId, position,\n  } = annotation;\n\n  const baseSelector = {\n    meetingId,\n    id,\n    userId,\n    whiteboardId,\n  };\n\n  let baseModifier;\n  switch (status) {\n    case DRAW_START:\n      // on start we split the points\n\n      // create the 'pencil_base'\n      // TODO: find and removed unused props (chunks, version, etc)\n      baseModifier = {\n        $set: {\n          id,\n          userId,\n          meetingId,\n          whiteboardId,\n          position,\n          status,\n          annotationType,\n          annotationInfo,\n          wbId,\n          version: 1,\n        },\n      };\n      break;\n    case DRAW_UPDATE:\n      baseModifier = {\n        $push: {\n          'annotationInfo.points': { $each: annotationInfo.points },\n        },\n        $set: {\n          status,\n        },\n        $inc: { version: 1 },\n      };\n      break;\n    case DRAW_END:\n      // Updating the main pencil object with the final info\n      baseModifier = {\n        $set: {\n          whiteboardId,\n          meetingId,\n          id,\n          status,\n          annotationType,\n          annotationInfo,\n          wbId,\n          position,\n        },\n        $inc: { version: 1 },\n      };\n      break;\n    default:\n      break;\n  }\n\n  return { selector: baseSelector, modifier: baseModifier };\n}\n\nexport default function addAnnotation(meetingId, whiteboardId, userId, annotation) {\n  check(meetingId, String);\n  check(whiteboardId, String);\n  check(annotation, Object);\n\n  switch (annotation.annotationType) {\n    case ANNOTATION_TYPE_TEXT:\n      return handleTextUpdate(meetingId, whiteboardId, userId, annotation);\n    case ANNOTATION_TYPE_PENCIL:\n      return handlePencilUpdate(meetingId, whiteboardId, userId, annotation);\n    default:\n      return handleCommonAnnotation(meetingId, whiteboardId, userId, annotation);\n  }\n}\n","import { Meteor } from 'meteor/meteor';\n\nconst Annotations = new Mongo.Collection('annotations');\n\nif (Meteor.isServer) {\n  // types of queries for the annotations  (Total):\n  // 1. meetingId, id, userId               ( 8 )\n  // 2. meetingId, id, userId, whiteboardId ( 1 )\n  // 3. meetingId                           ( 1 )\n  // 4. meetingId, whiteboardId             ( 1 )\n  // 5. meetingId, whiteboardId, id         ( 1 )\n  // 6. meetingId, whiteboardId, userId     ( 1 )\n  // These 2 indexes seem to cover all of the cases\n\n  Annotations._ensureIndex({ id: 1 });\n  Annotations._ensureIndex({ meetingId: 1, whiteboardId: 1, userId: 1 });\n}\n\nexport default Annotations;\n","import { check } from 'meteor/check';\nimport clearBreakouts from '../modifiers/clearBreakouts';\n\nexport default function handleBreakoutClosed({ body }) {\n  const { breakoutId } = body;\n  check(breakoutId, String);\n\n  return clearBreakouts(breakoutId);\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport Breakouts from '/imports/api/breakouts';\n\nexport default function handleBreakoutJoinURL({ body }) {\n  const {\n    redirectToHtml5JoinURL,\n    userId,\n    breakoutId,\n  } = body;\n\n  check(redirectToHtml5JoinURL, String);\n\n  const selector = {\n    breakoutId,\n  };\n\n  const modifier = {\n    $push: {\n      users: {\n        userId,\n        redirectToHtml5JoinURL,\n        insertedTime: new Date().getTime(),\n      },\n    },\n  };\n\n  try {\n    const { insertedId, numberAffected } = Breakouts.upsert(selector, modifier);\n\n    if (insertedId) {\n      Logger.info(`Added breakout id=${breakoutId}`);\n    } else if (numberAffected) {\n      Logger.info(`Upserted breakout id=${breakoutId}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding breakout to collection: ${err}`);\n  }\n}\n","import Breakouts from '/imports/api/breakouts';\nimport Logger from '/imports/startup/server/logger';\nimport { check } from 'meteor/check';\nimport flat from 'flat';\n\nexport default function handleBreakoutRoomStarted({ body }, meetingId) {\n  // 0 seconds default breakout time, forces use of real expiration time\n  const DEFAULT_TIME_REMAINING = 0;\n\n  const {\n    parentMeetingId,\n    breakout,\n  } = body;\n\n  const { breakoutId } = breakout;\n\n  check(meetingId, String);\n\n  const selector = {\n    breakoutId,\n  };\n\n  const modifier = {\n    $set: Object.assign(\n      {\n        users: [],\n        joinedUsers: [],\n      },\n      { timeRemaining: DEFAULT_TIME_REMAINING },\n      { parentMeetingId },\n      flat(breakout),\n    ),\n  };\n\n  try {\n    const { numberAffected } = Breakouts.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info('Updated timeRemaining and externalMeetingId '\n        + `for breakout id=${breakoutId}`);\n    }\n  } catch (err) {\n    Logger.error(`updating breakout: ${err}`);\n  }\n}\n","import Breakouts from '/imports/api/breakouts';\nimport Logger from '/imports/startup/server/logger';\nimport { check } from 'meteor/check';\n\nexport default function joinedUsersChanged({ body }) {\n  check(body, Object);\n\n  const {\n    parentId,\n    breakoutId,\n    users,\n  } = body;\n\n  check(parentId, String);\n  check(breakoutId, String);\n  check(users, Array);\n\n  const selector = {\n    parentMeetingId: parentId,\n    breakoutId,\n  };\n\n  const usersMapped = users.map(user => ({ userId: user.id, name: user.name }));\n  const modifier = {\n    $set: {\n      joinedUsers: usersMapped,\n    },\n  };\n\n  try {\n    const numberAffected = Breakouts.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Updated joined users in breakout id=${breakoutId}`);\n    }\n  } catch (err) {\n    Logger.error(`updating joined users in breakout: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport Breakouts from '/imports/api/breakouts';\n\nexport default function handleUpdateTimeRemaining({ body }, meetingId) {\n  const {\n    timeRemaining,\n  } = body;\n\n  check(meetingId, String);\n  check(timeRemaining, Number);\n\n  const selector = {\n    parentMeetingId: meetingId,\n  };\n\n  const modifier = {\n    $set: {\n      timeRemaining,\n    },\n  };\n\n  const options = {\n    multi: true,\n  };\n\n  try {\n    const numberAffected = Breakouts.update(selector, modifier, options);\n\n    if (numberAffected) {\n      Logger.info(`Updated breakout time remaining for breakouts where parentMeetingId=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Updating breakouts: ${err}`);\n  }\n}\n","import { Meteor } from 'meteor/meteor';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function createBreakoutRoom(rooms, durationInMinutes, record = false) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const BREAKOUT_LIM = Meteor.settings.public.app.breakoutRoomLimit;\n  const MIN_BREAKOUT_ROOMS = 2;\n  const MAX_BREAKOUT_ROOMS = BREAKOUT_LIM > MIN_BREAKOUT_ROOMS ? BREAKOUT_LIM : MIN_BREAKOUT_ROOMS;\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const eventName = 'CreateBreakoutRoomsCmdMsg';\n  if (rooms.length > MAX_BREAKOUT_ROOMS) {\n    Logger.info(`Attempt to create breakout rooms with invalid number of rooms in meeting id=${meetingId}`);\n    return;\n  }\n  const payload = {\n    record,\n    durationInMinutes,\n    rooms,\n    meetingId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, eventName, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function endAllBreakouts() {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(meetingId, String);\n  check(requesterUserId, String);\n\n  const eventName = 'EndAllBreakoutRoomsMsg';\n  return RedisPubSub.publishUserMessage(CHANNEL, eventName, meetingId, requesterUserId, null);\n}\n","import { Meteor } from 'meteor/meteor';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function requestJoinURL({ breakoutId, userId: userIdToInvite }) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const userId = userIdToInvite || requesterUserId;\n  const eventName = 'RequestBreakoutJoinURLReqMsg';\n\n  return RedisPubSub.publishUserMessage(\n    CHANNEL, eventName, meetingId, requesterUserId,\n    {\n      meetingId,\n      breakoutId,\n      userId,\n    },\n  );\n}\n","import Logger from '/imports/startup/server/logger';\nimport Breakouts from '/imports/api/breakouts';\n\nexport default function clearBreakouts(breakoutId) {\n  if (breakoutId) {\n    const selector = {\n      breakoutId,\n    };\n\n    try {\n      const numberAffected = Breakouts.remove(selector);\n\n      if (numberAffected) {\n        Logger.info(`Cleared Breakouts (${breakoutId})`);\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing Breakouts (${breakoutId})`);\n    }\n  } else {\n    try {\n      const numberAffected = Breakouts.remove({});\n      if (numberAffected) {\n        Logger.info('Cleared Breakouts (all)');\n      }\n    } catch (err) {\n      Logger.error('Error on clearing Breakouts (all)');\n    }\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handleBreakoutJoinURL from './handlers/breakoutJoinURL';\nimport handleBreakoutStarted from './handlers/breakoutStarted';\nimport handleUpdateTimeRemaining from './handlers/updateTimeRemaining';\nimport handleBreakoutClosed from './handlers/breakoutClosed';\nimport joinedUsersChanged from './handlers/joinedUsersChanged';\n\nRedisPubSub.on('BreakoutRoomStartedEvtMsg', handleBreakoutStarted);\nRedisPubSub.on('BreakoutRoomJoinURLEvtMsg', handleBreakoutJoinURL);\nRedisPubSub.on('RequestBreakoutJoinURLRespMsg', handleBreakoutJoinURL);\nRedisPubSub.on('BreakoutRoomsTimeRemainingUpdateEvtMsg', handleUpdateTimeRemaining);\nRedisPubSub.on('BreakoutRoomEndedEvtMsg', handleBreakoutClosed);\nRedisPubSub.on('UpdateBreakoutUsersEvtMsg', joinedUsersChanged);\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport createBreakoutRoom from '/imports/api/breakouts/server/methods/createBreakout';\nimport requestJoinURL from './methods/requestJoinURL';\nimport endAllBreakouts from './methods/endAllBreakouts';\n\nMeteor.methods({\n  requestJoinURL,\n  createBreakoutRoom,\n  endAllBreakouts,\n});\n","import { Meteor } from 'meteor/meteor';\nimport Breakouts from '/imports/api/breakouts';\nimport Users from '/imports/api/users';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nconst ROLE_MODERATOR = Meteor.settings.public.user.role_moderator;\n\nfunction breakouts(role) {\n  if (!this.userId) {\n    return Breakouts.find({ meetingId: '' });\n  }\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  Logger.debug('Publishing Breakouts', { meetingId, requesterUserId });\n\n  const User = Users.findOne({ userId: requesterUserId, meetingId }, { fields: { role: 1 } });\n  if (!!User && User.role === ROLE_MODERATOR) {\n    const presenterSelector = {\n      $or: [\n        { parentMeetingId: meetingId },\n        { breakoutId: meetingId },\n      ],\n    };\n\n    return Breakouts.find(presenterSelector);\n  }\n\n  const selector = {\n    $or: [\n      {\n        parentMeetingId: meetingId,\n        freeJoin: true,\n      },\n      {\n        parentMeetingId: meetingId,\n        'users.userId': requesterUserId,\n      },\n      {\n        breakoutId: meetingId,\n      },\n    ],\n  };\n\n  return Breakouts.find(selector);\n}\n\nfunction publish(...args) {\n  const boundBreakouts = breakouts.bind(this);\n  return boundBreakouts(...args);\n}\n\nMeteor.publish('breakouts', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst Breakouts = new Mongo.Collection('breakouts');\n\nif (Meteor.isServer) {\n  // types of queries for the breakouts:\n  // 1. breakoutId ( handleJoinUrl, roomStarted, clearBreakouts )\n  // 2. parentMeetingId ( updateTimeRemaining )\n\n  Breakouts._ensureIndex({ breakoutId: 1 });\n  Breakouts._ensureIndex({ parentMeetingId: 1 });\n}\n\nexport default Breakouts;\n","import { check } from 'meteor/check';\nimport fetchReadOnlyPadId from '/imports/api/captions/server/methods/fetchReadOnlyPadId';\n\nexport default function handlePadCreate({ body }) {\n  const { pad } = body;\n  const { id } = pad;\n\n  check(id, String);\n\n  fetchReadOnlyPadId(id);\n}\n","import { check } from 'meteor/check';\nimport { getDataFromChangeset } from '/imports/api/captions/server/helpers';\nimport updatePad from '/imports/api/captions/server/modifiers/updatePad';\n\nexport default function handlePadUpdate({ body }) {\n  const { pad, revs, changeset } = body;\n  const { id } = pad;\n\n  check(id, String);\n  check(changeset, String);\n  check(revs, Number);\n\n  const data = getDataFromChangeset(changeset);\n\n  if (data !== '') {\n    updatePad(id, data, revs);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\n\nexport default function addCaptionsPads(meetingId, padIds) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'AddCaptionsPadsSysMsg';\n\n  check(meetingId, String);\n  check(padIds, [String]);\n\n  const payload = {\n    padIds,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, 'nodeJSapp', payload);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport Captions from '/imports/api/captions';\nimport Logger from '/imports/startup/server/logger';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\n\nexport default function addPad(padId, readOnlyId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'AddPadSysMsg';\n\n  check(padId, String);\n  check(readOnlyId, String);\n\n  const pad = Captions.findOne({ padId });\n\n  if (!pad) {\n    Logger.error(`Could not find closed captions pad ${padId}`);\n    return;\n  }\n\n  const { meetingId } = pad;\n\n  check(meetingId, String);\n\n  const payload = {\n    padId,\n    readOnlyId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, 'nodeJSapp', payload);\n}\n","import axios from 'axios';\nimport { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport {\n  generatePadId,\n} from '/imports/api/captions/server/helpers';\nimport {\n  appendTextURL,\n} from '/imports/api/note/server/helpers';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function appendText(text, locale) {\n  const { meetingId } = extractCredentials(this.userId);\n  check(meetingId, String);\n  check(text, String);\n  check(locale, String);\n\n  const padId = generatePadId(meetingId, locale);\n\n  axios({\n    method: 'get',\n    url: appendTextURL(padId, text),\n    responseType: 'json',\n  }).then((response) => {\n    const { status } = response;\n    if (status !== 200) {\n      Logger.error(`Could not append captions for padId=${padId}`);\n      return;\n    }\n  }).catch(error => Logger.error(`Could not append captions for padId=${padId}: ${error}`));\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport {\n  generatePadId,\n  isEnabled,\n  getLocalesURL,\n} from '/imports/api/captions/server/helpers';\nimport addCaption from '/imports/api/captions/server/modifiers/addCaption';\nimport addCaptionsPads from '/imports/api/captions/server/methods/addCaptionsPads';\nimport axios from 'axios';\n\nexport default function createCaptions(meetingId) {\n  // Avoid captions creation if this feature is disabled\n  if (!isEnabled()) {\n    Logger.warn(`Captions are disabled for ${meetingId}`);\n    return;\n  }\n\n  check(meetingId, String);\n\n  axios({\n    method: 'get',\n    url: getLocalesURL(),\n    responseType: 'json',\n  }).then((response) => {\n    const { status } = response;\n    if (status !== 200) {\n      Logger.error(`Could not get locales info for ${meetingId} ${status}`);\n      return;\n    }\n    const padIds = [];\n    const locales = response.data;\n    locales.forEach((locale) => {\n      const padId = generatePadId(meetingId, locale.locale);\n      addCaption(meetingId, padId, locale);\n      padIds.push(padId);\n    });\n    addCaptionsPads(meetingId, padIds);\n  }).catch(error => Logger.error(`Could not create captions for ${meetingId}: ${error}`));\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport Captions from '/imports/api/captions';\nimport Logger from '/imports/startup/server/logger';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\n\nconst getIndex = (data, length) => length - data.length;\n\nexport default function editCaptions(padId, data) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'EditCaptionHistoryPubMsg';\n\n  check(padId, String);\n  check(data, String);\n\n  const pad = Captions.findOne({ padId });\n\n  if (!pad) {\n    Logger.error(`Editing captions history: ${padId}`);\n    return;\n  }\n\n  const {\n    meetingId,\n    ownerId,\n    locale,\n    length,\n  } = pad;\n\n  check(meetingId, String);\n  check(ownerId, String);\n  check(locale, { locale: String, name: String });\n  check(length, Number);\n\n  const index = getIndex(data, length);\n\n  const payload = {\n    startIndex: index,\n    localeCode: locale.locale,\n    locale: locale.name,\n    endIndex: index,\n    text: data,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, ownerId, payload);\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport {\n  getReadOnlyIdURL,\n  getDataFromResponse,\n} from '/imports/api/note/server/helpers';\nimport updateReadOnlyPadId from '/imports/api/captions/server/modifiers/updateReadOnlyPadId';\nimport axios from 'axios';\n\nexport default function fetchReadOnlyPadId(padId) {\n  check(padId, String);\n\n  const readOnlyURL = getReadOnlyIdURL(padId);\n\n  axios({\n    method: 'get',\n    url: readOnlyURL,\n    responseType: 'json',\n  }).then((response) => {\n    const { status } = response;\n    if (status !== 200) {\n      Logger.error(`Could not get closed captions readOnlyID for ${padId} ${status}`);\n      return;\n    }\n    const readOnlyPadId = getDataFromResponse(response.data, 'readOnlyID');\n    if (readOnlyPadId) {\n      updateReadOnlyPadId(padId, readOnlyPadId);\n    } else {\n      Logger.error(`Could not get pad readOnlyID for ${padId}`);\n    }\n  }).catch(error => Logger.error(`Could not get pad readOnlyID for ${padId}: ${error}`));\n}\n","import { check } from 'meteor/check';\nimport Captions from '/imports/api/captions';\nimport updateOwnerId from '/imports/api/captions/server/modifiers/updateOwnerId';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\nimport { CAPTIONS_TOKEN } from '/imports/api/captions/server/helpers';\n\nexport default function takeOwnership(locale) {\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(locale, String);\n\n  const pad = Captions.findOne({ meetingId, padId: { $regex: `${CAPTIONS_TOKEN}${locale}$` } });\n\n  if (pad) {\n    updateOwnerId(meetingId, requesterUserId, pad.padId);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport Captions from '/imports/api/captions';\nimport Logger from '/imports/startup/server/logger';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\n\nexport default function editCaptions(meetingId, userId, padId) { // TODO\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'UpdateCaptionOwnerPubMsg';\n\n  check(meetingId, String);\n  check(userId, String);\n  check(padId, String);\n\n  const pad = Captions.findOne({ meetingId, padId });\n\n  if (!pad) {\n    Logger.error(`Editing captions owner: ${padId}`);\n    return;\n  }\n\n  const { locale } = pad;\n\n  check(locale, { locale: String, name: String });\n\n  const payload = {\n    ownerId: userId,\n    locale: locale.name,\n    localeCode: locale.locale,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, userId, payload);\n}\n","import { check } from 'meteor/check';\nimport Captions from '/imports/api/captions';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function addCaption(meetingId, padId, locale) {\n  check(meetingId, String);\n  check(padId, String);\n  check(locale, {\n    locale: String,\n    name: String,\n  });\n\n  const selector = {\n    meetingId,\n    padId,\n  };\n\n  const modifier = {\n    meetingId,\n    padId,\n    locale,\n    ownerId: '',\n    readOnlyPadId: '',\n    data: '',\n    revs: 0,\n    length: 0,\n  };\n\n  try {\n    const { insertedId, numberAffected } = Captions.upsert(selector, modifier);\n\n    if (insertedId) {\n      Logger.verbose('Captions: added locale', { locale: locale.locale, meetingId });\n    } else if (numberAffected) {\n      Logger.verbose('Captions: upserted locale', { locale: locale.locale, meetingId });\n    }\n  } catch (err) {\n    Logger.error(`Adding caption to collection: ${err}`);\n  }\n}\n","import Captions from '/imports/api/captions';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearCaptions(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = Captions.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared Captions (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing captions (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = Captions.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared Captions (all)');\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing captions (all). ${err}`);\n    }\n  }\n}\n","import Captions from '/imports/api/captions';\nimport Logger from '/imports/startup/server/logger';\nimport updateOwner from '/imports/api/captions/server/methods/updateOwner';\nimport { check } from 'meteor/check';\n\nexport default function updateOwnerId(meetingId, userId, padId) {\n  check(meetingId, String);\n  check(userId, String);\n  check(padId, String);\n\n  const selector = {\n    meetingId,\n    padId,\n  };\n\n  const modifier = {\n    $set: {\n      ownerId: userId,\n    },\n  };\n\n  try {\n    const numberAffected = Captions.update(selector, modifier, { multi: true });\n\n    if (numberAffected) {\n      updateOwner(meetingId, userId, padId);\n      Logger.verbose('Captions: updated caption', { padId, ownerId: userId });\n    }\n  } catch (err) {\n    Logger.error('Captions: error while updating pad', { err });\n  }\n}\n","import Captions from '/imports/api/captions';\nimport Logger from '/imports/startup/server/logger';\nimport editCaptions from '/imports/api/captions/server/methods/editCaptions';\nimport { check } from 'meteor/check';\n\nexport default function updatePad(padId, data, revs) {\n  check(padId, String);\n  check(data, String);\n  check(revs, Number);\n\n  const selector = {\n    padId,\n  };\n\n  const modifier = {\n    $set: {\n      data,\n      revs,\n    },\n    $inc: {\n      length: data.length,\n    },\n  };\n\n  try {\n    const numberAffected = Captions.update(selector, modifier, { multi: true });\n\n    if (numberAffected) {\n      editCaptions(padId, data, revs);\n      Logger.verbose('Captions: updated pad', { padId, revs });\n    }\n  } catch (err) {\n    Logger.error(`Updating captions pad: ${err}`);\n  }\n}\n","import Captions from '/imports/api/captions';\nimport Logger from '/imports/startup/server/logger';\nimport { check } from 'meteor/check';\nimport addPad from '/imports/api/captions/server/methods/addPad';\n\nexport default function updateReadOnlyPadId(padId, readOnlyPadId) {\n  check(padId, String);\n  check(readOnlyPadId, String);\n\n  const selector = {\n    padId,\n  };\n\n  const modifier = {\n    $set: {\n      readOnlyPadId,\n    },\n  };\n\n  try {\n    const numberAffected = Captions.update(selector, modifier, { multi: true });\n\n    if (numberAffected) {\n      addPad(padId, readOnlyPadId);\n      Logger.verbose('Captions: added readOnlyPadId', { padId, readOnlyPadId });\n    }\n  } catch (err) {\n    Logger.error('Captions: error when adding readOnlyPadId', { err });\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { processForCaptionsPadOnly } from '/imports/api/captions/server/helpers';\nimport handlePadCreate from './handlers/padCreate';\nimport handlePadUpdate from './handlers/padUpdate';\n\nRedisPubSub.on('PadCreateSysMsg', processForCaptionsPadOnly(handlePadCreate));\nRedisPubSub.on('PadUpdateSysMsg', processForCaptionsPadOnly(handlePadUpdate));\n","import { Meteor } from 'meteor/meteor';\nimport { hashSHA1 } from '/imports/api/common/server/helpers';\nimport { check } from 'meteor/check';\n\nconst ETHERPAD = Meteor.settings.private.etherpad;\nconst CAPTIONS_CONFIG = Meteor.settings.public.captions;\nconst BASENAME = Meteor.settings.public.app.basename;\nconst APP = Meteor.settings.private.app;\nconst LOCALES_URL = `http://${APP.host}:${APP.port}${BASENAME}${APP.localesUrl}`;\nconst CAPTIONS_TOKEN = '_cc_';\nconst TOKEN = '$';\n\n// Captions padId should look like: {prefix}_cc_{locale}\nconst generatePadId = (meetingId, locale) => `${hashSHA1(meetingId+locale+ETHERPAD.apikey)}${CAPTIONS_TOKEN}${locale}`;\n\nconst isCaptionsPad = (padId) => {\n  const splitPadId = padId.split(CAPTIONS_TOKEN);\n  return splitPadId.length === 2;\n};\n\nconst getDataFromChangeset = (changeset) => {\n  const splitChangeset = changeset.split(TOKEN);\n  if (splitChangeset.length > 1) {\n    splitChangeset.shift();\n    return splitChangeset.join(TOKEN);\n  }\n  return '';\n};\n\nconst isEnabled = () => CAPTIONS_CONFIG.enabled;\n\nconst getLocalesURL = () => LOCALES_URL;\n\nconst processForCaptionsPadOnly = fn => (message, ...args) => {\n  const { body } = message;\n  const { pad } = body;\n  const { id } = pad;\n\n  check(id, String);\n\n  if (isCaptionsPad(id)) return fn(message, ...args);\n  return () => {};\n};\n\nexport {\n  CAPTIONS_TOKEN,\n  generatePadId,\n  processForCaptionsPadOnly,\n  isEnabled,\n  getLocalesURL,\n  getDataFromChangeset,\n};\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport takeOwnership from '/imports/api/captions/server/methods/takeOwnership';\nimport appendText from '/imports/api/captions/server/methods/appendText';\n\nMeteor.methods({\n  takeOwnership,\n  appendText,\n});\n","import Captions from '/imports/api/captions';\nimport { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction captions() {\n  if (!this.userId) {\n    return Captions.find({ meetingId: '' });\n  }\n  const { meetingId } = extractCredentials(this.userId);\n  Logger.debug('Publishing Captions', { meetingId });\n\n  return Captions.find({ meetingId });\n}\n\nfunction publish(...args) {\n  const boundCaptions = captions.bind(this);\n  return boundCaptions(...args);\n}\n\nMeteor.publish('captions', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst Captions = new Mongo.Collection('captions');\n\nif (Meteor.isServer) {\n  Captions._ensureIndex({ meetingId: 1, padId: 1 });\n}\n\nexport default Captions;\n","import { check } from 'meteor/check';\nimport CursorStreamer from '/imports/api/cursor/server/streamer';\nimport Logger from '/imports/startup/server/logger';\nimport _ from 'lodash';\n\nconst { streamerLog } = Meteor.settings.private.serverLog;\n\nconst CURSOR_PROCCESS_INTERVAL = 30;\n\nconst cursorQueue = {};\n\nconst proccess = _.throttle(() => {\n  try {\n    Object.keys(cursorQueue).forEach((meetingId) => {\n      try {\n        const cursors = cursorQueue[meetingId];\n        delete cursorQueue[meetingId];\n        CursorStreamer(meetingId).emit('message', { meetingId, cursors });\n\n        // if (streamerLog) {\n        //   Logger.debug('CursorUpdate process has finished', { meetingId });\n        // }\n      } catch (error) {\n        Logger.error(`Error while trying to send cursor streamer data for meeting ${meetingId}. ${error}`);\n      }\n    });\n  } catch (error) {\n    Logger.error(`Error while processing cursor queue. ${error}`);\n  }\n}, CURSOR_PROCCESS_INTERVAL);\n\nexport default function handleCursorUpdate({ header, body }, meetingId) {\n  const { userId } = header;\n  check(body, Object);\n\n  check(meetingId, String);\n  check(userId, String);\n\n  if (!cursorQueue[meetingId]) {\n    cursorQueue[meetingId] = {};\n  }\n\n  // overwrite since we dont care about the other positions\n  cursorQueue[meetingId][userId] = body;\n\n  proccess();\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { Meteor } from 'meteor/meteor';\n\nexport default function publishCursorUpdate(meetingId, requesterUserId, payload) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'SendCursorPositionPubMsg';\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handleCursorUpdate from './handlers/cursorUpdate';\n\nRedisPubSub.on('SendCursorPositionEvtMsg', handleCursorUpdate);\n","import './eventHandlers';\nimport './methods';\n","import { Meteor } from 'meteor/meteor';\nimport publishCursorUpdate from './methods/publishCursorUpdate';\n\nMeteor.methods({\n  publishCursorUpdate,\n});\n","import Logger from '/imports/startup/server/logger';\nimport publishCursorUpdate from './methods/publishCursorUpdate';\n\nconst { streamerLog } = Meteor.settings.private.serverLog;\n\nexport function removeCursorStreamer(meetingId) {\n  Logger.info(`Removing Cursor streamer object for meeting ${meetingId}`);\n  delete Meteor.StreamerCentral.instances[`cursor-${meetingId}`];\n}\n\nexport function addCursorStreamer(meetingId) {\n  const streamer = new Meteor.Streamer(`cursor-${meetingId}`, { retransmit: false });\n  if (streamerLog) {\n    Logger.debug('Cursor streamer created', { meetingId });\n  }\n\n  streamer.allowRead(function allowRead() {\n    if (streamerLog) {\n      Logger.debug('Cursor streamer called allowRead', { userId: this.userId, meetingId });\n    }\n    return this.userId && this.userId.includes(meetingId);\n  });\n\n  streamer.allowWrite(function allowWrite() {\n    return this.userId && this.userId.includes(meetingId);\n  });\n\n  streamer.on('publish', (message) => {\n    publishCursorUpdate(meetingId, message.userId, message.payload);\n  });\n}\n\nexport default function get(meetingId) {\n  return Meteor.StreamerCentral.instances[`cursor-${meetingId}`];\n}\n","import { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function destroyExternalVideo(meetingId) {\n  const streamName = `external-videos-${meetingId}`;\n\n  if (Meteor.StreamerCentral.instances[streamName]) {\n    Logger.info(`Destroying External Video streamer object for ${streamName}`);\n    delete Meteor.StreamerCentral.instances[streamName];\n  }\n}\n","import Users from '/imports/api/users';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function emitExternalVideoEvent(messageName, ...rest) {\n  const { meetingId, requesterUserId: userId } = extractCredentials(this.userId);\n\n  const user = Users.findOne({ userId, meetingId });\n\n  if (user && user.presenter) {\n    const streamerName = `external-videos-${meetingId}`;\n    const streamer = Meteor.StreamerCentral.instances[streamerName];\n\n    if (streamer) {\n      streamer.emit(messageName, ...rest);\n    } else {\n      Logger.error(`External Video Streamer not found for meetingId: ${meetingId} userId: ${userId}`);\n    }\n  }\n}\n","import { extractCredentials } from '/imports/api/common/server/helpers';\nimport Logger from '/imports/startup/server/logger';\n\nconst allowRecentMessages = (eventName, message) => {\n  const {\n    userId,\n    meetingId,\n    time,\n    rate,\n    state,\n  } = message;\n\n  Logger.debug('ExternalVideo Streamer auth allowed', {userId, meetingId, eventName, time, rate, state});\n  return true;\n};\n\nexport default function initializeExternalVideo() {\n  const { meetingId } = extractCredentials(this.userId);\n\n  const streamName = `external-videos-${meetingId}`;\n  if (!Meteor.StreamerCentral.instances[streamName]) {\n    const streamer = new Meteor.Streamer(streamName);\n    streamer.allowRead('all');\n    streamer.allowWrite('none');\n    streamer.allowEmit(allowRecentMessages);\n    Logger.info(`Created External Video streamer for ${streamName}`);\n  } else {\n    Logger.debug('External Video streamer is already created', { streamName });\n  }\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport Meetings from '/imports/api/meetings';\nimport Users from '/imports/api/users';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function startWatchingExternalVideo(options) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'StartExternalVideoMsg';\n\n  const { meetingId, requesterUserId: userId } = extractCredentials(this.userId);\n  const { externalVideoUrl } = options;\n\n  try {\n    check(meetingId, String);\n    check(userId, String);\n    check(externalVideoUrl, String);\n\n    const user = Users.findOne({ meetingId, userId, presenter: true }, { presenter: 1 });\n\n    if (!user) {\n      Logger.error(`Only presenters are allowed to start external video for a meeting. meeting=${meetingId} userId=${userId}`);\n      return;\n    }\n\n    Meetings.update({ meetingId }, { $set: { externalVideoUrl } });\n\n    const payload = { externalVideoUrl };\n\n    Logger.info(`User id=${userId} sharing an external video: ${externalVideoUrl} for meeting ${meetingId}`);\n\n    return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, userId, payload);\n  } catch (error) {\n    Logger.error(`Error on sharing an external video: ${externalVideoUrl} ${error}`);\n  }\n}\n","import { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport Meetings from '/imports/api/meetings';\nimport Users from '/imports/api/users';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function stopWatchingExternalVideo(options) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'StopExternalVideoMsg';\n\n  const { meetingId, requesterUserId } = this.userId ? extractCredentials(this.userId) : options;\n\n  try {\n    check(meetingId, String);\n    check(requesterUserId, String);\n\n    const user = Users.findOne({\n      meetingId,\n      userId: requesterUserId,\n      presenter: true,\n    }, { presenter: 1 });\n\n    if (this.userId && !user) {\n      Logger.error(`Only presenters are allowed to stop external video for a meeting. meeting=${meetingId} userId=${requesterUserId}`);\n      return;\n    }\n\n    const meeting = Meetings.findOne({ meetingId });\n    if (!meeting || meeting.externalVideoUrl === null) return;\n\n    Meetings.update({ meetingId }, { $set: { externalVideoUrl: null } });\n    const payload = {};\n\n    Logger.info(`User id=${requesterUserId} stopped sharing an external video for meeting=${meetingId}`);\n\n    RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n  } catch (error) {\n    Logger.error(`Error on stop sharing an external video for meeting=${meetingId} ${error}`);\n  }\n}\n","import './methods';\n\n","import { Meteor } from 'meteor/meteor';\nimport startWatchingExternalVideo from './methods/startWatchingExternalVideo';\nimport stopWatchingExternalVideo from './methods/stopWatchingExternalVideo';\nimport initializeExternalVideo from './methods/initializeExternalVideo';\nimport emitExternalVideoEvent from './methods/emitExternalVideoEvent';\n\nMeteor.methods({\n  initializeExternalVideo,\n  startWatchingExternalVideo,\n  stopWatchingExternalVideo,\n  emitExternalVideoEvent,\n});\n","import { check } from 'meteor/check';\nimport addGroupChat from '../modifiers/addGroupChat';\n\nexport default function handleGroupChatCreated({ body }, meetingId) {\n  check(meetingId, String);\n  check(body, Object);\n\n  addGroupChat(meetingId, body);\n}\n","import { check } from 'meteor/check';\nimport addGroupChat from '../modifiers/addGroupChat';\n\nexport default function handleGroupChatDestroyed({ body }, meetingId) {\n  check(meetingId, String);\n  check(body, Object);\n\n  addGroupChat(meetingId, body);\n}\n","import { check } from 'meteor/check';\nimport addGroupChat from '../modifiers/addGroupChat';\n\nexport default function handleGroupChats({ body }, meetingId) {\n  const { chats } = body;\n\n  check(meetingId, String);\n  check(chats, Array);\n\n  chats.forEach(chat => addGroupChat(meetingId, chat));\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { CHAT_ACCESS_PRIVATE } from '/imports/api/group-chat';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function createGroupChat(receiver) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'CreateGroupChatReqMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(receiver, Object);\n\n  const payload = {\n    correlationId: `${requesterUserId}-${Date.now()}`,\n    msg: [],\n    users: [receiver.userId],\n    access: CHAT_ACCESS_PRIVATE,\n    name: receiver.name,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function createGroupChat() {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const eventName = 'DestroyGroupChatReqMsg';\n\n  const payload = {\n    // TODO: Implement this together with #4988\n    // chats: Array[String],\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, eventName, meetingId, requesterUserId, payload);\n}\n","import flat from 'flat';\nimport { Match, check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport GroupChat from '/imports/api/group-chat';\n\nexport default function addGroupChat(meetingId, chat) {\n  check(meetingId, String);\n  check(chat, {\n    id: Match.Maybe(String),\n    chatId: Match.Maybe(String),\n    correlationId: Match.Maybe(String),\n    name: String,\n    access: String,\n    createdBy: Object,\n    users: Array,\n    msg: Match.Maybe(Array),\n  });\n\n  const chatDocument = {\n    meetingId,\n    chatId: chat.chatId || chat.id,\n    name: chat.name,\n    access: chat.access,\n    users: chat.users.map(u => u.id),\n    createdBy: chat.createdBy.id,\n  };\n\n  const selector = {\n    chatId: chatDocument.chatId,\n    meetingId,\n  };\n\n  const modifier = {\n    $set: flat(chatDocument, { safe: true }),\n  };\n\n  try {\n    const { insertedId } = GroupChat.upsert(selector, modifier);\n\n    if (insertedId) {\n      Logger.info(`Added group-chat name=${chat.name} meetingId=${meetingId}`);\n    } else {\n      Logger.info(`Upserted group-chat name=${chat.name} meetingId=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding group-chat to collection: ${err}`);\n  }\n}\n","import GroupChat from '/imports/api/group-chat';\nimport Logger from '/imports/startup/server/logger';\nimport clearGroupChatMsg from '/imports/api/group-chat-msg/server/modifiers/clearGroupChatMsg';\n\nexport default function clearGroupChat(meetingId) {\n  try {\n    clearGroupChatMsg(meetingId);\n    const numberAffected = GroupChat.remove({ meetingId });\n\n    if (numberAffected) {\n      Logger.info(`Cleared GroupChat (${meetingId})`);\n    }\n  } catch (err) {\n    Logger.error(`Error on clearing GroupChat (${meetingId}). ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handleGroupChats from './handlers/groupChats';\nimport handleGroupChatCreated from './handlers/groupChatCreated';\nimport handleGroupChatDestroyed from './handlers/groupChatDestroyed';\nimport { processForHTML5ServerOnly } from '/imports/api/common/server/helpers';\n\nRedisPubSub.on('GetGroupChatsRespMsg', processForHTML5ServerOnly(handleGroupChats));\nRedisPubSub.on('GroupChatCreatedEvtMsg', handleGroupChatCreated);\nRedisPubSub.on('GroupChatDestroyedEvtMsg', handleGroupChatDestroyed);\nRedisPubSub.on('SyncGetGroupChatsRespMsg', handleGroupChats);\n","import '/imports/api/group-chat-msg/server';\nimport './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport createGroupChat from './methods/createGroupChat';\nimport destroyGroupChat from './methods/destroyGroupChat';\n\nMeteor.methods({\n  createGroupChat,\n  destroyGroupChat,\n});\n","import GroupChat from '/imports/api/group-chat';\nimport { Meteor } from 'meteor/meteor';\n\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction groupChat() {\n  if (!this.userId) {\n    return GroupChat.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const CHAT_CONFIG = Meteor.settings.public.chat;\n  const PUBLIC_CHAT_TYPE = CHAT_CONFIG.type_public;\n\n  Logger.debug('Publishing group-chat', { meetingId, requesterUserId });\n\n  return GroupChat.find({\n    $or: [\n      { meetingId, access: PUBLIC_CHAT_TYPE },\n      { meetingId, users: { $all: [requesterUserId] } },\n    ],\n\n  });\n}\n\nfunction publish(...args) {\n  const boundGroupChat = groupChat.bind(this);\n  return boundGroupChat(...args);\n}\n\nMeteor.publish('group-chat', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst GroupChat = new Mongo.Collection('group-chat');\n\nif (Meteor.isServer) {\n  GroupChat._ensureIndex({\n    meetingId: 1, chatId: 1, access: 1, users: 1,\n  });\n}\n\nexport default GroupChat;\n\nconst CHAT_ACCESS = {\n  PUBLIC: 'PUBLIC_ACCESS',\n  PRIVATE: 'PRIVATE_ACCESS',\n};\n\nexport const CHAT_ACCESS_PUBLIC = CHAT_ACCESS.PUBLIC;\nexport const CHAT_ACCESS_PRIVATE = CHAT_ACCESS.PRIVATE;\n","import { check } from 'meteor/check';\nimport clearGroupChatMsg from '../modifiers/clearGroupChatMsg';\n\nexport default function clearPublicChatHistory({ header, body }) {\n  const { meetingId } = header;\n  const { chatId } = body;\n\n  check(meetingId, String);\n  check(chatId, String);\n\n  return clearGroupChatMsg(meetingId, chatId);\n}\n","import { check } from 'meteor/check';\nimport _ from 'lodash';\nimport addGroupChatMsg from '../modifiers/addGroupChatMsg';\nimport addBulkGroupChatMsgs from '../modifiers/addBulkGroupChatMsgs';\n\nconst { bufferChatInsertsMs } = Meteor.settings.public.chat;\n\nconst msgBuffer = [];\n\nconst bulkFn = _.throttle(addBulkGroupChatMsgs, bufferChatInsertsMs);\n\nexport default function handleGroupChatMsgBroadcast({ body }, meetingId) {\n  const { chatId, msg } = body;\n\n  check(meetingId, String);\n  check(chatId, String);\n  check(msg, Object);\n\n  if (bufferChatInsertsMs) {\n    msgBuffer.push({ meetingId, chatId, msg });\n    bulkFn(msgBuffer);\n  } else {\n    addGroupChatMsg(meetingId, chatId, msg);\n  }\n}\n","import { Match, check } from 'meteor/check';\nimport syncMeetingChatMsgs from '../modifiers/syncMeetingChatMsgs';\n\nexport default function handleSyncGroupChat({ body }, meetingId) {\n  const { chatId, msgs } = body;\n\n  check(meetingId, String);\n  check(chatId, String);\n  check(msgs, Match.Maybe(Array));\n\n  syncMeetingChatMsgs(meetingId, chatId, msgs);\n}\n","import { check } from 'meteor/check';\nimport startTyping from '../modifiers/startTyping';\n\nexport default function handleUserTyping({ body }, meetingId) {\n  const { chatId, userId } = body;\n\n  check(meetingId, String);\n  check(userId, String);\n  check(chatId, String);\n\n  startTyping(meetingId, userId, chatId);\n}\n","import { Meteor } from 'meteor/meteor';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function clearPublicChatHistory() {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'ClearPublicChatHistoryPubMsg';\n  const CHAT_CONFIG = Meteor.settings.public.chat;\n  const PUBLIC_GROUP_CHAT_ID = CHAT_CONFIG.public_group_id;\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const payload = {\n    chatId: PUBLIC_GROUP_CHAT_ID,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport RegexWebUrl from '/imports/utils/regex-weburl';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nconst HTML_SAFE_MAP = {\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n};\n\nconst parseMessage = (message) => {\n  let parsedMessage = message || '';\n  parsedMessage = parsedMessage.trim();\n\n  // Replace <br/> with \\n\\r\n  parsedMessage = parsedMessage.replace(/<br\\s*[\\\\/]?>/gi, '\\n\\r');\n\n  // Sanitize. See: http://shebang.brandonmintern.com/foolproof-html-escaping-in-javascript/\n  parsedMessage = parsedMessage.replace(/[<>'\"]/g, c => HTML_SAFE_MAP[c]);\n\n  // Replace flash links to flash valid ones\n  parsedMessage = parsedMessage.replace(RegexWebUrl, \"<a href='event:$&'><u>$&</u></a>\");\n\n  return parsedMessage;\n};\n\nexport default function sendGroupChatMsg(chatId, message) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'SendGroupChatMessageMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(message, Object);\n\n  const parsedMessage = parseMessage(message.message);\n\n  message.message = parsedMessage;\n\n  const payload = {\n    msg: message,\n    chatId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function startUserTyping(chatId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'UserTypingPubMsg';\n  const CHAT_CONFIG = Meteor.settings.public.chat;\n  const PUBLIC_GROUP_CHAT_ID = CHAT_CONFIG.public_group_id;\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(chatId, String);\n\n  const payload = {\n    chatId: chatId || PUBLIC_GROUP_CHAT_ID,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { UsersTyping } from '/imports/api/group-chat-msg';\nimport stopTyping from '../modifiers/stopTyping';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function stopUserTyping() {\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const userTyping = UsersTyping.findOne({\n    meetingId,\n    userId: requesterUserId,\n  });\n\n  if (userTyping && meetingId && requesterUserId) {\n    stopTyping(meetingId, requesterUserId, true);\n  }\n}\n","import { GroupChatMsg } from '/imports/api/group-chat-msg';\nimport Logger from '/imports/startup/server/logger';\nimport flat from 'flat';\nimport { parseMessage } from './addGroupChatMsg';\n\nexport default async function addBulkGroupChatMsgs(msgs) {\n  if (!msgs.length) return;\n\n  const mappedMsgs = msgs\n    .map(({ chatId, meetingId, msg }) => ({\n      _id: new Mongo.ObjectID()._str,\n      ...msg,\n      meetingId,\n      chatId,\n      message: parseMessage(msg.message),\n      sender: msg.sender.id,\n    }))\n    .map(el => flat(el, { safe: true }));\n\n  try {\n    const { insertedCount } = await GroupChatMsg.rawCollection().insertMany(mappedMsgs);\n    msgs.length = 0;\n\n    if (insertedCount) {\n      Logger.info(`Inserted ${insertedCount} messages`);\n    }\n  } catch (err) {\n    Logger.error(`Error on bulk insert. ${err}`);\n  }\n}\n","import flat from 'flat';\nimport { Match, check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport { GroupChatMsg } from '/imports/api/group-chat-msg';\nimport { BREAK_LINE } from '/imports/utils/lineEndings';\n\nexport function parseMessage(message) {\n  let parsedMessage = message || '';\n\n  // Replace \\r and \\n to <br/>\n  parsedMessage = parsedMessage.replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, `$1${BREAK_LINE}$2`);\n\n  // Replace flash links to html valid ones\n  parsedMessage = parsedMessage.split('<a href=\\'event:').join('<a target=\"_blank\" href=\\'');\n  parsedMessage = parsedMessage.split('<a href=\"event:').join('<a target=\"_blank\" href=\"');\n\n  return parsedMessage;\n}\n\nexport default function addGroupChatMsg(meetingId, chatId, msg) {\n  check(meetingId, String);\n  check(chatId, String);\n  check(msg, {\n    id: Match.Maybe(String),\n    timestamp: Number,\n    sender: Object,\n    color: String,\n    message: String,\n    correlationId: Match.Maybe(String),\n  });\n\n  const msgDocument = {\n    ...msg,\n    meetingId,\n    chatId,\n    message: parseMessage(msg.message),\n    sender: msg.sender.id,\n  };\n\n  const modifier = flat(msgDocument, { safe: true });\n\n  try {\n    const insertedId = GroupChatMsg.insert(modifier);\n\n    if (insertedId) {\n      Logger.info(`Added group-chat-msg msgId=${msg.id} chatId=${chatId} meetingId=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Error on adding group-chat-msg to collection: ${err}`);\n  }\n}\n","import { GroupChatMsg } from '/imports/api/group-chat-msg';\nimport Logger from '/imports/startup/server/logger';\nimport addGroupChatMsg from '/imports/api/group-chat-msg/server/modifiers/addGroupChatMsg';\n\nexport default function clearGroupChatMsg(meetingId, chatId) {\n  const CHAT_CONFIG = Meteor.settings.public.chat;\n  const PUBLIC_CHAT_SYSTEM_ID = CHAT_CONFIG.system_userid;\n  const PUBLIC_GROUP_CHAT_ID = CHAT_CONFIG.public_group_id;\n  const CHAT_CLEAR_MESSAGE = CHAT_CONFIG.system_messages_keys.chat_clear;\n\n  if (chatId) {\n    try {\n      const numberAffected = GroupChatMsg.remove({ meetingId, chatId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared GroupChatMsg (${meetingId}, ${chatId})`);\n        const clearMsg = {\n          color: '0',\n          timestamp: Date.now(),\n          correlationId: `${PUBLIC_CHAT_SYSTEM_ID}-${Date.now()}`,\n          sender: {\n            id: PUBLIC_CHAT_SYSTEM_ID,\n            name: '',\n          },\n          message: CHAT_CLEAR_MESSAGE,\n        };\n        addGroupChatMsg(meetingId, PUBLIC_GROUP_CHAT_ID, clearMsg);\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing GroupChat (${meetingId}, ${chatId}). ${err}`);\n    }\n    return true;\n  }\n\n  if (meetingId) {\n    try {\n      const numberAffected = GroupChatMsg.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared GroupChatMsg (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing GroupChatMsg (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = GroupChatMsg.remove({ chatId: { $eq: PUBLIC_GROUP_CHAT_ID } });\n\n      if (numberAffected) {\n        Logger.info('Cleared GroupChatMsg (all)');\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing GroupChatMsg (all). ${err}`);\n    }\n  }\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\nimport { UsersTyping } from '/imports/api/group-chat-msg';\nimport stopTyping from './stopTyping';\n\nconst TYPING_TIMEOUT = 5000;\n\nexport default function startTyping(meetingId, userId, chatId) {\n  check(meetingId, String);\n  check(userId, String);\n\n  const selector = {\n    meetingId,\n    userId,\n  };\n\n  const user = Users.findOne(selector, { fields: { name: 1, role: 1 } });\n\n  const modifier = {\n    meetingId,\n    userId,\n    name: user.name,\n    isTypingTo: chatId,\n    role: user.role,\n    time: (new Date()),\n  };\n\n  const typingUser = UsersTyping.findOne(selector, {\n    fields: {\n      time: 1,\n    },\n  });\n\n  if (typingUser) {\n    if (modifier.time - typingUser.time <= TYPING_TIMEOUT - 100) return;\n  }\n\n  try {\n    const { numberAffected } = UsersTyping.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.debug('Typing indicator update', { userId, chatId });\n      Meteor.setTimeout(() => {\n        stopTyping(meetingId, userId);\n      }, TYPING_TIMEOUT);\n    }\n  } catch (err) {\n    Logger.error(`Typing indicator update error: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport { UsersTyping } from '/imports/api/group-chat-msg';\n\nexport default function stopTyping(meetingId, userId, sendMsgInitiated = false) {\n  check(meetingId, String);\n  check(userId, String);\n  check(sendMsgInitiated, Boolean);\n\n  const selector = {\n    meetingId,\n    userId,\n  };\n\n  const user = UsersTyping.findOne(selector);\n  const stillTyping = !sendMsgInitiated && user && (new Date()) - user.time < 3000;\n  if (stillTyping) return;\n\n  try {\n    const numberAffected = UsersTyping.remove(selector);\n\n    if (numberAffected) {\n      Logger.debug('Stopped typing indicator', { userId });\n    }\n  } catch (err) {\n    Logger.error(`Stop user=${userId} typing indicator error: ${err}`);\n  }\n}\n","import { Match, check } from 'meteor/check';\nimport flat from 'flat';\nimport { GroupChatMsg } from '/imports/api/group-chat-msg';\nimport Logger from '/imports/startup/server/logger';\nimport { parseMessage } from './addGroupChatMsg';\n\nexport default function syncMeetingChatMsgs(meetingId, chatId, msgs) {\n  if (!msgs.length) return;\n\n  check(meetingId, String);\n  check(chatId, String);\n  check(msgs, Match.Maybe(Array));\n\n  try {\n    const bulkOperations = GroupChatMsg.rawCollection().initializeOrderedBulkOp();\n\n    msgs\n      .forEach((msg) => {\n        const msgToSync = {\n          ...msg,\n          meetingId,\n          chatId,\n          message: parseMessage(msg.message),\n          sender: msg.sender.id,\n        };\n\n        const modifier = flat(msgToSync, { safe: true });\n\n        bulkOperations\n          .find({ chatId, meetingId, id: msg.id })\n          .upsert()\n          .updateOne({\n            $setOnInsert: { _id: new Mongo.ObjectID()._str },\n            $set: { ...modifier },\n          });\n      });\n\n    bulkOperations.execute();\n\n    Logger.info('Chat messages synchronized', { chatId, meetingId });\n  } catch (err) {\n    Logger.error(`Error on sync chat messages: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handleGroupChatMsgBroadcast from './handlers/groupChatMsgBroadcast';\nimport handleClearPublicGroupChat from './handlers/clearPublicGroupChat';\nimport handleUserTyping from './handlers/userTyping';\nimport handleSyncGroupChatMsg from './handlers/syncGroupsChat';\nimport { processForHTML5ServerOnly } from '/imports/api/common/server/helpers';\n\nRedisPubSub.on('GetGroupChatMsgsRespMsg', processForHTML5ServerOnly(handleSyncGroupChatMsg));\nRedisPubSub.on('GroupChatMessageBroadcastEvtMsg', handleGroupChatMsgBroadcast);\nRedisPubSub.on('ClearPublicChatHistoryEvtMsg', handleClearPublicGroupChat);\nRedisPubSub.on('SyncGetGroupChatMsgsRespMsg', handleSyncGroupChatMsg);\nRedisPubSub.on('UserTypingEvtMsg', handleUserTyping);\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport sendGroupChatMsg from './methods/sendGroupChatMsg';\nimport clearPublicChatHistory from './methods/clearPublicChatHistory';\nimport startUserTyping from './methods/startUserTyping';\nimport stopUserTyping from './methods/stopUserTyping';\n\nMeteor.methods({\n  sendGroupChatMsg,\n  clearPublicChatHistory,\n  startUserTyping,\n  stopUserTyping,\n});\n","import { GroupChatMsg, UsersTyping } from '/imports/api/group-chat-msg';\nimport { Meteor } from 'meteor/meteor';\n\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction groupChatMsg(chatsIds) {\n  if (!this.userId) {\n    return GroupChatMsg.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const CHAT_CONFIG = Meteor.settings.public.chat;\n  const PUBLIC_GROUP_CHAT_ID = CHAT_CONFIG.public_group_id;\n\n  Logger.debug('Publishing group-chat-msg', { meetingId, requesterUserId });\n\n  return GroupChatMsg.find({\n    $or: [\n      { meetingId, chatId: { $eq: PUBLIC_GROUP_CHAT_ID } },\n      { chatId: { $in: chatsIds } },\n    ],\n  });\n}\n\nfunction publish(...args) {\n  const boundGroupChat = groupChatMsg.bind(this);\n  return boundGroupChat(...args);\n}\n\nMeteor.publish('group-chat-msg', publish);\n\nfunction usersTyping() {\n  if (!this.userId) {\n    return UsersTyping.find({ meetingId: '' });\n  }\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing users-typing', { meetingId, requesterUserId });\n\n  return UsersTyping.find({ meetingId });\n}\n\nfunction pubishUsersTyping(...args) {\n  const boundUsersTyping = usersTyping.bind(this);\n  return boundUsersTyping(...args);\n}\n\nMeteor.publish('users-typing', pubishUsersTyping);\n","import { Meteor } from 'meteor/meteor';\n\nconst GroupChatMsg = new Mongo.Collection('group-chat-msg');\nconst UsersTyping = new Mongo.Collection('users-typing');\n\nif (Meteor.isServer) {\n  GroupChatMsg._ensureIndex({ meetingId: 1, chatId: 1 });\n  UsersTyping._ensureIndex({ meetingId: 1, isTypingTo: 1 });\n}\n\nexport { GroupChatMsg, UsersTyping };\n","import { check } from 'meteor/check';\nimport setGuestStatus from '../modifiers/setGuestStatus';\n\nexport default function handleGuestApproved({ body }, meetingId) {\n  const { approvedBy, guests } = body;\n  check(meetingId, String);\n  check(approvedBy, String);\n  check(guests, Array);\n\n  return guests.forEach(guest => setGuestStatus(meetingId, guest.guest, guest.status, approvedBy));\n}\n","import stringHash from 'string-hash';\nimport { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport GuestUsers from '/imports/api/guest-users/';\n\nconst COLOR_LIST = [\n  '#7b1fa2', '#6a1b9a', '#4a148c', '#5e35b1', '#512da8', '#4527a0',\n  '#311b92', '#3949ab', '#303f9f', '#283593', '#1a237e', '#1976d2', '#1565c0',\n  '#0d47a1', '#0277bd', '#01579b',\n];\n\nexport default function handleGuestsWaitingForApproval({ body }, meetingId) {\n  const { guests } = body;\n  check(guests, Array);\n  check(meetingId, String);\n\n  return guests.map((guest) => {\n    try {\n      const { insertedId, numberAffected } = GuestUsers.upsert({\n        meetingId,\n        intId: guest.intId,\n      }, {\n        approved: false,\n        denied: false,\n        ...guest,\n        meetingId,\n        loginTime: new Date().getTime(),\n        color: COLOR_LIST[stringHash(guest.intId) % COLOR_LIST.length],\n      });\n\n      if (insertedId) {\n        Logger.info(`Added guest user meeting=${meetingId}`);\n      } else if (numberAffected) {\n        Logger.info(`Upserted guest user meeting=${meetingId}`);\n      }\n    } catch (err) {\n      Logger.error(`Adding guest user to collection: ${err}`);\n    }\n  });\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nconst REDIS_CONFIG = Meteor.settings.private.redis;\nconst CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\nconst EVENT_NAME = 'GuestsWaitingApprovedMsg';\n\nexport default function allowPendingUsers(guests, status) {\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(guests, Array);\n  const mappedGuests = guests.map(guest => ({ status, guest: guest.intId }));\n\n  const payload = {\n    approvedBy: requesterUserId,\n    guests: mappedGuests,\n  };\n\n  Logger.info(`User=${requesterUserId} ${status} guests ${JSON.stringify(mappedGuests)}`);\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nconst REDIS_CONFIG = Meteor.settings.private.redis;\nconst CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\nconst EVENT_NAME = 'SetGuestPolicyCmdMsg';\n\nexport default function changeGuestPolicy(policyRule) {\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(policyRule, String);\n\n  const payload = {\n    setBy: requesterUserId,\n    policy: policyRule,\n  };\n\n  Logger.info(`User=${requesterUserId} change guest policy to ${policyRule}`);\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import GuestUsers from '/imports/api/guest-users';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearGuestUsers(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = GuestUsers.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared GuestUsers in (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.info(`Error on clearing GuestUsers in (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = GuestUsers.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared GuestUsers in all meetings');\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing GuestUsers in all meetings. ${err}`);\n    }\n  }\n}\n","import { check } from 'meteor/check';\nimport GuestUsers from '/imports/api/guest-users';\nimport Logger from '/imports/startup/server/logger';\n\nconst GUEST_STATUS_ALLOW = 'ALLOW';\nconst GUEST_STATUS_DENY = 'DENY';\nexport default function setGuestStatus(meetingId, intId, status, approvedBy = null) {\n  check(meetingId, String);\n  check(intId, String);\n  check(status, String);\n\n  const selector = {\n    meetingId,\n    intId,\n  };\n\n  const modifier = {\n    $set: {\n      approved: status === GUEST_STATUS_ALLOW,\n      denied: status === GUEST_STATUS_DENY,\n      approvedBy,\n    },\n  };\n\n  try {\n    const numberAffected = GuestUsers.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Updated status=${status} user=${intId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Updating status=${status} user=${intId}: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { processForHTML5ServerOnly } from '/imports/api/common/server/helpers';\nimport handleGuestApproved from './handlers/guestApproved';\nimport handleGuestsWaitingForApproval from './handlers/guestsWaitingForApproval';\n\nRedisPubSub.on('GuestsWaitingForApprovalEvtMsg', processForHTML5ServerOnly(handleGuestsWaitingForApproval));\nRedisPubSub.on('GuestsWaitingApprovedEvtMsg', processForHTML5ServerOnly(handleGuestApproved));\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport allowPendingUsers from '/imports/api/guest-users/server/methods/allowPendingUsers';\nimport changeGuestPolicy from '/imports/api/guest-users/server/methods/changeGuestPolicy';\n\nMeteor.methods({\n  allowPendingUsers,\n  changeGuestPolicy,\n});\n","import GuestUsers from '/imports/api/guest-users/';\nimport { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction guestUsers() {\n  if (!this.userId) {\n    return GuestUsers.find({ meetingId: '' });\n  }\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.info(`Publishing Slides for ${meetingId} ${requesterUserId}`);\n\n  return GuestUsers.find({ meetingId });\n}\n\nfunction publish(...args) {\n  const boundSlides = guestUsers.bind(this);\n  return boundSlides(...args);\n}\n\nMeteor.publish('guestUser', publish);\n","import { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\n\nconst GuestUsers = new Mongo.Collection('guestUsers');\n\nexport default GuestUsers;\n","import _ from 'lodash';\nimport { check } from 'meteor/check';\nimport LocalSettings from '/imports/api/local-settings';\nimport setChangedLocalSettings from '../modifiers/setChangedLocalSettings';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function userChangedLocalSettings(settings) {\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  if (!meetingId || !requesterUserId) return;\n\n  check(settings, Object);\n\n  const userLocalSettings = LocalSettings\n    .findOne({ meetingId, userId: requesterUserId },\n      {\n        fields: { settings: 1 },\n      });\n\n  if (!userLocalSettings || !_.isEqual(userLocalSettings.settings, settings)) {\n    setChangedLocalSettings(meetingId, requesterUserId, settings);\n  }\n}\n","import LocalSettings from '/imports/api/local-settings';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearLocalSettings(meetingId) {\n  try {\n    const numberAffected = LocalSettings.remove({ meetingId });\n\n    if (numberAffected) {\n      Logger.info(`Cleared Local Settings (${meetingId})`);\n    }\n  } catch (err) {\n    Logger.error(`Error on clearing Local Settings (${meetingId}). ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport LocalSettings from '/imports/api/local-settings';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function setChangedLocalSettings(meetingId, userId, settings) {\n  check(meetingId, String);\n  check(userId, String);\n  check(settings, Object);\n\n  const selector = {\n    meetingId,\n    userId,\n  };\n\n  const modifier = {\n    $set: {\n      settings,\n    },\n  };\n\n  try {\n    const { numChanged } = LocalSettings.upsert(selector, modifier);\n\n    if (numChanged) {\n      Logger.info(`Updated settings for user ${userId} on meeting ${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Error on update settings. ${err}`);\n  }\n}\n","import './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport userChangedLocalSettings from './methods/userChangedLocalSettings';\n\nMeteor.methods({\n  userChangedLocalSettings,\n});\n","import { Meteor } from 'meteor/meteor';\nimport LocalSettings from '/imports/api/local-settings';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction localSettings() {\n  if (!this.userId) {\n    return LocalSettings.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing local settings', { requesterUserId });\n\n  return LocalSettings.find({ meetingId, userId: requesterUserId });\n}\n\nfunction publish(...args) {\n  const boundLocalSettings = localSettings.bind(this);\n  return boundLocalSettings(...args);\n}\n\nMeteor.publish('local-settings', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst LocalSettings = new Mongo.Collection('local-settings');\n\nif (Meteor.isServer) {\n  LocalSettings._ensureIndex({\n    meetingId: 1, userId: 1,\n  });\n}\n\nexport default LocalSettings;\n","import Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\n\nconst logClient = function (type, logDescription, logCode = 'was_not_provided', extraInfo = {}, userInfo = {}) {\n  const connectionId = this.connection.id;\n  const User = Users.findOne({ connectionId });\n  const logContents = {\n    logCode,\n    logDescription,\n    connectionId,\n    extraInfo,\n    userInfo,\n  };\n\n  if (User) { // TODO--\n    if ((userInfo.credentials && User.meetingId === userInfo.credentials.meetingId)\n      || ((userInfo.meetingId && User.meetingId === userInfo.meetingId))) {\n      logContents.extraInfo.validUser = 'valid';\n    } else {\n      logContents.extraInfo.validUser = 'invalid';\n    }\n  } else {\n    logContents.extraInfo.validUser = 'notFound';\n  }\n\n  // If I don't pass message, logs will start with `undefined`\n  Logger.log({ message: JSON.stringify(logContents), level: type });\n  // Logger.log({ message: 'client->server', level: type, logContents });\n};\n\nexport default logClient;\n","import './methods';\n","import { Meteor } from 'meteor/meteor';\nimport logClient from './methods/logClient';\n\nMeteor.methods({ logClient });\n","import handleMeetingCreation from './meetingCreation';\n\nexport default function handleGetAllMeetings({ body }) {\n  return handleMeetingCreation({ body });\n}\n","import { check } from 'meteor/check';\nimport addMeeting from '../modifiers/addMeeting';\n\nexport default function handleMeetingCreation({ body }) {\n  const meeting = body.props;\n  const durationInSecods = (meeting.durationProps.duration * 60);\n  meeting.durationProps.timeRemaining = durationInSecods;\n  check(meeting, Object);\n\n  return addMeeting(meeting);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { check } from 'meteor/check';\n\nimport destroyExternalVideo from '/imports/api/external-videos/server/methods/destroyExternalVideo';\nimport { removeAnnotationsStreamer } from '/imports/api/annotations/server/streamer';\nimport { removeCursorStreamer } from '/imports/api/cursor/server/streamer';\n\nexport default function handleMeetingDestruction({ body }) {\n  check(body, Object);\n  const { meetingId } = body;\n  check(meetingId, String);\n\n  destroyExternalVideo(meetingId);\n  removeAnnotationsStreamer(meetingId);\n  removeCursorStreamer(meetingId);\n\n  return RedisPubSub.destroyMeetingQueue(meetingId);\n}\n","import { check } from 'meteor/check';\nimport meetingHasEnded from '../modifiers/meetingHasEnded';\nimport Meetings from '/imports/api/meetings';\nimport Breakouts from '/imports/api/breakouts';\nimport Users from '/imports/api/users/';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function handleMeetingEnd({ body }) {\n  check(body, Object);\n  const { meetingId } = body;\n  check(meetingId, String);\n\n  const cb = (err, num, meetingType) => {\n    if (err) {\n      Logger.error(`${meetingType} ending error: ${err}`);\n      return;\n    }\n    if (num) {\n      Users.update({ meetingId },\n        { $set: { connectionStatus: 'offline' } },\n        (error, numAffected) => {\n          if (error) {\n            Logger.error(`Error marking ending ${meetingType} users as offline: ${meetingId} ${err}`);\n            return;\n          }\n\n          if (numAffected) {\n            Logger.info(`Success marking ending ${meetingType} users as offline: ${meetingId}`);\n          }\n        });\n      Meteor.setTimeout(() => { meetingHasEnded(meetingId); }, 10000);\n    }\n  };\n\n  Meetings.update({ meetingId },\n    { $set: { meetingEnded: true } },\n    (err, num) => { cb(err, num, 'Meeting'); });\n\n  Breakouts.update({ parentMeetingId: meetingId },\n    { $set: { meetingEnded: true } },\n    (err, num) => { cb(err, num, 'Breakout'); });\n}\n","import changeLockSettings from '../modifiers/changeLockSettings';\n\nexport default function handleLockSettingsInMeeting({ body }, meetingId) {\n  changeLockSettings(meetingId, body);\n}\n","import { check } from 'meteor/check';\nimport { RecordMeetings } from '/imports/api/meetings';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function handleRecordingStatusChange({ body }, meetingId) {\n  const { recording } = body;\n  check(recording, Boolean);\n\n  const selector = {\n    meetingId,\n  };\n\n  const modifier = {\n    $set: { recording },\n  };\n\n  try {\n    const { numberAffected } = RecordMeetings.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Changed meeting record status id=${meetingId} recording=${recording}`);\n    }\n  } catch (err) {\n    Logger.error(`Changing record status: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport { RecordMeetings } from '/imports/api/meetings';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function handleRecordingTimerChange({ body }, meetingId) {\n  const { time } = body;\n\n  check(meetingId, String);\n\n  check(body, {\n    time: Number,\n  });\n\n  const selector = {\n    meetingId,\n  };\n\n  const modifier = {\n    $set: { time },\n  };\n\n  try {\n    RecordMeetings.upsert(selector, modifier);\n  } catch (err) {\n    Logger.error(`Changing recording time: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport { MeetingTimeRemaining } from '/imports/api/meetings';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function handleTimeRemainingUpdate({ body }, meetingId) {\n  check(meetingId, String);\n\n  check(body, {\n    timeLeftInSec: Number,\n  });\n  const { timeLeftInSec } = body;\n\n  const selector = {\n    meetingId,\n  };\n\n  const modifier = {\n    $set: {\n      timeRemaining: timeLeftInSec,\n    },\n  };\n\n  try {\n    MeetingTimeRemaining.upsert(selector, modifier);\n  } catch (err) {\n    Logger.error(`Changing recording time: ${err}`);\n  }\n}\n","import changeUserLock from '../modifiers/changeUserLock';\n\nexport default function handleLockSettingsInMeeting({ body }, meetingId) {\n  changeUserLock(meetingId, body);\n}\n","import changeWebcamOnlyModerator from '../modifiers/webcamOnlyModerator';\n\nexport default function handleChangeWebcamOnlyModerator({ body }, meetingId) {\n  changeWebcamOnlyModerator(meetingId, body);\n}\n","import { Meteor } from 'meteor/meteor';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function endMeeting() {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'LogoutAndEndMeetingCmdMsg';\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const payload = {\n    userId: requesterUserId,\n  };\n  Logger.warn(`Meeting '${meetingId}' is destroyed by '${requesterUserId}'`);\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function toggleLockSettings(lockSettingsProps) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'ChangeLockSettingsInMeetingCmdMsg';\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(lockSettingsProps, {\n    disableCam: Boolean,\n    disableMic: Boolean,\n    disablePrivateChat: Boolean,\n    disablePublicChat: Boolean,\n    disableNote: Boolean,\n    hideUserList: Boolean,\n    lockedLayout: Boolean,\n    lockOnJoin: Boolean,\n    lockOnJoinConfigurable: Boolean,\n    setBy: Match.Maybe(String),\n  });\n\n  const {\n    disableCam,\n    disableMic,\n    disablePrivateChat: disablePrivChat,\n    disablePublicChat: disablePubChat,\n    disableNote,\n    hideUserList,\n    lockedLayout,\n    lockOnJoin,\n    lockOnJoinConfigurable,\n  } = lockSettingsProps;\n\n  const payload = {\n    disableCam,\n    disableMic,\n    disablePrivChat,\n    disablePubChat,\n    disableNote,\n    hideUserList,\n    lockedLayout,\n    lockOnJoin,\n    lockOnJoinConfigurable,\n    setBy: requesterUserId,\n  };\n\n  RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import Logger from '/imports/startup/server/logger';\nimport { Meteor } from 'meteor/meteor';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { RecordMeetings } from '/imports/api/meetings';\nimport Users from '/imports/api/users';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function toggleRecording() {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const ROLE_MODERATOR = Meteor.settings.public.user.role_moderator;\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  const EVENT_NAME = 'SetRecordingStatusCmdMsg';\n\n  let meetingRecorded;\n  let allowedToRecord;\n\n  const recordObject = RecordMeetings.findOne({ meetingId });\n\n  if (recordObject != null) {\n    const {\n      allowStartStopRecording,\n      recording,\n      record,\n    } = recordObject;\n\n    meetingRecorded = recording;\n    allowedToRecord = record && allowStartStopRecording; // TODO-- remove some day\n  }\n\n  const payload = {\n    recording: !meetingRecorded,\n    setBy: requesterUserId,\n  };\n\n  const selector = {\n    meetingId,\n    userId: requesterUserId,\n  };\n  const user = Users.findOne(selector);\n\n  if (allowedToRecord && !!user && user.role === ROLE_MODERATOR) {\n    Logger.info(`Setting the record parameter to ${!meetingRecorded} for ${meetingId} by ${requesterUserId}`);\n    return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n  }\n  return null;\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '../../../common/server/helpers';\n\nexport default function toggleWebcamsOnlyForModerator(webcamsOnlyForModerator) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'UpdateWebcamsOnlyForModeratorCmdMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  check(webcamsOnlyForModerator, Boolean);\n\n  const payload = {\n    webcamsOnlyForModerator,\n    setBy: requesterUserId,\n  };\n\n  RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\n\nexport default function transferUser(fromMeetingId, toMeetingId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'TransferUserToMeetingRequestMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const payload = {\n    fromMeetingId,\n    toMeetingId,\n    userId: requesterUserId,\n  };\n\n  Logger.verbose('User was transferred from one meting to another', { requesterUserId, fromMeetingId, toMeetingId });\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import flat from 'flat';\nimport {\n  check,\n  Match,\n} from 'meteor/check';\nimport SanitizeHTML from 'sanitize-html';\nimport Meetings, { RecordMeetings } from '/imports/api/meetings';\nimport Logger from '/imports/startup/server/logger';\nimport createNote from '/imports/api/note/server/methods/createNote';\nimport createCaptions from '/imports/api/captions/server/methods/createCaptions';\nimport { addAnnotationsStreamer } from '/imports/api/annotations/server/streamer';\nimport { addCursorStreamer } from '/imports/api/cursor/server/streamer';\nimport BannedUsers from '/imports/api/users/server/store/bannedUsers';\n\nexport default function addMeeting(meeting) {\n  const meetingId = meeting.meetingProp.intId;\n\n  check(meetingId, String);\n  check(meeting, {\n    breakoutProps: {\n      sequence: Number,\n      freeJoin: Boolean,\n      breakoutRooms: Array,\n      parentId: String,\n      enabled: Boolean,\n      record: Boolean,\n      privateChatEnabled: Boolean,\n    },\n    meetingProp: {\n      intId: String,\n      extId: String,\n      isBreakout: Boolean,\n      name: String,\n    },\n    usersProp: {\n      webcamsOnlyForModerator: Boolean,\n      guestPolicy: String,\n      maxUsers: Number,\n      allowModsToUnmuteUsers: Boolean,\n    },\n    durationProps: {\n      createdTime: Number,\n      duration: Number,\n      createdDate: String,\n      maxInactivityTimeoutMinutes: Number,\n      warnMinutesBeforeMax: Number,\n      meetingExpireIfNoUserJoinedInMinutes: Number,\n      meetingExpireWhenLastUserLeftInMinutes: Number,\n      userInactivityInspectTimerInMinutes: Number,\n      userInactivityThresholdInMinutes: Number,\n      userActivitySignResponseDelayInMinutes: Number,\n      timeRemaining: Number,\n    },\n    welcomeProp: {\n      welcomeMsg: String,\n      modOnlyMessage: String,\n      welcomeMsgTemplate: String,\n    },\n    recordProp: Match.ObjectIncluding({\n      allowStartStopRecording: Boolean,\n      autoStartRecording: Boolean,\n      record: Boolean,\n    }),\n    password: {\n      viewerPass: String,\n      moderatorPass: String,\n    },\n    voiceProp: {\n      voiceConf: String,\n      dialNumber: String,\n      telVoice: String,\n      muteOnStart: Boolean,\n    },\n    screenshareProps: {\n      red5ScreenshareIp: String,\n      red5ScreenshareApp: String,\n      screenshareConf: String,\n    },\n    metadataProp: Object,\n    lockSettingsProps: {\n      disableCam: Boolean,\n      disableMic: Boolean,\n      disablePrivateChat: Boolean,\n      disablePublicChat: Boolean,\n      disableNote: Boolean,\n      hideUserList: Boolean,\n      lockOnJoin: Boolean,\n      lockOnJoinConfigurable: Boolean,\n      lockedLayout: Boolean,\n    },\n  });\n\n  const {\n    recordProp,\n    ...restProps\n  } = meeting;\n\n  const newMeeting = restProps;\n\n  const selector = {\n    meetingId,\n  };\n\n  newMeeting.lockSettingsProps = Object.assign(meeting.lockSettingsProps, { setBy: 'temp' });\n\n  const meetingEnded = false;\n\n  let { welcomeMsg } = newMeeting.welcomeProp;\n\n  const sanitizeTextInChat = original => SanitizeHTML(original, {\n    allowedTags: ['a', 'b', 'br', 'i', 'img', 'li', 'small', 'span', 'strong', 'u', 'ul'],\n    allowedAttributes: {\n      a: ['href', 'name', 'target'],\n      img: ['src', 'width', 'height'],\n    },\n    allowedSchemes: ['https'],\n  });\n\n  const sanitizedWelcomeText = sanitizeTextInChat(welcomeMsg);\n  welcomeMsg = sanitizedWelcomeText.replace(\n    'href=\"event:',\n    'href=\"',\n  );\n\n  const insertBlankTarget = (s, i) => `${s.substr(0, i)} target=\"_blank\"${s.substr(i)}`;\n  const linkWithoutTarget = new RegExp('<a href=\"(.*?)\">', 'g');\n  linkWithoutTarget.test(welcomeMsg);\n\n  if (linkWithoutTarget.lastIndex > 0) {\n    welcomeMsg = insertBlankTarget(\n      welcomeMsg,\n      linkWithoutTarget.lastIndex - 1,\n    );\n  }\n\n  newMeeting.welcomeProp.welcomeMsg = welcomeMsg;\n\n  // note: as of July 2020 `modOnlyMessage` is not published to the client side.\n  // We are sanitizing this data simply to prevent future potential usage\n  // At the moment `modOnlyMessage` is obtained from client side as a response to Enter API\n  newMeeting.welcomeProp.modOnlyMessage = sanitizeTextInChat(newMeeting.welcomeProp.modOnlyMessage);\n\n  const modifier = {\n    $set: Object.assign({\n      meetingId,\n      meetingEnded,\n      publishedPoll: false,\n    }, flat(newMeeting, {\n      safe: true,\n    })),\n  };\n\n  try {\n    const { insertedId, numberAffected } = RecordMeetings.upsert(selector, { meetingId, ...recordProp });\n\n    if (insertedId) {\n      Logger.info(`Added record prop id=${meetingId}`);\n    } else if (numberAffected) {\n      Logger.info(`Upserted record prop id=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding record prop to collection: ${err}`);\n  }\n\n  try {\n    const { insertedId, numberAffected } = Meetings.upsert(selector, modifier);\n\n    addAnnotationsStreamer(meetingId);\n    addCursorStreamer(meetingId);\n\n    if (insertedId) {\n      Logger.info(`Added meeting id=${meetingId}`);\n      // TODO: Here we call Etherpad API to create this meeting notes. Is there a\n      // better place we can run this post-creation routine?\n      createNote(meetingId);\n      createCaptions(meetingId);\n      BannedUsers.init(meetingId);\n    } else if (numberAffected) {\n      Logger.info(`Upserted meeting id=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding meeting to collection: ${err}`);\n  }\n}\n","import Logger from '/imports/startup/server/logger';\nimport Meetings from '/imports/api/meetings';\nimport { check } from 'meteor/check';\n\nexport default function changeLockSettings(meetingId, payload) {\n  check(meetingId, String);\n  check(payload, {\n    disableCam: Boolean,\n    disableMic: Boolean,\n    disablePrivChat: Boolean,\n    disablePubChat: Boolean,\n    disableNote: Boolean,\n    hideUserList: Boolean,\n    lockedLayout: Boolean,\n    lockOnJoin: Boolean,\n    lockOnJoinConfigurable: Boolean,\n    setBy: Match.Maybe(String),\n  });\n\n  const {\n    disableCam,\n    disableMic,\n    disablePrivChat,\n    disablePubChat,\n    disableNote,\n    hideUserList,\n    lockedLayout,\n    lockOnJoin,\n    lockOnJoinConfigurable,\n    setBy,\n  } = payload;\n\n  const selector = {\n    meetingId,\n  };\n\n  const modifier = {\n    $set: {\n      lockSettingsProps: {\n        disableCam,\n        disableMic,\n        disablePrivateChat: disablePrivChat,\n        disablePublicChat: disablePubChat,\n        disableNote,\n        hideUserList,\n        lockedLayout,\n        lockOnJoin,\n        lockOnJoinConfigurable,\n        setBy,\n      },\n    },\n  };\n\n\n  try {\n    const { numberAffected } = Meetings.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Changed meeting={${meetingId}} updated lock settings`);\n    } else {\n      Logger.info(`meeting={${meetingId}} lock settings were not updated`);\n    }\n  } catch (err) {\n    Logger.error(`Changing meeting={${meetingId}} lock settings: ${err}`);\n  }\n}\n","import Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\nimport { check } from 'meteor/check';\n\nexport default function changeUserLock(meetingId, payload) {\n  check(meetingId, String);\n  check(payload, {\n    userId: String,\n    locked: Boolean,\n    lockedBy: String,\n  });\n\n  const { userId, locked, lockedBy } = payload;\n\n  const selector = {\n    meetingId,\n    userId,\n  };\n\n  const modifier = {\n    $set: {\n      locked,\n    },\n  };\n\n  try {\n    const { numberAffected } = Users.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`User's userId=${userId} lock status was changed to: ${locked} by user userId=${lockedBy}`);\n    } else {\n      Logger.info(`User's userId=${userId} lock status wasn't updated`);\n    }\n  } catch (err) {\n    Logger.error(`Changing user lock setting: ${err}`);\n  }\n}\n","import { MeetingTimeRemaining } from '/imports/api/meetings';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearMeetingTimeRemaining(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = MeetingTimeRemaining.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared MeetingTimeRemaining in (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.info(`Error on clearing MeetingTimeRemaining in (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = MeetingTimeRemaining.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared MeetingTimeRemaining in all meetings');\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing MeetingTimeRemaining in all meetings. ${err}`);\n    }\n  }\n}\n","import { RecordMeetings } from '/imports/api/meetings';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function meetingHasEnded(meetingId) {\n  try {\n    const numberAffected = RecordMeetings.remove({ meetingId });\n\n    if (numberAffected) {\n      Logger.info(`Cleared record prop from meeting with id ${meetingId}`)\n    }\n  } catch (err) {\n    Logger.error(`Error on clearing record prop from meeting with id ${meetingId}. ${err}`);\n  }\n}\n","import Meetings from '/imports/api/meetings';\nimport Logger from '/imports/startup/server/logger';\n\nimport { removeAnnotationsStreamer } from '/imports/api/annotations/server/streamer';\nimport { removeCursorStreamer } from '/imports/api/cursor/server/streamer';\n\nimport clearUsers from '/imports/api/users/server/modifiers/clearUsers';\nimport clearUsersSettings from '/imports/api/users-settings/server/modifiers/clearUsersSettings';\nimport clearGroupChat from '/imports/api/group-chat/server/modifiers/clearGroupChat';\nimport clearGuestUsers from '/imports/api/guest-users/server/modifiers/clearGuestUsers';\nimport clearBreakouts from '/imports/api/breakouts/server/modifiers/clearBreakouts';\nimport clearAnnotations from '/imports/api/annotations/server/modifiers/clearAnnotations';\nimport clearSlides from '/imports/api/slides/server/modifiers/clearSlides';\nimport clearPolls from '/imports/api/polls/server/modifiers/clearPolls';\nimport clearCaptions from '/imports/api/captions/server/modifiers/clearCaptions';\nimport clearPresentationPods from '/imports/api/presentation-pods/server/modifiers/clearPresentationPods';\nimport clearVoiceUsers from '/imports/api/voice-users/server/modifiers/clearVoiceUsers';\nimport clearUserInfo from '/imports/api/users-infos/server/modifiers/clearUserInfo';\nimport clearScreenshare from '/imports/api/screenshare/server/modifiers/clearScreenshare';\nimport clearNote from '/imports/api/note/server/modifiers/clearNote';\nimport clearNetworkInformation from '/imports/api/network-information/server/modifiers/clearNetworkInformation';\nimport clearMeetingTimeRemaining from '/imports/api/meetings/server/modifiers/clearMeetingTimeRemaining';\nimport clearLocalSettings from '/imports/api/local-settings/server/modifiers/clearLocalSettings';\nimport clearRecordMeeting from './clearRecordMeeting';\nimport clearVoiceCallStates from '/imports/api/voice-call-states/server/modifiers/clearVoiceCallStates';\nimport clearVideoStreams from '/imports/api/video-streams/server/modifiers/clearVideoStreams';\nimport clearWhiteboardMultiUser from '/imports/api/whiteboard-multi-user/server/modifiers/clearWhiteboardMultiUser';\nimport BannedUsers from '/imports/api/users/server/store/bannedUsers';\nimport Metrics from '/imports/startup/server/metrics';\n\nexport default function meetingHasEnded(meetingId) {\n  removeAnnotationsStreamer(meetingId);\n  removeCursorStreamer(meetingId);\n\n  return Meetings.remove({ meetingId }, () => {\n    clearCaptions(meetingId);\n    clearGroupChat(meetingId);\n    clearGuestUsers(meetingId);\n    clearPresentationPods(meetingId);\n    clearBreakouts(meetingId);\n    clearPolls(meetingId);\n    clearAnnotations(meetingId);\n    clearSlides(meetingId);\n    clearUsers(meetingId);\n    clearUsersSettings(meetingId);\n    clearVoiceUsers(meetingId);\n    clearUserInfo(meetingId);\n    clearNote(meetingId);\n    clearNetworkInformation(meetingId);\n    clearLocalSettings(meetingId);\n    clearMeetingTimeRemaining(meetingId);\n    clearRecordMeeting(meetingId);\n    clearVoiceCallStates(meetingId);\n    clearVideoStreams(meetingId);\n    clearWhiteboardMultiUser(meetingId);\n    clearScreenshare(meetingId);\n    BannedUsers.delete(meetingId);\n    Metrics.removeMeeting(meetingId);\n\n    Logger.info(`Cleared Meetings with id ${meetingId}`);\n  });\n}\n","import Meetings from '/imports/api/meetings';\nimport Logger from '/imports/startup/server/logger';\nimport { check } from 'meteor/check';\n\nexport default function setPublishedPoll(meetingId, isPublished) {\n  check(meetingId, String);\n  check(isPublished, Boolean);\n\n  const selector = {\n    meetingId,\n  };\n\n  const modifier = {\n    $set: {\n      publishedPoll: isPublished,\n    },\n  };\n\n  try {\n    const { numberAffected } = Meetings.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Set publishedPoll=${isPublished} in meeitingId=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Setting publishedPoll=${isPublished} for meetingId=${meetingId}`);\n  }\n}\n","import Logger from '/imports/startup/server/logger';\nimport Meetings from '/imports/api/meetings';\nimport { check } from 'meteor/check';\n\nexport default function changeWebcamOnlyModerator(meetingId, payload) {\n  check(meetingId, String);\n  check(payload, {\n    webcamsOnlyForModerator: Boolean,\n    setBy: String,\n  });\n  const { webcamsOnlyForModerator } = payload;\n\n  const selector = {\n    meetingId,\n  };\n\n  const modifier = {\n    $set: {\n      'usersProp.webcamsOnlyForModerator': webcamsOnlyForModerator,\n    },\n  };\n\n  try {\n    const { numberAffected } = Meetings.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Changed meeting={${meetingId}} updated webcam Only for Moderator`)\n    } else {\n      Logger.info(`meeting={${meetingId}} webcam Only for Moderator were not updated`);\n    }\n  } catch (err) {\n    Logger.error(`Changwing meeting={${meetingId}} webcam Only for Moderator: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handleMeetingCreation from './handlers/meetingCreation';\nimport handleGetAllMeetings from './handlers/getAllMeetings';\nimport handleMeetingEnd from './handlers/meetingEnd';\nimport handleMeetingDestruction from './handlers/meetingDestruction';\nimport handleMeetingLocksChange from './handlers/meetingLockChange';\nimport handleUserLockChange from './handlers/userLockChange';\nimport handleRecordingStatusChange from './handlers/recordingStatusChange';\nimport handleRecordingTimerChange from './handlers/recordingTimerChange';\nimport handleTimeRemainingUpdate from './handlers/timeRemainingUpdate';\nimport handleChangeWebcamOnlyModerator from './handlers/webcamOnlyModerator';\n\nRedisPubSub.on('MeetingCreatedEvtMsg', handleMeetingCreation);\nRedisPubSub.on('SyncGetMeetingInfoRespMsg', handleGetAllMeetings);\nRedisPubSub.on('MeetingEndingEvtMsg', handleMeetingEnd);\nRedisPubSub.on('MeetingDestroyedEvtMsg', handleMeetingDestruction);\nRedisPubSub.on('LockSettingsInMeetingChangedEvtMsg', handleMeetingLocksChange);\nRedisPubSub.on('UserLockedInMeetingEvtMsg', handleUserLockChange);\nRedisPubSub.on('RecordingStatusChangedEvtMsg', handleRecordingStatusChange);\nRedisPubSub.on('UpdateRecordingTimerEvtMsg', handleRecordingTimerChange);\nRedisPubSub.on('WebcamsOnlyForModeratorChangedEvtMsg', handleChangeWebcamOnlyModerator);\nRedisPubSub.on('GetLockSettingsRespMsg', handleMeetingLocksChange);\nRedisPubSub.on('MeetingTimeRemainingUpdateEvtMsg', handleTimeRemainingUpdate);\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport endMeeting from './methods/endMeeting';\nimport toggleRecording from './methods/toggleRecording';\nimport transferUser from './methods/transferUser';\nimport toggleLockSettings from './methods/toggleLockSettings';\nimport toggleWebcamsOnlyForModerator from './methods/toggleWebcamsOnlyForModerator';\n\nMeteor.methods({\n  endMeeting,\n  toggleRecording,\n  toggleLockSettings,\n  transferUser,\n  toggleWebcamsOnlyForModerator,\n});\n","import { Meteor } from 'meteor/meteor';\nimport Meetings, { RecordMeetings, MeetingTimeRemaining } from '/imports/api/meetings';\nimport Users from '/imports/api/users';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nconst ROLE_MODERATOR = Meteor.settings.public.user.role_moderator;\n\nfunction meetings(role) {\n  if (!this.userId) {\n    return Meetings.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing meeting', { meetingId, requesterUserId });\n\n  const selector = {\n    $or: [\n      { meetingId },\n    ],\n  };\n\n  const User = Users.findOne({ userId: requesterUserId, meetingId }, { fields: { role: 1 } });\n  if (!!User && User.role === ROLE_MODERATOR) {\n    selector.$or.push({\n      'meetingProp.isBreakout': true,\n      'breakoutProps.parentId': meetingId,\n    });\n  }\n\n  const options = {\n    fields: {\n      password: false,\n      'welcomeProp.modOnlyMessage': false,\n    },\n  };\n\n  return Meetings.find(selector, options);\n}\n\nfunction publish(...args) {\n  const boundMeetings = meetings.bind(this);\n  return boundMeetings(...args);\n}\n\nMeteor.publish('meetings', publish);\n\nfunction recordMeetings() {\n  if (!this.userId) {\n    return RecordMeetings.find({ meetingId: '' });\n  }\n  const { meetingId } = extractCredentials(this.userId);\n\n  return RecordMeetings.find({ meetingId });\n}\nfunction recordPublish(...args) {\n  const boundRecordMeetings = recordMeetings.bind(this);\n  return boundRecordMeetings(...args);\n}\n\nMeteor.publish('record-meetings', recordPublish);\n\nfunction meetingTimeRemaining() {\n  if (!this.userId) {\n    return MeetingTimeRemaining.find({ meetingId: '' });\n  }\n  const { meetingId } = extractCredentials(this.userId);\n\n  return MeetingTimeRemaining.find({ meetingId });\n}\nfunction timeRemainingPublish(...args) {\n  const boundtimeRemaining = meetingTimeRemaining.bind(this);\n  return boundtimeRemaining(...args);\n}\n\nMeteor.publish('meeting-time-remaining', timeRemainingPublish);\n","import { Meteor } from 'meteor/meteor';\n\nconst Meetings = new Mongo.Collection('meetings');\nconst RecordMeetings = new Mongo.Collection('record-meetings');\nconst MeetingTimeRemaining = new Mongo.Collection('meeting-time-remaining');\n\nif (Meteor.isServer) {\n  // types of queries for the meetings:\n  // 1. meetingId\n\n  Meetings._ensureIndex({ meetingId: 1 });\n  RecordMeetings._ensureIndex({ meetingId: 1 });\n  MeetingTimeRemaining._ensureIndex({ meetingId: 1 });\n}\n\nexport {\n  RecordMeetings,\n  MeetingTimeRemaining,\n};\nexport default Meetings;\n","import { check } from 'meteor/check';\nimport NetworkInformation from '/imports/api/network-information';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function userInstabilityDetected(sender) {\n  const { meetingId, requesterUserId: receiver } = extractCredentials(this.userId);\n  check(sender, String);\n\n  const payload = {\n    time: new Date().getTime(),\n    meetingId,\n    receiver,\n    sender,\n  };\n\n  Logger.debug('Receiver reported a network instability', { receiver, meetingId });\n\n  return NetworkInformation.insert(payload);\n}\n","import NetworkInformation from '/imports/api/network-information';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearNetworkInformation(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = NetworkInformation.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared Network Information (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing Network Information (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = NetworkInformation.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared Network Information (all)');\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing Network Information (all). ${err}`);\n    }\n  }\n}\n","import './methods';\nimport './publisher';\n","import { Meteor } from 'meteor/meteor';\nimport userInstabilityDetected from './methods/userInstabilityDetected';\n\nMeteor.methods({\n  userInstabilityDetected,\n});\n","import { Meteor } from 'meteor/meteor';\nimport NetworkInformation from '/imports/api/network-information';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction networkInformation() {\n  if (!this.userId) {\n    return NetworkInformation.find({ meetingId: '' });\n  }\n  const { meetingId } = extractCredentials(this.userId);\n\n  return NetworkInformation.find({\n    meetingId,\n  });\n}\n\nfunction publish(...args) {\n  const boundNetworkInformation = networkInformation.bind(this);\n\n  return boundNetworkInformation(...args);\n}\n\nMeteor.publish('network-information', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst NetworkInformation = new Mongo.Collection('network-information');\n\nif (Meteor.isServer) {\n  NetworkInformation._ensureIndex({ meetingId: 1 });\n}\n\nexport default NetworkInformation;\n","import { check } from 'meteor/check';\nimport updateNote from '/imports/api/note/server/modifiers/updateNote';\n\nexport default function handlePadUpdate({ body }) {\n  const { pad, revs } = body;\n  const { id } = pad;\n\n  check(id, String);\n  check(revs, Number);\n\n  updateNote(id, revs);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\n\nexport default function addPad(meetingId, padId, readOnlyId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'AddPadSysMsg';\n\n  check(meetingId, String);\n  check(padId, String);\n  check(readOnlyId, String);\n\n  const payload = {\n    padId,\n    readOnlyId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, 'nodeJSapp', payload);\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport {\n  generateNoteId,\n  createPadURL,\n  getReadOnlyIdURL,\n  isEnabled,\n  getDataFromResponse,\n} from '/imports/api/note/server/helpers';\nimport addNote from '/imports/api/note/server/modifiers/addNote';\nimport axios from 'axios';\n\nexport default function createNote(meetingId) {\n  // Avoid note creation if this feature is disabled\n  if (!isEnabled()) {\n    Logger.warn(`Notes are disabled for ${meetingId}`);\n    return;\n  }\n\n  check(meetingId, String);\n\n  const noteId = generateNoteId(meetingId);\n\n  const createURL = createPadURL(noteId);\n\n  axios({\n    method: 'get',\n    url: createURL,\n    responseType: 'json',\n  }).then((responseOuter) => {\n    const { status } = responseOuter;\n    if (status !== 200) {\n      Logger.error(`Could not get note info for ${meetingId} ${status}`);\n      return;\n    }\n    const readOnlyURL = getReadOnlyIdURL(noteId);\n    axios({\n      method: 'get',\n      url: readOnlyURL,\n      responseType: 'json',\n    }).then((response) => {\n      const readOnlyNoteId = getDataFromResponse(response.data, 'readOnlyID');\n      if (readOnlyNoteId) {\n        addNote(meetingId, noteId, readOnlyNoteId);\n      } else {\n        Logger.error(`Could not get note readOnlyID for ${meetingId}`);\n      }\n    }).catch(error => Logger.error(`Could not get note readOnlyID for ${meetingId}: ${error}`));\n  }).catch(error => Logger.error(`Could not create note for ${meetingId}: ${error}`));\n}\n","import { check } from 'meteor/check';\nimport Note from '/imports/api/note';\nimport Logger from '/imports/startup/server/logger';\nimport addPad from '/imports/api/note/server/methods/addPad';\n\nexport default function addNote(meetingId, noteId, readOnlyNoteId) {\n  check(meetingId, String);\n  check(noteId, String);\n  check(readOnlyNoteId, String);\n\n  const selector = {\n    meetingId,\n    noteId,\n  };\n\n  const modifier = {\n    meetingId,\n    noteId,\n    readOnlyNoteId,\n    revs: 0,\n  };\n\n  try {\n    const { insertedId } = Note.upsert(selector, modifier);\n\n    if (insertedId) {\n      addPad(meetingId, noteId, readOnlyNoteId);\n      Logger.info(`Added note id=${noteId} readOnlyId=${readOnlyNoteId} meeting=${meetingId}`);\n    } else {\n      Logger.info(`Upserted note id=${noteId} readOnlyId=${readOnlyNoteId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding note to the collection: ${err}`);\n  }\n}\n","import Note from '/imports/api/note';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearNote(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = Note.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared Note (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing Note (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = Note.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared Note (all)');\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing Note (all). ${err}`);\n    }\n  }\n}\n","import Note from '/imports/api/note';\nimport Logger from '/imports/startup/server/logger';\nimport { check } from 'meteor/check';\n\nexport default function updateNote(noteId, revs) {\n  check(noteId, String);\n  check(revs, Number);\n\n  const selector = {\n    noteId,\n  };\n\n  const modifier = {\n    $set: {\n      revs,\n    },\n  };\n\n  try {\n    const numberAffected = Note.update(selector, modifier, { multi: true });\n\n    if (numberAffected) {\n      Logger.verbose('Notes: update note pad', { pad: noteId, revs });\n    }\n  } catch (err) {\n    Logger.error('Notes: error when updating note pad', { err });\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { processForNotePadOnly } from '/imports/api/note/server/helpers';\nimport handlePadUpdate from './handlers/padUpdate';\n\nRedisPubSub.on('PadUpdateSysMsg', processForNotePadOnly(handlePadUpdate));\n","import { Meteor } from 'meteor/meteor';\nimport { hashSHA1 } from '/imports/api/common/server/helpers';\n\nconst ETHERPAD = Meteor.settings.private.etherpad;\nconst NOTE_CONFIG = Meteor.settings.public.note;\nconst BASE_URL = `http://${ETHERPAD.host}:${ETHERPAD.port}/api/${ETHERPAD.version}`;\nconst TOKEN = '_';\n\nconst createPadURL = padId => `${BASE_URL}/createPad?apikey=${ETHERPAD.apikey}&padID=${padId}`;\n\nconst getReadOnlyIdURL = padId => `${BASE_URL}/getReadOnlyID?apikey=${ETHERPAD.apikey}&padID=${padId}`;\n\nconst appendTextURL = (padId, text) => `${BASE_URL}/appendText?apikey=${ETHERPAD.apikey}&padID=${padId}&text=${encodeURIComponent(text)}`;\n\nconst generateNoteId = (meetingId) => hashSHA1(meetingId+ETHERPAD.apikey);\n\nconst isEnabled = () => NOTE_CONFIG.enabled;\n\nconst getDataFromResponse = (data, key) => {\n  if (data) {\n    const innerData = data.data;\n    if (innerData && innerData[key]) {\n      return innerData[key];\n    }\n  }\n  return null;\n};\n\nconst isNotePad = padId => padId.search(TOKEN);\n\nconst processForNotePadOnly = fn => (message, ...args) => {\n  const { body } = message;\n  const { pad } = body;\n  const { id } = pad;\n\n  check(id, String);\n\n  if (isNotePad(id)) return fn(message, ...args);\n  return () => {};\n};\n\nexport {\n  generateNoteId,\n  createPadURL,\n  getReadOnlyIdURL,\n  isEnabled,\n  getDataFromResponse,\n  appendTextURL,\n  processForNotePadOnly,\n};\n","import './publishers';\nimport './eventHandlers';\n","import { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport Note from '/imports/api/note';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction note() {\n  if (!this.userId) {\n    return Note.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.info(`Publishing note for ${meetingId} ${requesterUserId}`);\n\n  return Note.find({ meetingId });\n}\n\nfunction publish(...args) {\n  const boundNote = note.bind(this);\n  return boundNote(...args);\n}\n\nMeteor.publish('note', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst Note = new Mongo.Collection('note');\n\nif (Meteor.isServer) {\n  Note._ensureIndex({ meetingId: 1, noteId: 1 });\n}\n\nexport default Note;\n","import Users from '/imports/api/users';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function ping() {\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const selector = {\n    meetingId,\n    userId: requesterUserId,\n  };\n\n  const modifier = {\n    $set: {\n      lastPing: Date.now(),\n    },\n  };\n\n  try {\n    Users.update(selector, modifier);\n  } catch (err) {\n    Logger.error(`Error updating lastPing for ${requesterUserId}: ${err}`);\n  }\n}\n","import './publishers';\nimport './methods';\n","import { Meteor } from 'meteor/meteor';\nimport ping from './methods/ping';\n\nMeteor.methods({\n  ping,\n});\n","import { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport _ from 'lodash';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nconst COLLECTION_NAME = 'ping-pong';\nconst INTERVAL_IN_SETTINGS = (Meteor.settings.public.pingPong.clearUsersInSeconds) * 1000;\nconst INTERVAL_TIME = INTERVAL_IN_SETTINGS < 10000 ? 10000 : INTERVAL_IN_SETTINGS;\nconst PONG_INTERVAL_IN_SETTINGS = (Meteor.settings.public.pingPong.pongTimeInSeconds) * 1000;\nconst PONG_INTERVAL = PONG_INTERVAL_IN_SETTINGS >= (INTERVAL_TIME / 2)\n  ? (INTERVAL_TIME / 2) : PONG_INTERVAL_IN_SETTINGS;\n\nfunction pingPong() {\n  if (!this.userId) {\n    return; // TODO-- is there a more appropriate set to return?\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  const id = _.uniqueId('pong-');\n  Logger.info(`Starting ping-pong publish for userId: ${requesterUserId}`);\n  const pongSender = (interval) => {\n    const payload = {\n      pong: {\n        message: 'pong',\n        time: Date.now(),\n        meetingId,\n      },\n    };\n    let fn = this.added.bind(this);\n    if (interval) fn = this.changed.bind(this);\n    fn(COLLECTION_NAME, id, payload);\n  };\n  pongSender();\n  this.ready();\n  const interval = Meteor.setInterval(() => pongSender(true), PONG_INTERVAL);\n\n  this.onStop(() => {\n    Meteor.clearInterval(interval);\n  });\n}\n\nMeteor.publish('ping-pong', pingPong);\n","import { check } from 'meteor/check';\nimport removePoll from '../modifiers/removePoll';\nimport setPublishedPoll from '../../../meetings/server/modifiers/setPublishedPoll';\n\nexport default function pollPublished({ body }, meetingId) {\n  const { pollId } = body;\n\n  check(meetingId, String);\n  check(pollId, String);\n\n  setPublishedPoll(meetingId, true);\n\n  return removePoll(meetingId, pollId);\n}\n","import { check } from 'meteor/check';\nimport addPoll from '../modifiers/addPoll';\nimport setPublishedPoll from '../../../meetings/server/modifiers/setPublishedPoll';\n\nexport default function pollStarted({ body }, meetingId) {\n  const { userId } = body;\n  const { poll } = body;\n\n  check(meetingId, String);\n  check(userId, String);\n  check(poll, Object);\n\n  setPublishedPoll(meetingId, false);\n\n  return addPoll(meetingId, userId, poll);\n}\n","import { check } from 'meteor/check';\nimport removePoll from '../modifiers/removePoll';\nimport clearPolls from '../modifiers/clearPolls';\n\nexport default function pollStopped({ body }, meetingId) {\n  const { poll } = body;\n\n  check(meetingId, String);\n\n  if (poll) {\n    const { pollId } = poll;\n\n    check(pollId, String);\n\n    return removePoll(meetingId, pollId);\n  }\n\n  return clearPolls(meetingId);\n}\n","import { check } from 'meteor/check';\nimport Polls from '/imports/api/polls';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function userResponded({ body }) {\n  const { pollId, userId, answerId } = body;\n\n  check(pollId, String);\n  check(userId, String);\n  check(answerId, Number);\n\n  const selector = {\n    id: pollId,\n  };\n\n  const modifier = {\n    $pull: {\n      users: userId,\n    },\n    $push: {\n      responses: { userId, answerId },\n    },\n  };\n\n  try {\n    const numberAffected = Polls.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Updating Poll response (userId: ${userId}, response: ${answerId}, pollId: ${pollId})`);\n    }\n  } catch (err) {\n    Logger.error(`Updating Poll responses: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport updateVotes from '../modifiers/updateVotes';\n\nexport default function userVoted({ body }, meetingId) {\n  const { poll } = body;\n\n  check(meetingId, String);\n  check(poll, {\n    id: String,\n    answers: [\n      {\n        id: Number,\n        key: String,\n        numVotes: Number,\n      },\n    ],\n    numRespondents: Number,\n    numResponders: Number,\n  });\n\n  return updateVotes(poll, meetingId);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport Polls from '/imports/api/polls';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function publishPoll() {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'ShowPollResultReqMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  const poll = Polls.findOne({ meetingId }); // TODO--send pollid from client\n  if (!poll) {\n    Logger.error(`Attempted to publish inexisting poll for meetingId: ${meetingId}`);\n    return false;\n  }\n\n  return RedisPubSub.publishUserMessage(\n    CHANNEL,\n    EVENT_NAME,\n    meetingId,\n    requesterUserId,\n    ({ requesterId: requesterUserId, pollId: poll.id }),\n  );\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { check } from 'meteor/check';\nimport Polls from '/imports/api/polls';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function publishVote(pollId, pollAnswerId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'RespondToPollReqMsg';\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(pollAnswerId, Number);\n  check(pollId, String);\n\n  const allowedToVote = Polls.findOne({ id: pollId, users: { $in: [requesterUserId] } }, {\n    fields: {\n      users: 1,\n    },\n  });\n\n  if (!allowedToVote) {\n    Logger.info(`Poll User={${requesterUserId}} has already voted in PollId={${pollId}}`);\n    return null;\n  }\n\n  const selector = {\n    users: requesterUserId,\n    meetingId,\n    'answers.id': pollAnswerId,\n  };\n\n  const payload = {\n    requesterId: requesterUserId,\n    pollId,\n    questionId: 0,\n    answerId: pollAnswerId,\n  };\n\n  /*\n   We keep an array of people who were in the meeting at the time the poll\n   was started. The poll is published to them only.\n   Once they vote - their ID is removed and they cannot see the poll anymore\n  */\n  const modifier = {\n    $pull: {\n      users: requesterUserId,\n    },\n  };\n\n  try {\n    const numberAffected = Polls.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Removed responded user=${requesterUserId} from poll (meetingId: ${meetingId}, pollId: ${pollId}!)`);\n\n      RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n    }\n  } catch (err) {\n    Logger.error(`Removing responded user from Polls collection: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { check } from 'meteor/check';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function startPoll(pollType, pollId, answers) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n\n  let EVENT_NAME = 'StartPollReqMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(pollId, String);\n  check(pollType, String);\n\n  const payload = {\n    requesterId: requesterUserId,\n    pollId: `${pollId}/${new Date().getTime()}`,\n    pollType,\n  };\n\n  if (pollType === 'custom') {\n    EVENT_NAME = 'StartCustomPollReqMsg';\n    check(answers, Array);\n    payload.answers = answers;\n  }\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function stopPoll() {\n  const { meetingId, requesterUserId: requesterId } = extractCredentials(this.userId);\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'StopPollReqMsg';\n\n  return RedisPubSub.publishUserMessage(\n    CHANNEL,\n    EVENT_NAME,\n    meetingId,\n    requesterId,\n    ({ requesterId }),\n  );\n}\n","import Users from '/imports/api/users';\nimport Polls from '/imports/api/polls';\nimport Logger from '/imports/startup/server/logger';\nimport flat from 'flat';\nimport { check } from 'meteor/check';\n\nexport default function addPoll(meetingId, requesterId, poll) {\n  check(requesterId, String);\n  check(meetingId, String);\n  check(poll, {\n    id: String,\n    answers: [\n      {\n        id: Number,\n        key: String,\n      },\n    ],\n  });\n\n  const userSelector = {\n    meetingId,\n    userId: { $ne: requesterId },\n    clientType: { $ne: 'dial-in-user' },\n  };\n\n  const userIds = Users.find(userSelector, { fields: { userId: 1 } })\n    .fetch()\n    .map(user => user.userId);\n\n  const selector = {\n    meetingId,\n    requester: requesterId,\n    id: poll.id,\n  };\n\n  const modifier = Object.assign(\n    { meetingId },\n    { requester: requesterId },\n    { users: userIds },\n    flat(poll, { safe: true }),\n  );\n\n\n  try {\n    const { insertedId } = Polls.upsert(selector, modifier);\n\n    if (insertedId) {\n      Logger.info(`Added Poll id=${poll.id}`);\n    } else {\n      Logger.info(`Upserted Poll id=${poll.id}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding Poll to collection: ${poll.id}`);\n  }\n}\n","import Polls from '/imports/api/polls';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearPolls(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = Polls.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared Polls (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.info(`Error on clearing Polls (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = Polls.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared Polls (all)');\n      }\n    } catch (err) {\n      Logger.info(`Error on clearing Polls (all). ${err}`);\n    }\n  }\n}\n","import Polls from '/imports/api/polls';\nimport { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function removePoll(meetingId, id) {\n  check(meetingId, String);\n  check(id, String);\n\n  const selector = {\n    meetingId,\n    id,\n  };\n\n  try {\n    const numberAffected = Polls.remove(selector);\n\n    if (numberAffected) {\n      Logger.info(`Removed Poll id=${id}`);\n    }\n\n  } catch (err) {\n    Logger.error(`Removing Poll from collection: ${err}`);\n  }\n}\n","import Polls from '/imports/api/polls';\nimport { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport flat from 'flat';\n\nexport default function updateVotes(poll, meetingId) {\n  check(meetingId, String);\n  check(poll, Object);\n\n  const {\n    id,\n    answers,\n    numResponders,\n    numRespondents,\n  } = poll;\n\n  check(id, String);\n  check(answers, Array);\n\n  check(numResponders, Number);\n  check(numRespondents, Number);\n\n  const selector = {\n    meetingId,\n    id,\n  };\n\n  const modifier = {\n    $set: flat(poll, { safe: true }),\n  };\n\n  try {\n    const numberAffected = Polls.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Updating Polls collection (meetingId: ${meetingId}, pollId: ${id}!)`);\n    }\n  } catch (err) {\n    Logger.error(`Updating Polls collection: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handlePollStarted from './handlers/pollStarted';\nimport handlePollStopped from './handlers/pollStopped';\nimport handlePollPublished from './handlers/pollPublished';\nimport handleUserVoted from './handlers/userVoted';\nimport handleUserResponded from './handlers/userResponded';\n\nRedisPubSub.on('PollShowResultEvtMsg', handlePollPublished);\nRedisPubSub.on('PollStartedEvtMsg', handlePollStarted);\nRedisPubSub.on('PollStoppedEvtMsg', handlePollStopped);\nRedisPubSub.on('PollUpdatedEvtMsg', handleUserVoted);\nRedisPubSub.on('UserRespondedToPollRespMsg', handleUserResponded);\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport publishVote from './methods/publishVote';\nimport publishPoll from './methods/publishPoll';\nimport startPoll from './methods/startPoll';\nimport stopPoll from './methods/stopPoll';\n\nMeteor.methods({\n  publishVote,\n  publishPoll,\n  startPoll,\n  stopPoll,\n});\n","import { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport Polls from '/imports/api/polls';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction currentPoll() {\n  if (!this.userId) {\n    return Polls.find({ meetingId: '' });\n  }\n  const { meetingId } = extractCredentials(this.userId);\n\n  const selector = {\n    meetingId,\n  };\n\n  Logger.debug('Publishing poll', { meetingId });\n\n  return Polls.find(selector);\n}\n\nfunction publishCurrentPoll(...args) {\n  const boundPolls = currentPoll.bind(this);\n  return boundPolls(...args);\n}\n\nMeteor.publish('current-poll', publishCurrentPoll);\n\n\nfunction polls() {\n  if (!this.userId) {\n    return Polls.find({ meetingId: '' });\n  }\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing polls', { meetingId, requesterUserId });\n\n  const selector = {\n    meetingId,\n    users: requesterUserId,\n  };\n\n  return Polls.find(selector);\n}\n\nfunction publish(...args) {\n  const boundPolls = polls.bind(this);\n  return boundPolls(...args);\n}\n\nMeteor.publish('polls', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst Polls = new Mongo.Collection('polls');\n\nif (Meteor.isServer) {\n  // We can have just one active poll per meeting\n  // makes no sense to index it by anything other than meetingId\n\n  Polls._ensureIndex({ meetingId: 1 });\n}\n\nexport default Polls;\n","import { check } from 'meteor/check';\nimport addPresentationPod from '../modifiers/addPresentationPod';\n\nexport default function handleCreateNewPresentationPod({ body }, meetingId) {\n  check(body, {\n    currentPresenterId: String,\n    podId: String,\n  });\n  check(meetingId, String);\n\n  const { currentPresenterId, podId } = body;\n\n  const pod = {\n    currentPresenterId,\n    podId,\n  };\n\n  addPresentationPod(meetingId, pod);\n}\n","import { check } from 'meteor/check';\nimport removePresentationPod from '../modifiers/removePresentationPod';\n\nexport default function handleRemovePresentationPod({ body }, meetingId) {\n  check(body, Object);\n  check(meetingId, String);\n\n  const { podId } = body;\n\n  check(podId, String);\n\n  removePresentationPod(meetingId, podId);\n}\n","import { check } from 'meteor/check';\nimport setPresenterInPod from '../modifiers/setPresenterInPod';\n\nexport default function handleSetPresenterInPod({ body }, meetingId) {\n  check(body, Object);\n\n  const { podId, nextPresenterId } = body;\n\n  check(podId, String);\n  check(nextPresenterId, String);\n\n  setPresenterInPod(meetingId, podId, nextPresenterId);\n}\n","import { check } from 'meteor/check';\nimport PresentationPods from '/imports/api/presentation-pods';\nimport removePresentationPod from '../modifiers/removePresentationPod';\nimport addPresentationPod from '../modifiers/addPresentationPod';\n\nexport default function handleSyncGetPresentationPods({ body }, meetingId) {\n  check(body, Object);\n  check(meetingId, String);\n\n  const { pods } = body;\n  check(pods, Array);\n\n  const presentationPodIds = pods.map(pod => pod.id);\n\n  const presentationPodsToRemove = PresentationPods.find({\n    meetingId,\n    podId: { $nin: presentationPodIds },\n  }, { fields: { podId: 1 } }).fetch();\n\n  presentationPodsToRemove.forEach(p => removePresentationPod(meetingId, p.podId));\n\n  pods.forEach((pod) => {\n    // 'podId' and 'currentPresenterId' for some reason called 'id' and 'currentPresenter'\n    // in this message\n    const {\n      id: podId,\n      currentPresenter: currentPresenterId,\n      presentations,\n    } = pod;\n    addPresentationPod(meetingId, { podId, currentPresenterId }, presentations);\n  });\n}\n","import { Match, check } from 'meteor/check';\nimport PresentationPods from '/imports/api/presentation-pods';\nimport Logger from '/imports/startup/server/logger';\nimport addPresentation from '/imports/api/presentations/server/modifiers/addPresentation';\n\n// 'presentations' is passed down here when we receive a Sync message\n// and it's not used when we just create a new presentation pod\nexport default function addPresentationPod(meetingId, pod, presentations = undefined) {\n  check(meetingId, String);\n  check(presentations, Match.Maybe(Array));\n  check(pod, {\n    currentPresenterId: String,\n    podId: String,\n  });\n\n  const { currentPresenterId, podId } = pod;\n\n  const selector = {\n    meetingId,\n    podId,\n  };\n\n  const modifier = {\n    meetingId,\n    podId,\n    currentPresenterId,\n  };\n\n  try {\n    const { insertedId } = PresentationPods.upsert(selector, modifier);\n\n    // if it's a Sync message - continue adding the attached presentations\n    if (presentations) {\n      presentations.forEach(presentation => addPresentation(meetingId, podId, presentation));\n    }\n\n    if (insertedId) {\n      Logger.info(`Added presentation pod id=${podId} meeting=${meetingId}`);\n    } else {\n      Logger.info(`Upserted presentation pod id=${podId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding presentation pod to the collection: ${err}`);\n  }\n}\n","import PresentationPods from '/imports/api/presentation-pods';\nimport Logger from '/imports/startup/server/logger';\nimport clearPresentations from '/imports/api/presentations/server/modifiers/clearPresentations';\nimport clearPresentationUploadToken from '/imports/api/presentation-upload-token/server/modifiers/clearPresentationUploadToken';\n\nexport default function clearPresentationPods(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = PresentationPods.remove({ meetingId });\n\n      if (numberAffected) {\n        clearPresentations(meetingId);\n        clearPresentationUploadToken(meetingId);\n        Logger.info(`Cleared Presentations Pods (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing Presentations Pods (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = PresentationPods.remove({});\n\n      if (numberAffected) {\n        clearPresentations();\n        clearPresentationUploadToken();\n        Logger.info('Cleared Presentations Pods (all)');\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing Presentations Pods (all). ${err}`);\n    }\n  }\n}\n","import { check } from 'meteor/check';\nimport PresentationPods from '/imports/api/presentation-pods';\nimport Logger from '/imports/startup/server/logger';\nimport clearPresentations from '/imports/api/presentations/server/modifiers/clearPresentations';\nimport clearPresentationUploadToken from '/imports/api/presentation-upload-token/server/modifiers/clearPresentationUploadToken';\n\nexport default function removePresentationPod(meetingId, podId) {\n  check(meetingId, String);\n  check(podId, String);\n\n  const selector = {\n    meetingId,\n    podId,\n  };\n\n  try {\n    const numberAffected = PresentationPods.remove(selector);\n\n    if (numberAffected && podId) {\n      Logger.info(`Removed presentation pod id=${podId} meeting=${meetingId}`);\n      clearPresentations(meetingId, podId);\n      clearPresentationUploadToken(meetingId, podId);\n    }\n  } catch (err) {\n    Logger.error(`Error on removing presentation pod from collection: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport PresentationPods from '/imports/api/presentation-pods';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function setPresenterInPod(meetingId, podId, nextPresenterId) {\n  check(meetingId, String);\n  check(podId, String);\n  check(nextPresenterId, String);\n\n  const selector = {\n    meetingId,\n    podId,\n  };\n\n  const modifier = {\n    $set: {\n      currentPresenterId: nextPresenterId,\n    },\n  };\n\n  try {\n    const { numberAffected } = PresentationPods.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Set a new presenter in pod id=${podId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Setting a presenter in pod: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handleCreateNewPresentationPod from './handlers/createNewPresentationPod';\nimport handleRemovePresentationPod from './handlers/removePresentationPod';\nimport handleSyncGetPresentationPods from './handlers/syncGetPresentationPods';\nimport handleSetPresenterInPod from './handlers/setPresenterInPod';\n\nRedisPubSub.on('CreateNewPresentationPodEvtMsg', handleCreateNewPresentationPod);\nRedisPubSub.on('RemovePresentationPodEvtMsg', handleRemovePresentationPod);\nRedisPubSub.on('SetPresenterInPodRespMsg', handleSetPresenterInPod);\nRedisPubSub.on('SyncGetPresentationPodsRespMsg', handleSyncGetPresentationPods);\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport PresentationPods from '/imports/api/presentation-pods';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction presentationPods() {\n  if (!this.userId) {\n    return PresentationPods.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  Logger.debug('Publishing presentation-pods', { meetingId, requesterUserId });\n\n  return PresentationPods.find({ meetingId });\n}\n\nfunction publish(...args) {\n  const boundPresentationPods = presentationPods.bind(this);\n  return boundPresentationPods(...args);\n}\n\nMeteor.publish('presentation-pods', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst PresentationPods = new Mongo.Collection('presentation-pods');\n\nif (Meteor.isServer) {\n  // types of queries for the presentation pods:\n  // 1. meetingId, podId  ( 4 )\n\n  PresentationPods._ensureIndex({ meetingId: 1, podId: 1 });\n}\n\nexport default PresentationPods;\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport PresentationUploadToken from '/imports/api/presentation-upload-token';\n\nexport default function handlePresentationUploadTokenFail({ body, header }, meetingId) {\n  check(body, Object);\n\n  const { userId } = header;\n  const { podId, filename } = body;\n\n  check(userId, String);\n  check(podId, String);\n  check(filename, String);\n\n  const selector = {\n    meetingId,\n    userId,\n    podId,\n    filename,\n  };\n\n  try {\n    const { numberAffected } = PresentationUploadToken.upsert(selector, { failed: true, authzToken: null });\n\n    if (numberAffected) {\n      Logger.info(`Removing presentationToken filename=${filename} podId=${podId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Removing presentationToken from collection: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport PresentationUploadToken from '/imports/api/presentation-upload-token';\n\nexport default function handlePresentationUploadTokenPass({ body, header }, meetingId) {\n  check(body, Object);\n\n  const { userId } = header;\n  const { podId, authzToken, filename } = body;\n\n  check(userId, String);\n  check(podId, String);\n  check(authzToken, String);\n  check(filename, String);\n\n  const selector = {\n    meetingId,\n    podId,\n    userId,\n    filename,\n  };\n\n  const modifier = {\n    meetingId,\n    podId,\n    userId,\n    filename,\n    authzToken,\n    failed: false,\n    used: false,\n  };\n\n  try {\n    const { insertedId } = PresentationUploadToken.upsert(selector, modifier);\n\n    if (insertedId) {\n      Logger.info(`Inserting presentationToken filename=${filename} podId=${podId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Inserting presentationToken from collection: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { check } from 'meteor/check';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function requestPresentationUploadToken(podId, filename) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'PresentationUploadTokenReqMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  check(podId, String);\n  check(filename, String);\n\n  const payload = {\n    podId,\n    filename,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import PresentationUploadToken from '/imports/api/presentation-upload-token';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function setUsedToken(authzToken) {\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const payload = {\n    $set: {\n      used: true,\n    },\n  };\n\n  try {\n    const numberAffected = PresentationUploadToken.update({\n      meetingId,\n      userId: requesterUserId,\n      authzToken,\n    }, payload);\n\n    if (numberAffected) {\n      Logger.info(`Token: ${authzToken} has been set as used in meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Unable to set token as used : ${err}`);\n  }\n}\n","import PresentationUploadToken from '/imports/api/presentation-upload-token';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearPresentationUploadToken(meetingId, podId) {\n  if (meetingId && podId) {\n    try {\n      const numberAffected = PresentationUploadToken.remove({ meetingId, podId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared Presentations Upload Token (${meetingId}, ${podId})`);\n        return true;\n      }\n    } catch (err) {\n      Logger.info(`Error on clearing Presentations Upload Token (${meetingId}, ${podId}). ${err}`);\n      return false;\n    }\n  }\n\n  if (meetingId) {\n    try {\n      const numberAffected = PresentationUploadToken.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared Presentations Upload Token (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.info(`Error on clearing Presentations Upload Token (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      // clearing presentations for the whole server\n      const numberAffected = PresentationUploadToken.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared Presentations Upload Token (all)');\n      }\n    } catch (err) {\n      Logger.info(`Error on clearing Presentations Upload Token (all). ${err}`);\n    }\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { processForHTML5ServerOnly } from '/imports/api/common/server/helpers';\n\nimport handlePresentationUploadTokenPass from './handlers/presentationUploadTokenPass';\nimport handlePresentationUploadTokenFail from './handlers/presentationUploadTokenFail';\n\nRedisPubSub.on('PresentationUploadTokenPassRespMsg', processForHTML5ServerOnly(handlePresentationUploadTokenPass));\nRedisPubSub.on('PresentationUploadTokenFailRespMsg', processForHTML5ServerOnly(handlePresentationUploadTokenFail));\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport requestPresentationUploadToken from './methods/requestPresentationUploadToken';\nimport setUsedToken from './methods/setUsedToken';\n\nMeteor.methods({\n  requestPresentationUploadToken,\n  setUsedToken,\n});\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport PresentationUploadToken from '/imports/api/presentation-upload-token';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction presentationUploadToken(podId, filename) {\n  if (!this.userId) {\n    return PresentationUploadToken.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  check(podId, String);\n  check(filename, String);\n\n  const selector = {\n    meetingId,\n    podId,\n    userId: requesterUserId,\n    filename,\n  };\n\n  Logger.debug('Publishing PresentationUploadToken', { meetingId, requesterUserId });\n\n  return PresentationUploadToken.find(selector);\n}\n\nfunction publish(...args) {\n  const boundPresentationUploadToken = presentationUploadToken.bind(this);\n  return boundPresentationUploadToken(...args);\n}\n\nMeteor.publish('presentation-upload-token', publish);\n","const PresentationUploadToken = new Mongo.Collection('presentation-upload-token');\n\nexport default PresentationUploadToken;\n","import { check } from 'meteor/check';\nimport addPresentation from '../modifiers/addPresentation';\n\nexport default function handlePresentationAdded({ body }, meetingId) {\n  check(body, Object);\n\n  const { presentation, podId } = body;\n\n  check(meetingId, String);\n  check(podId, String);\n  check(presentation, Object);\n\n  return addPresentation(meetingId, podId, presentation);\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport Presentations from '/imports/api/presentations';\n\n// const OFFICE_DOC_CONVERSION_SUCCESS_KEY = 'OFFICE_DOC_CONVERSION_SUCCESS';\nconst OFFICE_DOC_CONVERSION_FAILED_KEY = 'OFFICE_DOC_CONVERSION_FAILED';\nconst OFFICE_DOC_CONVERSION_INVALID_KEY = 'OFFICE_DOC_CONVERSION_INVALID';\nconst SUPPORTED_DOCUMENT_KEY = 'SUPPORTED_DOCUMENT';\nconst UNSUPPORTED_DOCUMENT_KEY = 'UNSUPPORTED_DOCUMENT';\nconst PAGE_COUNT_FAILED_KEY = 'PAGE_COUNT_FAILED';\nconst PAGE_COUNT_EXCEEDED_KEY = 'PAGE_COUNT_EXCEEDED';\nconst PDF_HAS_BIG_PAGE_KEY = 'PDF_HAS_BIG_PAGE';\nconst GENERATED_SLIDE_KEY = 'GENERATED_SLIDE';\n// const GENERATING_THUMBNAIL_KEY = 'GENERATING_THUMBNAIL';\n// const GENERATED_THUMBNAIL_KEY = 'GENERATED_THUMBNAIL';\n// const GENERATING_TEXTFILES_KEY = 'GENERATING_TEXTFILES';\n// const GENERATED_TEXTFILES_KEY = 'GENERATED_TEXTFILES';\n// const GENERATING_SVGIMAGES_KEY = 'GENERATING_SVGIMAGES';\n// const GENERATED_SVGIMAGES_KEY = 'GENERATED_SVGIMAGES';\n// const CONVERSION_COMPLETED_KEY = 'CONVERSION_COMPLETED';\n\nexport default function handlePresentationConversionUpdate({ body }, meetingId) {\n  check(body, Object);\n\n  const {\n    presentationId, podId, messageKey: status, presName: presentationName,\n  } = body;\n\n  check(meetingId, String);\n  check(presentationId, String);\n  check(podId, String);\n  check(status, String);\n\n  const statusModifier = {\n    'conversion.status': status,\n    'conversion.error': false,\n    'conversion.done': false,\n  };\n\n  switch (status) {\n    case SUPPORTED_DOCUMENT_KEY:\n      statusModifier.id = presentationId;\n      statusModifier.name = presentationName;\n      break;\n\n    case UNSUPPORTED_DOCUMENT_KEY:\n    case OFFICE_DOC_CONVERSION_FAILED_KEY:\n    case OFFICE_DOC_CONVERSION_INVALID_KEY:\n    case PAGE_COUNT_FAILED_KEY:\n    case PAGE_COUNT_EXCEEDED_KEY:\n    case PDF_HAS_BIG_PAGE_KEY:\n      statusModifier.id = presentationId;\n      statusModifier.name = presentationName;\n      statusModifier['conversion.error'] = true;\n      break;\n\n    case GENERATED_SLIDE_KEY:\n      statusModifier['conversion.pagesCompleted'] = body.pagesCompleted;\n      statusModifier['conversion.numPages'] = body.numberOfPages;\n      break;\n\n    default:\n      break;\n  }\n\n  const selector = {\n    meetingId,\n    podId,\n    id: presentationId,\n  };\n\n  const modifier = {\n    $set: Object.assign({ meetingId, podId }, statusModifier),\n  };\n\n  try {\n    const { insertedId } = Presentations.upsert(selector, modifier);\n\n    if (insertedId) {\n      Logger.info(`Updated presentation conversion status=${status} id=${presentationId} meeting=${meetingId}`);\n    } else {\n      Logger.debug('Upserted presentation conversion', { status, presentationId, meetingId });\n    }\n  } catch (err) {\n    Logger.error(`Updating conversion status presentation to collection: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport setCurrentPresentation from '../modifiers/setCurrentPresentation';\n\nexport default function handlePresentationCurrentSet({ body }, meetingId) {\n  check(body, Object);\n\n  const { presentationId, podId } = body;\n\n  check(meetingId, String);\n  check(presentationId, String);\n  check(podId, String);\n\n  return setCurrentPresentation(meetingId, podId, presentationId);\n}\n","import { check } from 'meteor/check';\nimport setPresentationDownloadable from '../modifiers/setPresentationDownloadable';\n\nexport default function handlePresentationDownloadableSet({ body }, meetingId) {\n  check(body, Object);\n\n  const { presentationId, podId, downloadable } = body;\n\n  check(meetingId, String);\n  check(presentationId, String);\n  check(podId, String);\n  check(downloadable, Boolean);\n\n  return setPresentationDownloadable(meetingId, podId, presentationId, downloadable);\n}\n","import { check } from 'meteor/check';\n\nimport removePresentation from '../modifiers/removePresentation';\n\nexport default function handlePresentationRemove({ body }, meetingId) {\n  const { podId, presentationId } = body;\n\n  check(meetingId, String);\n  check(podId, String);\n  check(presentationId, String);\n\n  return removePresentation(meetingId, podId, presentationId);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { check } from 'meteor/check';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function removePresentation(presentationId, podId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'RemovePresentationPubMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(presentationId, String);\n  check(podId, String);\n\n  const payload = {\n    presentationId,\n    podId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { check } from 'meteor/check';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function setPresentation(presentationId, podId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'SetCurrentPresentationPubMsg';\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(presentationId, String);\n  check(podId, String);\n\n  const payload = {\n    presentationId,\n    podId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { check } from 'meteor/check';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function setPresentationDownloadable(presentationId, downloadable) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'SetPresentationDownloadablePubMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(downloadable, Boolean);\n  check(presentationId, String);\n\n  const payload = {\n    presentationId,\n    podId: 'DEFAULT_PRESENTATION_POD',\n    downloadable,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { HTTP } from 'meteor/http';\nimport { check } from 'meteor/check';\nimport Presentations from '/imports/api/presentations';\nimport Logger from '/imports/startup/server/logger';\nimport flat from 'flat';\nimport addSlide from '/imports/api/slides/server/modifiers/addSlide';\nimport setCurrentPresentation from './setCurrentPresentation';\n\nconst getSlideText = async (url) => {\n  let content = '';\n  try {\n    content = await HTTP.get(url).content;\n  } catch (error) {\n    Logger.error(`No file found. ${error}`);\n  }\n  return content;\n};\n\nconst addSlides = (meetingId, podId, presentationId, slides) => {\n  slides.forEach(async (slide) => {\n    const content = await getSlideText(slide.txtUri);\n\n    Object.assign(slide, { content });\n\n    addSlide(meetingId, podId, presentationId, slide);\n  });\n};\n\nexport default function addPresentation(meetingId, podId, presentation) {\n  check(meetingId, String);\n  check(podId, String);\n  check(presentation, {\n    id: String,\n    name: String,\n    current: Boolean,\n    pages: [\n      {\n        id: String,\n        num: Number,\n        thumbUri: String,\n        swfUri: String,\n        txtUri: String,\n        svgUri: String,\n        current: Boolean,\n        xOffset: Number,\n        yOffset: Number,\n        widthRatio: Number,\n        heightRatio: Number,\n      },\n    ],\n    downloadable: Boolean,\n  });\n\n  const selector = {\n    meetingId,\n    podId,\n    id: presentation.id,\n  };\n\n  const modifier = {\n    $set: Object.assign({\n      meetingId,\n      podId,\n      'conversion.done': true,\n      'conversion.error': false,\n    }, flat(presentation, { safe: true })),\n  };\n\n  try {\n    const { insertedId } = Presentations.upsert(selector, modifier);\n\n    addSlides(meetingId, podId, presentation.id, presentation.pages);\n    \n    if (insertedId) {\n      if (presentation.current) {\n        setCurrentPresentation(meetingId, podId, presentation.id);\n        Logger.info(`Added presentation id=${presentation.id} meeting=${meetingId}`);\n      } else {\n        Logger.info(`Upserted presentation id=${presentation.id} meeting=${meetingId}`);\n      }\n    }\n  } catch (err) {\n    Logger.error(`Adding presentation to collection: ${err}`);\n  }\n}\n","import Presentations from '/imports/api/presentations';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearPresentations(meetingId, podId) {\n  // clearing presentations for 1 pod\n  if (meetingId && podId) {\n    try {\n      const numberAffected = Presentations.remove({ meetingId, podId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared Presentations (${meetingId}, ${podId})`);\n        return true;\n      }\n    } catch (err) {\n      Logger.error(`Error on cleaning Presentations (${meetingId}, ${podId}). ${err}`);\n      return false;\n    }\n  }\n\n  // clearing presentations for the whole meeting\n  if (meetingId) {\n    try {\n      const numberAffected = Presentations.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared Presentations (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.error(`Error on cleaning Presentations (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = Presentations.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared Presentations (all)');\n      }\n    } catch (err) {\n      Logger.error(`Error on cleaning Presentations (all). ${err}`);\n    }\n  }\n}\n","import { check } from 'meteor/check';\nimport Presentations from '/imports/api/presentations';\nimport Logger from '/imports/startup/server/logger';\n\nimport clearSlidesPresentation from '/imports/api/slides/server/modifiers/clearSlidesPresentation';\n\nexport default function removePresentation(meetingId, podId, presentationId) {\n  check(meetingId, String);\n  check(presentationId, String);\n  check(podId, String);\n\n  const selector = {\n    meetingId,\n    podId,\n    id: presentationId,\n  };\n\n  try {\n    const numberAffected = Presentations.remove(selector);\n\n    if (numberAffected) {\n      clearSlidesPresentation(meetingId, presentationId);\n      Logger.info(`Removed presentation id=${presentationId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Removing presentation from collection: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport Presentations from '/imports/api/presentations';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function setCurrentPresentation(meetingId, podId, presentationId) {\n  check(meetingId, String);\n  check(presentationId, String);\n  check(podId, String);\n\n  const oldCurrent = {\n    selector: {\n      meetingId,\n      podId,\n      current: true,\n    },\n    modifier: {\n      $set: { current: false },\n    },\n    callback: (err) => {\n      if (err) {\n        Logger.error(`Unsetting the current presentation: ${err}`);\n        return;\n      }\n\n      Logger.info('Unsetted as current presentation');\n      return;\n    },\n  };\n\n  const newCurrent = {\n    selector: {\n      meetingId,\n      podId,\n      id: presentationId,\n    },\n    modifier: {\n      $set: { current: true },\n    },\n    callback: (err) => {\n      if (err) {\n        Logger.error(`Setting as current presentation id=${presentationId}: ${err}`);\n        return;\n      }\n\n      Logger.info(`Setted as current presentation id=${presentationId}`);\n      return;\n    },\n  };\n\n  const oldPresentation = Presentations.findOne(oldCurrent.selector);\n  const newPresentation = Presentations.findOne(newCurrent.selector);\n\n  // Prevent bug with presentation being unset, same happens in the slide\n  // See: https://github.com/bigbluebutton/bigbluebutton/pull/4431\n  if (oldPresentation && newPresentation && (oldPresentation._id === newPresentation._id)) {\n    return;\n  }\n\n  if (newPresentation) {\n    Presentations.update(newPresentation._id, newCurrent.modifier, newCurrent.callback);\n  }\n\n  if (oldPresentation) {\n    Presentations.update(oldPresentation._id, oldCurrent.modifier, oldCurrent.callback);\n  }\n}\n","import { check } from 'meteor/check';\nimport Presentations from '/imports/api/presentations';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function setPresentationDownloadable(meetingId, podId,\n  presentationId, downloadable) {\n  check(meetingId, String);\n  check(presentationId, String);\n  check(podId, String);\n  check(downloadable, Boolean);\n\n  const selector = {\n    meetingId,\n    podId,\n    id: presentationId,\n  };\n\n  const modifier = {\n    $set: {\n      downloadable,\n    },\n  };\n\n  try {\n    const { numberAffected } = Presentations.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Set downloadable status on presentation {${presentationId} in meeting {${meetingId}}`);\n    }\n  } catch (err) {\n    Logger.error(`Could not set downloadable on pres {${presentationId} in meeting {${meetingId}} ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handlePresentationAdded from './handlers/presentationAdded';\nimport handlePresentationRemove from './handlers/presentationRemove';\nimport handlePresentationCurrentSet from './handlers/presentationCurrentSet';\nimport handlePresentationConversionUpdate from './handlers/presentationConversionUpdate';\nimport handlePresentationDownloadableSet from './handlers/presentationDownloadableSet';\n\nRedisPubSub.on('PdfConversionInvalidErrorEvtMsg', handlePresentationConversionUpdate);\nRedisPubSub.on('PresentationPageGeneratedEvtMsg', handlePresentationConversionUpdate);\nRedisPubSub.on('PresentationPageCountErrorEvtMsg', handlePresentationConversionUpdate);\nRedisPubSub.on('PresentationConversionUpdateEvtMsg', handlePresentationConversionUpdate);\nRedisPubSub.on('PresentationConversionCompletedEvtMsg', handlePresentationAdded);\nRedisPubSub.on('RemovePresentationEvtMsg', handlePresentationRemove);\nRedisPubSub.on('SetCurrentPresentationEvtMsg', handlePresentationCurrentSet);\nRedisPubSub.on('SetPresentationDownloadableEvtMsg', handlePresentationDownloadableSet);\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport removePresentation from './methods/removePresentation';\nimport setPresentation from './methods/setPresentation';\nimport setPresentationDownloadable from './methods/setPresentationDownloadable';\n\nMeteor.methods({\n  removePresentation,\n  setPresentation,\n  setPresentationDownloadable,\n});\n","import { Meteor } from 'meteor/meteor';\nimport Presentations from '/imports/api/presentations';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction presentations() {\n  if (!this.userId) {\n    return Presentations.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing Presentations', { meetingId, requesterUserId });\n\n  return Presentations.find({ meetingId });\n}\n\nfunction publish(...args) {\n  const boundPresentations = presentations.bind(this);\n  return boundPresentations(...args);\n}\n\nMeteor.publish('presentations', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst Presentations = new Mongo.Collection('presentations');\n\nif (Meteor.isServer) {\n  // types of queries for the presentations:\n  // 1. meetingId, podId, id        ( 3 )\n  // 2. meetingId, id               ( 1 )\n  // 3. meetingId, id, current      ( 2 )\n  // 4. meetingId                   ( 1 )\n\n  Presentations._ensureIndex({ meetingId: 1, podId: 1, id: 1 });\n}\n\nexport default Presentations;\n","import { check } from 'meteor/check';\nimport Meetings from '/imports/api/meetings';\nimport Users from '/imports/api/users';\nimport addScreenshare from '../modifiers/addScreenshare';\nimport Logger from '/imports/startup/server/logger';\nimport stopWatchingExternalVideo from '/imports/api/external-videos/server/methods/stopWatchingExternalVideo';\n\nexport default function handleScreenshareStarted({ body }, meetingId) {\n  check(meetingId, String);\n  check(body, Object);\n\n  const meeting = Meetings.findOne({ meetingId });\n  const presenter = Users.findOne({ meetingId, presenter: true });\n  const presenterId = presenter && presenter.userId ? presenter.userId : 'system-screenshare-starting';\n  if (meeting && meeting.externalVideoUrl) {\n    Logger.info(`ScreenshareStarted: There is external video being shared. Stopping it due to presenter change, ${meeting.externalVideoUrl}`);\n    stopWatchingExternalVideo({ meetingId, requesterUserId: presenterId });\n  }\n  return addScreenshare(meetingId, body);\n}\n","import { check } from 'meteor/check';\nimport clearScreenshare from '../modifiers/clearScreenshare';\n\nexport default function handleScreenshareStopped({ body }, meetingId) {\n  const { screenshareConf } = body;\n\n  check(meetingId, String);\n  check(screenshareConf, String);\n\n  return clearScreenshare(meetingId, screenshareConf);\n}\n","import { check } from 'meteor/check';\nimport flat from 'flat';\nimport Logger from '/imports/startup/server/logger';\nimport Screenshare from '/imports/api/screenshare';\n\nexport default function addScreenshare(meetingId, body) {\n  check(meetingId, String);\n\n  const selector = {\n    meetingId,\n  };\n\n  const modifier = {\n    $set: {\n      meetingId,\n      screenshare: flat(body),\n    },\n  };\n\n  try {\n    const { numberAffected } = Screenshare.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Upserted screenshare id=${body.screenshareConf}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding screenshare to collection: ${err}`);\n  }\n}\n","import Logger from '/imports/startup/server/logger';\nimport Screenshare from '/imports/api/screenshare';\n\nexport default function clearScreenshare(meetingId, screenshareConf) {\n  try {\n    let numberAffected;\n\n    if (meetingId && screenshareConf) {\n      numberAffected = Screenshare.remove({ meetingId, 'screenshare.screenshareConf': screenshareConf });\n    } else if (meetingId) {\n      numberAffected = Screenshare.remove({ meetingId });\n    } else {\n      numberAffected = Screenshare.remove({});\n    }\n\n    if (numberAffected) {\n      Logger.info(`removed screenshare meetingId=${meetingId} id=${screenshareConf}`);\n    }\n  } catch (err) {\n    Logger.error(`removing screenshare to collection: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handleScreenshareStarted from './handlers/screenshareStarted';\nimport handleScreenshareStopped from './handlers/screenshareStopped';\n\nRedisPubSub.on('ScreenshareRtmpBroadcastStartedEvtMsg', handleScreenshareStarted);\nRedisPubSub.on('ScreenshareRtmpBroadcastStoppedEvtMsg', handleScreenshareStopped);\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\n\nMeteor.methods({\n});\n","import Screenshare from '/imports/api/screenshare';\nimport { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction screenshare() {\n  if (!this.userId) {\n    return Screenshare.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing Screenshare', { meetingId, requesterUserId });\n\n  return Screenshare.find({ meetingId });\n}\n\nfunction publish(...args) {\n  const boundScreenshare = screenshare.bind(this);\n  return boundScreenshare(...args);\n}\n\nMeteor.publish('screenshare', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst Screenshare = new Mongo.Collection('screenshare');\n\nif (Meteor.isServer) {\n  // types of queries for the screenshare:\n  // 1. meetingId\n\n  Screenshare._ensureIndex({ meetingId: 1 });\n}\n\nexport default Screenshare;\n","import { check } from 'meteor/check';\nimport changeCurrentSlide from '../modifiers/changeCurrentSlide';\n\nexport default function handleSlideChange({ body }, meetingId) {\n  const { pageId, presentationId, podId } = body;\n\n  check(pageId, String);\n  check(presentationId, String);\n  check(podId, String);\n\n  return changeCurrentSlide(meetingId, podId, presentationId, pageId);\n}\n","import { check } from 'meteor/check';\nimport resizeSlide from '../modifiers/resizeSlide';\n\nexport default function handleSlideResize({ body }, meetingId) {\n  check(meetingId, String);\n  check(body, Object);\n\n  return resizeSlide(meetingId, body);\n}\n","import Presentations from '/imports/api/presentations';\nimport { Slides } from '/imports/api/slides';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function switchSlide(slideNumber, podId) { // TODO-- send presentationId and SlideId\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'SetCurrentPagePubMsg';\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  check(slideNumber, Number);\n\n  const selector = {\n    meetingId,\n    podId,\n    current: true,\n  };\n\n  const Presentation = Presentations.findOne(selector);\n\n  if (!Presentation) {\n    throw new Meteor.Error('presentation-not-found', 'You need a presentation to be able to switch slides');\n  }\n\n  const Slide = Slides.findOne({\n    meetingId,\n    podId,\n    presentationId: Presentation.id,\n    num: slideNumber,\n  });\n\n  if (!Slide) {\n    throw new Meteor.Error('slide-not-found', `Slide number ${slideNumber} not found in the current presentation`);\n  }\n\n  const payload = {\n    podId,\n    presentationId: Presentation.id,\n    pageId: Slide.id,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import Presentations from '/imports/api/presentations';\nimport { Slides } from '/imports/api/slides';\nimport { Meteor } from 'meteor/meteor';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function zoomSlide(slideNumber, podId, widthRatio, heightRatio, x, y) { // TODO-- send presentationId and SlideId\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'ResizeAndMovePagePubMsg';\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const selector = {\n    meetingId,\n    podId,\n    current: true,\n  };\n  const Presentation = Presentations.findOne(selector);\n\n  if (!Presentation) {\n    throw new Meteor.Error('presentation-not-found', 'You need a presentation to be able to switch slides');\n  }\n\n  const Slide = Slides.findOne({\n    meetingId,\n    podId,\n    presentationId: Presentation.id,\n    num: slideNumber,\n  });\n\n  if (!Slide) {\n    throw new Meteor.Error('slide-not-found', `Slide number ${slideNumber} not found in the current presentation`);\n  }\n\n  const payload = {\n    podId,\n    presentationId: Presentation.id,\n    pageId: Slide.id,\n    xOffset: x,\n    yOffset: y,\n    widthRatio,\n    heightRatio,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import probe from 'probe-image-size';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport flat from 'flat';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { Slides } from '/imports/api/slides';\nimport Logger from '/imports/startup/server/logger';\nimport { SVG, PNG } from '/imports/utils/mimeTypes';\nimport calculateSlideData from '/imports/api/slides/server/helpers';\nimport addSlidePositions from './addSlidePositions';\n\nconst loadSlidesFromHttpAlways = Meteor.settings.private.app.loadSlidesFromHttpAlways || false;\n\nconst requestWhiteboardHistory = (meetingId, slideId) => {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'GetWhiteboardAnnotationsReqMsg';\n  const USER_ID = 'nodeJSapp';\n\n  const payload = {\n    whiteboardId: slideId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, USER_ID, payload);\n};\n\nconst SUPPORTED_TYPES = [SVG, PNG];\n\nconst fetchImageSizes = imageUri => probe(imageUri)\n  .then((result) => {\n    if (!SUPPORTED_TYPES.includes(result.mime)) {\n      throw new Meteor.Error('invalid-image-type', `received ${result.mime} expecting ${SUPPORTED_TYPES.join()}`);\n    }\n\n    return {\n      width: result.width,\n      height: result.height,\n    };\n  })\n  .catch((reason) => {\n    Logger.error(`Error parsing image size. ${reason}. uri=${imageUri}`);\n    return reason;\n  });\n\nexport default function addSlide(meetingId, podId, presentationId, slide) {\n  check(podId, String);\n  check(presentationId, String);\n\n  check(slide, {\n    id: String,\n    num: Number,\n    thumbUri: String,\n    swfUri: String,\n    txtUri: String,\n    svgUri: String,\n    current: Boolean,\n    xOffset: Number,\n    yOffset: Number,\n    widthRatio: Number,\n    heightRatio: Number,\n    content: String,\n  });\n\n  const {\n    id: slideId,\n    xOffset,\n    yOffset,\n    widthRatio,\n    heightRatio,\n    ...restSlide\n  } = slide;\n\n  const selector = {\n    meetingId,\n    podId,\n    presentationId,\n    id: slideId,\n  };\n\n  const imageUri = slide.svgUri || slide.pngUri;\n\n  const modifier = {\n    $set: Object.assign(\n      { meetingId },\n      { podId },\n      { presentationId },\n      { id: slideId },\n      { imageUri },\n      flat(restSlide),\n      { safe: true },\n    ),\n  };\n\n  const imageSizeUri = (loadSlidesFromHttpAlways ? imageUri.replace(/^https/i, 'http') : imageUri);\n\n  return fetchImageSizes(imageSizeUri)\n    .then(({ width, height }) => {\n      // there is a rare case when for a very long not-active meeting the presentation\n      // files just disappear and width/height can't be retrieved\n      if (width && height) {\n        // pre-calculating the width, height, and vieBox coordinates / dimensions\n        // to unload the client-side\n        const slideData = {\n          width,\n          height,\n          xOffset,\n          yOffset,\n          widthRatio,\n          heightRatio,\n        };\n        const slidePosition = calculateSlideData(slideData);\n\n        addSlidePositions(meetingId, podId, presentationId, slideId, slidePosition);\n      }\n\n      try {\n        const { insertedId, numberAffected } = Slides.upsert(selector, modifier);\n\n        requestWhiteboardHistory(meetingId, slideId);\n\n        if (insertedId) {\n          Logger.info(`Added slide id=${slideId} pod=${podId} presentation=${presentationId}`);\n        } else if (numberAffected) {\n          Logger.info(`Upserted slide id=${slideId} pod=${podId} presentation=${presentationId}`);\n        }\n\n      } catch (err) {\n        Logger.error(`Error on adding slide to collection: ${err}`);\n      }\n    })\n    .catch(reason => Logger.error(`Error parsing image size. ${reason}. slide=${slideId} uri=${imageUri}`));\n}\n","import { SlidePositions } from '/imports/api/slides';\nimport Logger from '/imports/startup/server/logger';\nimport { check } from 'meteor/check';\nimport flat from 'flat';\n\nexport default function addSlidePositions(\n  meetingId,\n  podId,\n  presentationId,\n  slideId,\n  slidePosition,\n) {\n  check(meetingId, String);\n  check(podId, String);\n  check(presentationId, String);\n  check(slideId, String);\n\n  check(slidePosition, {\n    width: Number,\n    height: Number,\n    x: Number,\n    y: Number,\n    viewBoxWidth: Number,\n    viewBoxHeight: Number,\n  });\n\n  const selector = {\n    meetingId,\n    podId,\n    presentationId,\n    id: slideId,\n  };\n\n  const modifier = {\n    $set: Object.assign(\n      { meetingId },\n      { podId },\n      { presentationId },\n      { id: slideId },\n      flat(slidePosition),\n      { safe: true },\n    ),\n  };\n\n  try {\n    const { insertedId } = SlidePositions.upsert(selector, modifier);\n\n    if (insertedId) {\n      Logger.info(`Added slide position id=${slideId} pod=${podId} presentation=${presentationId}`);\n    } else {\n      Logger.info(`Upserted slide position id=${slideId} pod=${podId} presentation=${presentationId}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding slide position to collection: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport { Slides } from '/imports/api/slides';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function changeCurrentSlide(meetingId, podId, presentationId, slideId) {\n  check(meetingId, String);\n  check(presentationId, String);\n  check(slideId, String);\n  check(podId, String);\n\n  const oldCurrent = {\n    selector: {\n      meetingId,\n      podId,\n      presentationId,\n      current: true,\n    },\n    modifier: {\n      $set: { current: false },\n    },\n    callback: (err) => {\n      if (err) {\n        Logger.error(`Unsetting the current slide: ${err}`);\n        return;\n      }\n\n      Logger.info('Unsetted the current slide');\n      return;\n    },\n  };\n\n  const newCurrent = {\n    selector: {\n      meetingId,\n      podId,\n      presentationId,\n      id: slideId,\n    },\n    modifier: {\n      $set: { current: true },\n    },\n    callback: (err) => {\n      if (err) {\n        Logger.error(`Setting as current slide id=${slideId}: ${err}`);\n        return;\n      }\n\n      Logger.info(`Setted as current slide id=${slideId}`);\n      return;\n    },\n  };\n\n  const oldSlide = Slides.findOne(oldCurrent.selector);\n  const newSlide = Slides.findOne(newCurrent.selector);\n\n  // if the oldCurrent and newCurrent have the same ids\n  if (oldSlide && newSlide && (oldSlide._id === newSlide._id)) {\n    return;\n  }\n\n  if (newSlide) {\n    Slides.update(newSlide._id, newCurrent.modifier, newCurrent.callback);\n  }\n\n  if (oldSlide) {\n    Slides.update(oldSlide._id, oldCurrent.modifier, oldCurrent.callback);\n  }\n}\n","import { Slides, SlidePositions } from '/imports/api/slides';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearSlides(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffectedSlidePositions = SlidePositions.remove({ meetingId });\n\n      const numberAffected = Slides.remove({ meetingId });\n\n      if (numberAffectedSlidePositions) {\n        Logger.info(`Cleared SlidePositions (${meetingId})`);\n      }\n\n      if (numberAffected) {\n        Logger.info(`Cleared Slides (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.error(`Error on cleaning Slides (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffectedSlidePositions = SlidePositions.remove({ meetingId });\n\n      const numberAffected = Slides.remove({ meetingId });\n\n      if (numberAffectedSlidePositions) {\n        Logger.info(`Cleared SlidePositions (${meetingId})`);\n      }\n\n      if (numberAffected) {\n        Logger.info('Cleared Slides (all)');\n      }\n    } catch (err) {\n      Logger.error(`Error on cleaning Slides (all). ${err}`);\n    }\n  }\n}\n","import { Slides, SlidePositions } from '/imports/api/slides';\nimport Logger from '/imports/startup/server/logger';\nimport { check } from 'meteor/check';\nimport clearAnnotations from '/imports/api/annotations/server/modifiers/clearAnnotations';\n\nexport default function clearSlidesPresentation(meetingId, presentationId) {\n  check(meetingId, String);\n  check(presentationId, String);\n\n  const selector = {\n    meetingId,\n    presentationId,\n  };\n\n  const whiteboardIds = Slides.find(selector, { fields: { id: 1 } }).map(row => row.id);\n\n  try {\n    SlidePositions.remove(selector);\n\n    const numberAffected = Slides.remove(selector);\n\n    if (numberAffected) {\n      whiteboardIds.forEach(whiteboardId => clearAnnotations(meetingId, whiteboardId));\n\n      Logger.info(`Removed Slides where presentationId=${presentationId}`);\n    }\n  } catch (err) {\n    Logger.error(`Removing Slides from collection: ${err}`);\n    return;\n  }\n}\n","import { check } from 'meteor/check';\nimport { SlidePositions } from '/imports/api/slides';\nimport Logger from '/imports/startup/server/logger';\nimport calculateSlideData from '/imports/api/slides/server/helpers';\n\nexport default function resizeSlide(meetingId, slide) {\n  check(meetingId, String);\n\n  const {\n    podId,\n    presentationId,\n    pageId,\n    widthRatio,\n    heightRatio,\n    xOffset,\n    yOffset,\n  } = slide;\n\n  const selector = {\n    meetingId,\n    podId,\n    presentationId,\n    id: pageId,\n  };\n\n  // fetching the current slide data\n  // and pre-calculating the width, height, and vieBox coordinates / sizes\n  // to reduce the client-side load\n  const SlidePosition = SlidePositions.findOne(selector);\n\n  if (SlidePosition) {\n    const {\n      width,\n      height,\n    } = SlidePosition;\n\n    const slideData = {\n      width,\n      height,\n      xOffset,\n      yOffset,\n      widthRatio,\n      heightRatio,\n    };\n    const calculatedData = calculateSlideData(slideData);\n\n    const modifier = {\n      $set: calculatedData,\n    };\n\n    try {\n      const numberAffected = SlidePositions.update(selector, modifier);\n\n      if (numberAffected) {\n        Logger.debug(`Resized slide positions id=${pageId}`);\n      } else {\n        Logger.info(`No slide positions found with id=${pageId}`);\n      }\n    } catch (err) {\n      Logger.error(`Resizing slide positions id=${pageId}: ${err}`);\n    }\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handleSlideResize from './handlers/slideResize';\nimport handleSlideChange from './handlers/slideChange';\n\nRedisPubSub.on('ResizeAndMovePageEvtMsg', handleSlideResize);\nRedisPubSub.on('SetCurrentPageEvtMsg', handleSlideChange);\n","\nconst calculateSlideData = (slideData) => {\n  const {\n    width, height, xOffset, yOffset, widthRatio, heightRatio,\n  } = slideData;\n\n  // calculating viewBox and offsets for the current presentation\n  return {\n    width,\n    height,\n    x: ((-xOffset * 2) * width) / 100,\n    y: ((-yOffset * 2) * height) / 100,\n    viewBoxWidth: (width * widthRatio) / 100,\n    viewBoxHeight: (height * heightRatio) / 100,\n  };\n};\n\nexport default calculateSlideData;\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport switchSlide from './methods/switchSlide';\nimport zoomSlide from './methods/zoomSlide';\n\nMeteor.methods({\n  switchSlide,\n  zoomSlide,\n});\n","import { Slides, SlidePositions } from '/imports/api/slides';\nimport { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction slides() {\n  if (!this.userId) {\n    return Slides.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  Logger.debug('Publishing Slides', { meetingId, requesterUserId });\n\n  return Slides.find({ meetingId });\n}\n\nfunction publish(...args) {\n  const boundSlides = slides.bind(this);\n  return boundSlides(...args);\n}\n\nMeteor.publish('slides', publish);\n\nfunction slidePositions() {\n  if (!this.userId) {\n    return SlidePositions.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing SlidePositions', { meetingId, requesterUserId });\n\n  return SlidePositions.find({ meetingId });\n}\n\nfunction publishPositions(...args) {\n  const boundSlidePositions = slidePositions.bind(this);\n  return boundSlidePositions(...args);\n}\n\nMeteor.publish('slide-positions', publishPositions);\n","import { Meteor } from 'meteor/meteor';\n\nconst Slides = new Mongo.Collection('slides');\nconst SlidePositions = new Mongo.Collection('slide-positions');\n\nif (Meteor.isServer) {\n  // types of queries for the slides:\n\n  // 1. meetingId                                  ( 1 )\n  // 2. meetingId, podId                           ( 1 )\n  // 3. meetingId, presentationId                  ( 1 )\n  // 3. meetingId, presentationId, num             ( 1 )\n  // 4. meetingId, podId, presentationId, id       ( 3 ) - incl. resizeSlide, which can be intense\n  // 5. meetingId, podId, presentationId, current  ( 1 )\n\n  Slides._ensureIndex({\n    meetingId: 1, podId: 1, presentationId: 1, id: 1,\n  });\n\n  SlidePositions._ensureIndex({\n    meetingId: 1, podId: 1, presentationId: 1, id: 1,\n  });\n}\n\nexport { Slides, SlidePositions };\n","import { check } from 'meteor/check';\nimport changeRole from '/imports/api/users/server/modifiers/changeRole';\n\nexport default function handleChangeRole(payload, meetingId) {\n  check(payload.body, Object);\n  check(meetingId, String);\n\n  const { userId, role, changedBy } = payload.body;\n\n  changeRole(role, userId, meetingId, changedBy);\n}\n","import Logger from '/imports/startup/server/logger';\nimport { check } from 'meteor/check';\nimport Users from '/imports/api/users';\n\nexport default function handleEmojiStatus({ body }, meetingId) {\n  const { userId, emoji } = body;\n\n  check(userId, String);\n  check(emoji, String);\n\n  const selector = {\n    meetingId,\n    userId,\n  };\n\n  const modifier = {\n    $set: {\n      emojiTime: (new Date()).getTime(),\n      emoji,\n    },\n  };\n\n  try {\n    const numberAffected = Users.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Assigned user emoji status ${emoji} id=${userId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Assigning user emoji status: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport Users from '/imports/api/users/';\nimport addUser from '../modifiers/addUser';\nimport removeUser from '../modifiers/removeUser';\n\nexport default function handleGetUsers({ body }, meetingId) {\n  const { users } = body;\n\n  check(meetingId, String);\n  check(users, Array);\n\n  const usersIds = users.map(m => m.intId);\n\n  const usersToRemove = Users.find({\n    meetingId,\n    userId: { $nin: usersIds },\n  }, { fields: { userId: 1 } }).fetch();\n\n  usersToRemove.forEach(user => removeUser(meetingId, user.userId));\n\n  const usersAdded = [];\n  users.forEach((user) => {\n    usersAdded.push(addUser(meetingId, user));\n  });\n\n  return usersAdded;\n}\n","import Users from '/imports/api/users';\nimport PresentationPods from '/imports/api/presentation-pods';\nimport changePresenter from '/imports/api/users/server/modifiers/changePresenter';\nimport RedisPubSub from '/imports/startup/server/redis';\n\nfunction setPresenterInPodReqMsg(credentials) { // TODO-- switch to meetingId, etc\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'SetPresenterInPodReqMsg';\n\n  const { meetingId, requesterUserId, presenterId } = credentials;\n\n  const payload = {\n    podId: 'DEFAULT_PRESENTATION_POD',\n    nextPresenterId: presenterId,\n  };\n\n  RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n\nexport default function handlePresenterAssigned({ body }, meetingId) {\n  const { presenterId, assignedBy } = body;\n\n  changePresenter(true, presenterId, meetingId, assignedBy);\n\n  const selector = {\n    meetingId,\n    userId: { $ne: presenterId },\n    presenter: true,\n  };\n\n  const prevPresenter = Users.findOne(selector);\n\n  // no previous presenters\n  // The below code is responsible for set Meeting presenter to be default pod presenter as well.\n  // It's been handled here because right now akka-apps don't handle all cases scenarios.\n  if (!prevPresenter) {\n    const setPresenterPayload = {\n      meetingId,\n      requesterUserId: assignedBy,\n      presenterId,\n    };\n\n    const defaultPodSelector = {\n      meetingId,\n      podId: 'DEFAULT_PRESENTATION_POD',\n    };\n    const currentDefaultPodPresenter = PresentationPods.findOne(defaultPodSelector);\n    const { currentPresenterId } = currentDefaultPodPresenter;\n\n    if (currentPresenterId === '') {\n      return setPresenterInPodReqMsg(setPresenterPayload);\n    }\n\n    const oldPresenter = Users.findOne({ meetingId, userId: currentPresenterId, connectionStatus: 'offline' });\n\n    if (oldPresenter) {\n      return setPresenterInPodReqMsg(setPresenterPayload);\n    }\n\n    return true;\n  }\n\n  changePresenter(false, prevPresenter.userId, meetingId, assignedBy);\n}\n","import { check } from 'meteor/check';\n\nimport removeUser from '../modifiers/removeUser';\n\nexport default function handleRemoveUser({ body }, meetingId) {\n  const { intId } = body;\n\n  check(meetingId, String);\n  check(intId, String);\n\n  return removeUser(meetingId, intId);\n}\n","import userEjected from '../modifiers/userEjected';\n\nexport default function handleEjectedUser({ header, body }) {\n  const { meetingId, userId } = header;\n  const { reasonCode } = body;\n\n  userEjected(meetingId, userId, reasonCode);\n}\n","import { check } from 'meteor/check';\nimport userInactivityInspect from '../modifiers/userInactivityInspect';\n\nexport default function handleUserInactivityInspect({ header, body }, meetingId) {\n  const { userId } = header;\n  const { responseDelay } = body;\n\n  check(userId, String);\n  check(responseDelay, Match.Integer);\n  check(meetingId, String);\n\n\n  userInactivityInspect(userId, responseDelay);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function userJoin(meetingId, userId, authToken) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'UserJoinMeetingReqMsg';\n\n  check(authToken, String);\n\n  const payload = {\n    userId,\n    authToken,\n    clientType: 'HTML5',\n  };\n\n  Logger.info(`User='${userId}' is joining meeting='${meetingId}' authToken='${authToken}'`);\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, userId, payload);\n}\n","import { check } from 'meteor/check';\n\nimport addUser from '../modifiers/addUser';\n\nexport default function handleUserJoined({ body }, meetingId) {\n  const user = body;\n\n  check(user, Object);\n\n  addUser(meetingId, user);\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\nimport userJoin from './userJoin';\nimport pendingAuthenticationsStore from '../store/pendingAuthentications';\nimport createDummyUser from '../modifiers/createDummyUser';\nimport setConnectionIdAndAuthToken from '../modifiers/setConnectionIdAndAuthToken';\n\nconst clearOtherSessions = (sessionUserId, current = false) => {\n  const serverSessions = Meteor.server.sessions;\n  Object.keys(serverSessions)\n    .filter(i => serverSessions[i].userId === sessionUserId)\n    .filter(i => i !== current)\n    .forEach(i => serverSessions[i].close());\n};\n\nexport default function handleValidateAuthToken({ body }, meetingId) {\n  const {\n    userId,\n    valid,\n    authToken,\n    waitForApproval,\n  } = body;\n\n  check(userId, String);\n  check(authToken, String);\n  check(valid, Boolean);\n  check(waitForApproval, Boolean);\n\n  const pendingAuths = pendingAuthenticationsStore.take(meetingId, userId, authToken);\n\n  if (!valid) {\n    pendingAuths.forEach(\n      (pendingAuth) => {\n        try {\n          const { methodInvocationObject } = pendingAuth;\n          const connectionId = methodInvocationObject.connection.id;\n\n          // Schedule socket disconnection for this user, giving some time for client receiving the reason of disconnection\n          Meteor.setTimeout(() => {\n            methodInvocationObject.connection.close();\n          }, 2000);\n\n          Logger.info(`Closed connection ${connectionId} due to invalid auth token.`);\n        } catch (e) {\n          Logger.error(`Error closing socket for meetingId '${meetingId}', userId '${userId}', authToken ${authToken}`);\n        }\n      },\n    );\n\n    return;\n  }\n\n  if (valid) {\n    // Define user ID on connections\n    pendingAuths.forEach(\n      (pendingAuth) => {\n        const { methodInvocationObject } = pendingAuth;\n\n        /* Logic migrated from validateAuthToken method ( postponed to only run in case of success response ) - Begin */\n        const sessionId = `${meetingId}--${userId}`;\n\n        methodInvocationObject.setUserId(sessionId);\n\n        const User = Users.findOne({\n          meetingId,\n          userId,\n        });\n\n        if (!User) {\n          createDummyUser(meetingId, userId, authToken);\n        }\n\n        setConnectionIdAndAuthToken(meetingId, userId, methodInvocationObject.connection.id, authToken);\n        /* End of logic migrated from validateAuthToken */\n      },\n    );\n  }\n\n  const selector = {\n    meetingId,\n    userId,\n    clientType: 'HTML5',\n  };\n\n  const User = Users.findOne(selector);\n\n  // If we dont find the user on our collection is a flash user and we can skip\n  if (!User) return;\n\n  // Publish user join message\n  if (valid && !waitForApproval) {\n    Logger.info('User=', User);\n    userJoin(meetingId, userId, User.authToken);\n  }\n\n  const modifier = {\n    $set: {\n      validated: valid,\n      approved: !waitForApproval,\n      loginTime: Date.now(),\n      inactivityCheck: false,\n    },\n  };\n\n  try {\n    const numberAffected = Users.update(selector, modifier);\n\n    if (numberAffected) {\n      if (valid) {\n        const sessionUserId = `${meetingId}-${userId}`;\n        const currentConnectionId = User.connectionId ? User.connectionId : false;\n        clearOtherSessions(sessionUserId, currentConnectionId);\n      }\n\n      Logger.info(`Validated auth token as ${valid} user=${userId} meeting=${meetingId}`);\n    } else {\n      Logger.info('No auth to validate');\n    }\n  } catch (err) {\n    Logger.error(`Validating auth token: ${err}`);\n  }\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function assignPresenter(userId) { // TODO-- send username from client side\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'AssignPresenterReqMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  check(userId, String);\n\n  const User = Users.findOne({\n    meetingId,\n    userId,\n  });\n\n  if (!User) {\n    throw new Meteor.Error('user-not-found', 'You need a valid user to be able to set presenter');\n  }\n\n  const payload = {\n    newPresenterId: userId,\n    newPresenterName: User.name,\n    assignedBy: requesterUserId,\n    requesterId: requesterUserId,\n  };\n\n  Logger.verbose('User set as presenter', { userId, meetingId, setBy: requesterUserId });\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function changeRole(userId, role) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'ChangeUserRoleCmdMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(userId, String);\n  check(role, String);\n\n  const payload = {\n    userId,\n    role,\n    changedBy: requesterUserId,\n  };\n\n  Logger.verbose('Changed user role', {\n    userId, role, changedBy: requesterUserId, meetingId,\n  });\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\nimport Users from '/imports/api/users';\nimport BannedUsers from '/imports/api/users/server/store/bannedUsers';\n\nexport default function removeUser(userId, banUser) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'EjectUserFromMeetingCmdMsg';\n\n  const { meetingId, requesterUserId: ejectedBy } = extractCredentials(this.userId);\n\n  check(userId, String);\n\n  const payload = {\n    userId,\n    ejectedBy,\n    banUser,\n  };\n\n  const removedUser = Users.findOne({ meetingId, userId }, { extId: 1 });\n\n  if (banUser && removedUser) BannedUsers.add(meetingId, removedUser.extId);\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, ejectedBy, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function setEmojiStatus(userId, status) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'ChangeUserEmojiCmdMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(userId, String);\n\n  const payload = {\n    emoji: status,\n    userId,\n  };\n\n  Logger.verbose('User emoji status updated', {\n    userId, status, requesterUserId, meetingId,\n  });\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\nimport setEffectiveConnectionType from '../modifiers/setUserEffectiveConnectionType';\n\nexport default function setUserEffectiveConnectionType(effectiveConnectionType) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'ChangeUserEffectiveConnectionMsg';\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(effectiveConnectionType, String);\n\n  const payload = {\n    meetingId,\n    userId: requesterUserId,\n    effectiveConnectionType,\n  };\n\n  setEffectiveConnectionType(meetingId, requesterUserId, effectiveConnectionType);\n\n  Logger.verbose('Updated user effective connection', { requesterUserId, effectiveConnectionType });\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function toggleUserLock(userId, lock) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'LockUserInMeetingCmdMsg';\n\n  const { meetingId, requesterUserId: lockedBy } = extractCredentials(this.userId);\n\n  check(lockedBy, String);\n  check(userId, String);\n  check(lock, Boolean);\n\n  const payload = {\n    lockedBy,\n    userId,\n    lock,\n  };\n\n  Logger.verbose('Updated lock status for user', {\n    meetingId, userId, lock, lockedBy,\n  });\n\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, lockedBy, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport Users from '/imports/api/users';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function userActivitySign() {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'UserActivitySignCmdMsg';\n  const { meetingId, requesterUserId: userId } = extractCredentials(this.userId);\n  const payload = {\n    userId,\n  };\n\n  const selector = {\n    userId,\n  };\n\n  const modifier = {\n    $set: {\n      inactivityCheck: false,\n    },\n  };\n\n  Users.update(selector, modifier); // TODO-- we should move this to a modifier\n\n  Logger.info(`User ${userId} sent a activity sign for meeting ${meetingId}`);\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, userId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\n\nexport default function userLeaving(meetingId, userId, connectionId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'UserLeaveReqMsg';\n\n  check(userId, String);\n\n  const selector = {\n    meetingId,\n    userId,\n  };\n\n  const User = Users.findOne(selector);\n\n  if (!User) {\n    Logger.info(`Skipping userLeaving. Could not find ${userId} in ${meetingId}`);\n    return;\n  }\n\n  // If the current user connection is not the same that triggered the leave we skip\n  if (User.connectionId !== connectionId) {\n    Logger.info(`Skipping userLeaving. User connectionId=${User.connectionId} is different from requester connectionId=${connectionId}`);\n    return false;\n  }\n\n  const payload = {\n    userId,\n    sessionId: meetingId,\n  };\n\n  Logger.info(`User '${userId}' is leaving meeting '${meetingId}'`);\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, userId, payload);\n}\n","import Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function userLeftMeeting() { // TODO-- spread the code to method/modifier/handler\n  // so we don't update the db in a method\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const selector = {\n    meetingId,\n    userId: requesterUserId,\n  };\n\n  try {\n    const numberAffected = Users.update(selector, { $set: { loggedOut: true } });\n\n    if (numberAffected) {\n      Logger.info(`user left id=${requesterUserId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`leaving dummy user to collection: ${err}`);\n  }\n}\n","import { Meteor } from 'meteor/meteor';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Logger from '/imports/startup/server/logger';\nimport pendingAuthenticationsStore from '../store/pendingAuthentications';\nimport BannedUsers from '../store/bannedUsers';\nimport Users from '/imports/api/users';\n\nexport default function validateAuthToken(meetingId, requesterUserId, requesterToken, externalId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'ValidateAuthTokenReqMsg';\n\n  // Check if externalId is banned from the meeting\n  if (externalId) {\n    if (BannedUsers.has(meetingId, externalId)) {\n      Logger.warn(`A banned user with extId ${externalId} tried to enter in meeting ${meetingId}`);\n      return { invalid: true, reason: 'User has been banned', error_type: 'user_banned' };\n    }\n  }\n\n  // Prevent users who have left or been ejected to use the same sessionToken again.\n  const isUserInvalid = Users.findOne({\n    meetingId,\n    userId: requesterUserId,\n    authToken: requesterToken,\n    $or: [{ ejected: true }, { loggedOut: true }],\n  });\n\n  if (isUserInvalid) {\n    Logger.warn(`An invalid sessionToken tried to validateAuthToken meetingId=${meetingId} authToken=${requesterToken}`);\n    return {\n      invalid: true,\n      reason: `User has an invalid sessionToken due to ${isUserInvalid.ejected ? 'ejection' : 'log out'}`,\n      error_type: `invalid_session_token_due_to_${isUserInvalid.ejected ? 'eject' : 'log_out'}`,\n    };\n  }\n\n  // Store reference of methodInvocationObject ( to postpone the connection userId definition )\n  pendingAuthenticationsStore.add(meetingId, requesterUserId, requesterToken, this);\n\n  const payload = {\n    userId: requesterUserId,\n    authToken: requesterToken,\n  };\n\n  Logger.info(`User '${requesterUserId}' is trying to validate auth token for meeting '${meetingId}' from connection '${this.connection.id}'`);\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { check } from 'meteor/check';\nimport addUser from '/imports/api/users/server/modifiers/addUser';\n\n\nexport default function addDialInUser(meetingId, voiceUser) {\n  check(meetingId, String);\n  check(voiceUser, Object);\n\n  const USER_CONFIG = Meteor.settings.public.user;\n  const ROLE_VIEWER = USER_CONFIG.role_viewer;\n\n  const { intId, callerName } = voiceUser;\n\n  const voiceOnlyUser = {\n    intId,\n    extId: intId, // TODO\n    name: callerName,\n    role: ROLE_VIEWER.toLowerCase(),\n    guest: false,\n    authed: true,\n    waitingForAcceptance: false,\n    guestStatus: 'ALLOW',\n    emoji: 'none',\n    presenter: false,\n    locked: false, // TODO\n    avatar: '',\n    clientType: 'dial-in-user',\n  };\n\n  return addUser(meetingId, voiceOnlyUser);\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\nimport Meetings from '/imports/api/meetings';\nimport VoiceUsers from '/imports/api/voice-users/';\nimport _ from 'lodash';\nimport SanitizeHTML from 'sanitize-html';\n\nimport stringHash from 'string-hash';\nimport flat from 'flat';\n\nimport addVoiceUser from '/imports/api/voice-users/server/modifiers/addVoiceUser';\n\nconst COLOR_LIST = [\n  '#7b1fa2', '#6a1b9a', '#4a148c', '#5e35b1', '#512da8', '#4527a0',\n  '#311b92', '#3949ab', '#303f9f', '#283593', '#1a237e', '#1976d2', '#1565c0',\n  '#0d47a1', '#0277bd', '#01579b',\n];\n\nexport default function addUser(meetingId, userData) {\n  const user = userData;\n  const sanitizedName = SanitizeHTML(userData.name, {\n    allowedTags: [],\n    allowedAttributes: {},\n  });\n  // if user typed only tags\n  user.name = sanitizedName.length === 0\n    ? _.escape(userData.name)\n    : sanitizedName;\n\n  check(meetingId, String);\n\n  check(user, {\n    intId: String,\n    extId: String,\n    name: String,\n    role: String,\n    guest: Boolean,\n    authed: Boolean,\n    waitingForAcceptance: Match.Maybe(Boolean),\n    guestStatus: String,\n    emoji: String,\n    presenter: Boolean,\n    locked: Boolean,\n    avatar: String,\n    clientType: String,\n  });\n\n  const userId = user.intId;\n\n  const selector = {\n    meetingId,\n    userId,\n  };\n  const Meeting = Meetings.findOne({ meetingId });\n\n  /* While the akka-apps dont generate a color we just pick one\n    from a list based on the userId */\n  const color = COLOR_LIST[stringHash(user.intId) % COLOR_LIST.length];\n\n  const modifier = {\n    $set: Object.assign(\n      {\n        meetingId,\n        connectionStatus: 'online',\n        sortName: user.name.trim().toLowerCase(),\n        color,\n        breakoutProps: {\n          isBreakoutUser: Meeting.meetingProp.isBreakout,\n          parentId: Meeting.breakoutProps.parentId,\n        },\n        effectiveConnectionType: null,\n        inactivityCheck: false,\n        responseDelay: 0,\n        loggedOut: false,\n      },\n      flat(user),\n    ),\n  };\n\n  // Only add an empty VoiceUser if there isn't one already and if the user coming in isn't a\n  // dial-in user. We want to avoid overwriting good data\n  if (user.clientType !== 'dial-in-user' && !VoiceUsers.findOne({ meetingId, intId: userId })) {\n    addVoiceUser(meetingId, {\n      voiceUserId: '',\n      intId: userId,\n      callerName: user.name,\n      callerNum: '',\n      muted: false,\n      talking: false,\n      callingWith: '',\n      listenOnly: false,\n      voiceConf: '',\n      joined: false,\n    });\n  }\n\n  try {\n    const { insertedId } = Users.upsert(selector, modifier);\n\n    if (insertedId) {\n      Logger.info(`Added user id=${userId} meeting=${meetingId}`);\n    } else {\n      Logger.info(`Upserted user id=${userId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding user to collection: ${err}`);\n  }\n}\n","import Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\nimport Meetings from '/imports/api/meetings';\nimport stopWatchingExternalVideo from '/imports/api/external-videos/server/methods/stopWatchingExternalVideo';\n\nexport default function changePresenter(presenter, userId, meetingId, changedBy) {\n  const selector = {\n    meetingId,\n    userId,\n  };\n\n  const modifier = {\n    $set: {\n      presenter,\n    },\n  };\n\n  try {\n    const meeting = Meetings.findOne({ meetingId });\n    if (meeting && meeting.externalVideoUrl) {\n      Logger.info(`ChangePresenter:There is external video being shared. Stopping it due to presenter change, ${meeting.externalVideoUrl}`);\n      stopWatchingExternalVideo({ meetingId, requesterUserId: userId });\n    }\n\n    const numberAffected = Users.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Changed presenter=${presenter} id=${userId} meeting=${meetingId}`\n        + `${changedBy ? ` changedBy=${changedBy}` : ''}`);\n    }\n  } catch (err) {\n    Logger.error(`Changed user role: ${err}`);\n  }\n}\n","import Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\n\nexport default function changeRole(role, userId, meetingId, changedBy) {\n  const selector = {\n    meetingId,\n    userId,\n  };\n\n  const modifier = {\n    $set: {\n      role,\n    },\n  };\n\n  try {\n    const numberAffected = Users.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Changed user role=${role} id=${userId} meeting=${meetingId}`\n        + `${changedBy ? ` changedBy=${changedBy}` : ''}`);\n    }\n  } catch (err) {\n    Logger.error(`Changed user role: ${err}`);\n  }\n}\n","import Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users/index';\n\nexport default function clearUsers(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = Users.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared Users (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.error(`Error clearing Users (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = Users.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared Users (all)');\n      }\n    } catch (err) {\n      Logger.error(`Error clearing Users (all). ${err}`);\n    }\n  }\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\n\nexport default function createDummyUser(meetingId, userId, authToken) {\n  check(meetingId, String);\n  check(userId, String);\n  check(authToken, String);\n\n  const User = Users.findOne({ meetingId, userId });\n  if (User) {\n    throw new Meteor.Error('existing-user', 'Tried to create a dummy user for an existing user');\n  }\n\n  const doc = {\n    meetingId,\n    userId,\n    authToken,\n    clientType: 'HTML5',\n    validated: null,\n  };\n\n  try {\n    const insertedId = Users.insert(doc);\n\n    if (insertedId) {\n      Logger.info(`Created dummy user id=${userId} token=${authToken} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Creating dummy user to collection: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport Users from '/imports/api/users';\nimport VideoStreams from '/imports/api/video-streams';\nimport Logger from '/imports/startup/server/logger';\nimport stopWatchingExternalVideo from '/imports/api/external-videos/server/methods/stopWatchingExternalVideo';\nimport clearUserInfoForRequester from '/imports/api/users-infos/server/modifiers/clearUserInfoForRequester';\n\nconst clearAllSessions = (sessionUserId) => {\n  const serverSessions = Meteor.server.sessions;\n  Object.keys(serverSessions)\n    .filter(i => serverSessions[i].userId === sessionUserId)\n    .forEach(i => serverSessions[i].close());\n};\n\nexport default function removeUser(meetingId, userId) {\n  check(meetingId, String);\n  check(userId, String);\n\n  const userToRemove = Users.findOne({ userId, meetingId });\n\n  if (userToRemove) {\n    const { presenter } = userToRemove;\n    if (presenter) {\n      stopWatchingExternalVideo({ meetingId, requesterUserId: userId });\n    }\n  }\n\n  const selector = {\n    meetingId,\n    userId,\n  };\n\n  const modifier = {\n    $set: {\n      connectionStatus: 'offline',\n      validated: false,\n      emoji: 'none',\n      presenter: false,\n      role: 'VIEWER',\n    },\n  };\n\n  try {\n    VideoStreams.remove({ meetingId, userId });\n    const numberAffected = Users.update(selector, modifier);\n\n    if (numberAffected) {\n      const sessionUserId = `${meetingId}-${userId}`;\n      clearAllSessions(sessionUserId);\n\n      clearUserInfoForRequester(meetingId, userId);\n\n      Logger.info(`Removed user id=${userId} meeting=${meetingId}`);\n      return;\n    }\n  } catch (err) {\n    Logger.error(`Removing user from collection: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport Users from '/imports/api/users';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function setConnectionIdAndAuthToken(meetingId, userId, connectionId, authToken) {\n  check(meetingId, String);\n  check(userId, String);\n  check(authToken, String);\n  check(connectionId, String);\n\n  const selector = {\n    meetingId,\n    userId,\n  };\n\n  const modifier = {\n    $set: {\n      connectionId,\n      authToken,\n    },\n  };\n\n  try {\n    const numberAffected = Users.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Updated connectionId and authToken user=${userId} connectionId=${connectionId} meeting=${meetingId} authToken=${authToken}`);\n    }\n  } catch (err) {\n    Logger.error(`Updating connectionId user=${userId}: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport Users from '/imports/api/users';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function setUserEffectiveConnectionType(meetingId, userId, effectiveConnectionType) {\n  check(meetingId, String);\n  check(userId, String);\n  check(effectiveConnectionType, String);\n\n  const selector = {\n    meetingId,\n    userId,\n    effectiveConnectionType: { $ne: effectiveConnectionType },\n  };\n\n  const modifier = {\n    $set: {\n      effectiveConnectionType,\n    },\n  };\n\n  try {\n    const numberAffected = Users.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Updated user ${userId} effective connection to ${effectiveConnectionType} in meeting ${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Updating user ${userId}: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\nimport clearUserInfoForRequester from '/imports/api/users-infos/server/modifiers/clearUserInfoForRequester';\n\nexport default function userEjected(meetingId, userId, ejectedReason) {\n  check(meetingId, String);\n  check(userId, String);\n  check(ejectedReason, String);\n\n  const selector = {\n    meetingId,\n    userId,\n  };\n\n  const modifier = {\n    $set: {\n      ejected: true,\n      ejectedReason,\n    },\n  };\n\n  try {\n    const numberAffected = Users.update(selector, modifier);\n\n    if (numberAffected) {\n      clearUserInfoForRequester(meetingId, userId);\n      Logger.info(`Ejected user id=${userId} meeting=${meetingId} reason=${ejectedReason}`);\n    }\n  } catch (err) {\n    Logger.error(`Ejecting user from collection: ${err}`);\n  }\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\n\nexport default function userInactivityInspect(userId, responseDelay) {\n  check(userId, String);\n  check(responseDelay, Match.Integer);\n\n  const selector = {\n    userId,\n    inactivityCheck: false,\n  };\n\n  const modifier = {\n    $set: {\n      inactivityCheck: true,\n      responseDelay,\n    },\n  };\n\n  try {\n    const { numberAffected } = Users.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Updated user ${userId} with inactivity inspect`);\n    }\n  } catch (err) {\n    Logger.error(`Inactivity check for user ${userId}: ${err}`);\n  }\n}\n","import Logger from '/imports/startup/server/logger';\n\nclass BannedUsers {\n  constructor() {\n    Logger.debug('BannedUsers :: Initializing');\n    this.store = {};\n  }\n\n  init(meetingId) {\n    Logger.debug('BannedUsers :: init', { meetingId });\n\n    if (!this.store[meetingId]) this.store[meetingId] = new Set();\n  }\n\n  add(meetingId, externalId) {\n    Logger.debug('BannedUsers :: add', { meetingId, externalId });\n    if (!this.store[meetingId]) this.store[meetingId] = new Set();\n\n    this.store[meetingId].add(externalId);\n  }\n\n  delete(meetingId) {\n    Logger.debug('BannedUsers :: delete', { meetingId });\n    delete this.store[meetingId];\n  }\n\n  has(meetingId, externalId) {\n    Logger.debug('BannedUsers :: has', { meetingId, externalId });\n    if (!this.store[meetingId]) this.store[meetingId] = new Set();\n\n    return this.store[meetingId].has(externalId);\n  }\n}\n\nexport default new BannedUsers();\n","import Logger from '/imports/startup/server/logger';\n\nclass PendingAuthentitcations {\n    constructor () {\n        Logger.debug(\"PendingAuthentitcations :: constructor\");\n        this.store = [];\n    }\n\n    generateKey (meetingId, userId, authToken) {\n        // Protect against separator injection\n        meetingId = meetingId.replace(/ /g, '');\n        userId    = userId.replace(/ /g, '');\n        authToken = authToken.replace(/ /g, '');\n\n        // Space separated key\n        return `${meetingId} ${userId} ${authToken}`;\n    }\n\n    add (meetingId, userId, authToken, methodInvocationObject) {\n        Logger.debug(\"PendingAuthentitcations :: add\", {meetingId, userId, authToken});\n        this.store.push({\n            key: this.generateKey(meetingId, userId, authToken),\n            meetingId, userId, authToken, methodInvocationObject\n        });\n    }\n\n    take (meetingId, userId, authToken) {\n        const key = this.generateKey(meetingId, userId, authToken);\n        Logger.debug(\"PendingAuthentitcations :: take\", {key, meetingId, userId, authToken});\n        \n        // find matches\n        const matches = this.store.filter( e => e.key === key );\n        \n        // remove matches (if any)\n        if(matches.length) { \n            this.store = this.store.filter( e => e.key !== key ) ;\n        }\n\n        // return matches\n        return matches;\n    }\n}\nexport default new PendingAuthentitcations();","import RedisPubSub from '/imports/startup/server/redis';\nimport handleRemoveUser from './handlers/removeUser';\nimport handleUserJoined from './handlers/userJoined';\nimport handleValidateAuthToken from './handlers/validateAuthToken';\nimport handlePresenterAssigned from './handlers/presenterAssigned';\nimport handleEmojiStatus from './handlers/emojiStatus';\nimport handleGetUsers from './handlers/getUsers';\nimport handleUserEjected from './handlers/userEjected';\nimport handleChangeRole from './handlers/changeRole';\nimport handleUserInactivityInspect from './handlers/userInactivityInspect';\n\nRedisPubSub.on('PresenterAssignedEvtMsg', handlePresenterAssigned);\nRedisPubSub.on('UserJoinedMeetingEvtMsg', handleUserJoined);\nRedisPubSub.on('UserLeftMeetingEvtMsg', handleRemoveUser);\nRedisPubSub.on('ValidateAuthTokenRespMsg', handleValidateAuthToken);\nRedisPubSub.on('UserEmojiChangedEvtMsg', handleEmojiStatus);\nRedisPubSub.on('SyncGetUsersMeetingRespMsg', handleGetUsers);\nRedisPubSub.on('UserEjectedFromMeetingEvtMsg', handleUserEjected);\nRedisPubSub.on('UserRoleChangedEvtMsg', handleChangeRole);\nRedisPubSub.on('UserInactivityInspectMsg', handleUserInactivityInspect);\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport validateAuthToken from './methods/validateAuthToken';\nimport setEmojiStatus from './methods/setEmojiStatus';\nimport assignPresenter from './methods/assignPresenter';\nimport changeRole from './methods/changeRole';\nimport removeUser from './methods/removeUser';\nimport toggleUserLock from './methods/toggleUserLock';\nimport setUserEffectiveConnectionType from './methods/setUserEffectiveConnectionType';\nimport userActivitySign from './methods/userActivitySign';\nimport userLeftMeeting from './methods/userLeftMeeting';\n\nMeteor.methods({\n  setEmojiStatus,\n  assignPresenter,\n  changeRole,\n  removeUser,\n  validateAuthToken,\n  toggleUserLock,\n  setUserEffectiveConnectionType,\n  userActivitySign,\n  userLeftMeeting,\n});\n","import _ from 'lodash';\nimport Users from '/imports/api/users';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\n\nimport userLeaving from './methods/userLeaving';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nconst ROLE_MODERATOR = Meteor.settings.public.user.role_moderator;\n\nfunction currentUser() {\n  if (!this.userId) {\n    return Users.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(meetingId, String);\n  check(requesterUserId, String);\n\n  const connectionId = this.connection.id;\n  const onCloseConnection = Meteor.bindEnvironment(() => {\n    try {\n      userLeaving(meetingId, requesterUserId, connectionId);\n    } catch (e) {\n      Logger.error(`Exception while executing userLeaving: ${e}`);\n    }\n  });\n\n  this._session.socket.on('close', _.debounce(onCloseConnection, 100));\n\n  const selector = {\n    meetingId,\n    userId: requesterUserId,\n  };\n\n  const options = {\n    fields: {\n      user: false,\n      authToken: false, // Not asking for authToken from client side but also not exposing it\n    },\n  };\n\n  return Users.find(selector, options);\n}\n\nfunction publishCurrentUser(...args) {\n  const boundUsers = currentUser.bind(this);\n  return boundUsers(...args);\n}\n\nMeteor.publish('current-user', publishCurrentUser);\n\nfunction users(role) {\n  if (!this.userId) {\n    return Users.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const selector = {\n    $or: [\n      { meetingId },\n    ],\n  };\n\n  const User = Users.findOne({ userId: requesterUserId, meetingId }, { fields: { role: 1 } });\n  if (!!User && User.role === ROLE_MODERATOR) {\n    selector.$or.push({\n      'breakoutProps.isBreakoutUser': true,\n      'breakoutProps.parentId': meetingId,\n      connectionStatus: 'online',\n    });\n  }\n\n  const options = {\n    fields: {\n      authToken: false,\n      lastPing: false,\n    },\n  };\n\n  Logger.debug('Publishing Users', { meetingId, requesterUserId });\n\n  return Users.find(selector, options);\n}\n\nfunction publish(...args) {\n  const boundUsers = users.bind(this);\n  return boundUsers(...args);\n}\n\nMeteor.publish('users', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst Users = new Mongo.Collection('users');\n\nif (Meteor.isServer) {\n  // types of queries for the users:\n  // 1. meetingId\n  // 2. meetingId, userId\n\n  Users._ensureIndex({ meetingId: 1, userId: 1 });\n}\n\nexport default Users;\n","import { check } from 'meteor/check';\nimport addUserInfo from '../modifiers/addUserInfo';\n\nexport default function handleUserInformation({ header, body }) {\n  check(body, Object);\n  check(header, Object);\n\n  const { userInfo } = body;\n  const { userId, meetingId } = header;\n\n  check(userInfo, Array);\n  check(userId, String);\n  check(meetingId, String);\n\n  return addUserInfo(userInfo, userId, meetingId);\n}\n","import UserInfos from '/imports/api/users-infos';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function removeUserInformation() {\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  const selector = {\n    meetingId,\n    requesterUserId,\n  };\n\n  try {\n    const numberAffected = UserInfos.remove(selector);\n\n    if (numberAffected) {\n      Logger.info(`Removed user information: requester id=${requesterUserId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Removing user information from collection: ${err}`);\n  }\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function getUserInformation(externalUserId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toThirdParty;\n  const EVENT_NAME = 'LookUpUserReqMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  check(externalUserId, String);\n\n  const payload = {\n    externalUserId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import UserInfos from '/imports/api/users-infos';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function addUserInfo(userInfo, requesterUserId, meetingId) {\n  const info = {\n    meetingId,\n    requesterUserId,\n    userInfo,\n  };\n\n  try {\n    const numberAffected = UserInfos.insert(info);\n\n    if (numberAffected) {\n      Logger.info(`Added user information: requester id=${requesterUserId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Adding user information to collection: ${err}`);\n  }\n}\n","import UserInfos from '/imports/api/users-infos';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearUsersInfo(meetingId) {\n  try {\n    const numberAffected = UserInfos.remove({ meetingId });\n\n    if (numberAffected) {\n      Logger.info(`Cleared User Infos (${meetingId})`);\n    }\n  } catch (err) {\n    Logger.error(`Error on clearing User Infos (${meetingId}). ${err}`);\n  }\n}\n","import UserInfos from '/imports/api/users-infos';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearUsersInfoForRequester(meetingId, requesterUserId) {\n  try {\n    const numberAffected = UserInfos.remove({ meetingId });\n\n    if (numberAffected) {\n      Logger.info(`Cleared User Infos requested by user=${requesterUserId}`);\n    }\n  } catch (err) {\n    Logger.info(`Error on clearing User Infos requested by user=${requesterUserId}. ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handleUserInformation from './handlers/userInformation';\n\nRedisPubSub.on('LookUpUserRespMsg', handleUserInformation);\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport requestUserInformation from './methods/requestUserInformation';\nimport removeUserInformation from './methods/removeUserInformation';\n\nMeteor.methods({\n  requestUserInformation,\n  removeUserInformation,\n});\n","import { Meteor } from 'meteor/meteor';\nimport UserInfos from '/imports/api/users-infos';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction userInfos() {\n  if (!this.userId) {\n    return UserInfos.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing user infos requested', { requesterUserId });\n\n  return UserInfos.find({ meetingId, requesterUserId });\n}\n\nfunction publish(...args) {\n  const boundUserInfos = userInfos.bind(this);\n  return boundUserInfos(...args);\n}\n\nMeteor.publish('users-infos', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst UserInfos = new Mongo.Collection('users-infos');\n\nif (Meteor.isServer) {\n  UserInfos._ensureIndex({ meetingId: 1, userId: 1 });\n}\n\nexport default UserInfos;\n","import { check } from 'meteor/check';\nimport addUserSetting from '/imports/api/users-settings/server/modifiers/addUserSetting';\nimport logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nconst oldParameters = {\n  askForFeedbackOnLogout: 'bbb_ask_for_feedback_on_logout',\n  autoJoin: 'bbb_auto_join_audio',\n  autoShareWebcam: 'bbb_auto_share_webcam',\n  autoSwapLayout: 'bbb_auto_swap_layout',\n  clientTitle: 'bbb_client_title',\n  customStyle: 'bbb_custom_style',\n  customStyleUrl: 'bbb_custom_style_url',\n  displayBrandingArea: 'bbb_display_branding_area',\n  enableScreensharing: 'bbb_enable_screen_sharing',\n  enableVideo: 'bbb_enable_video',\n  forceListenOnly: 'bbb_force_listen_only',\n  hidePresentation: 'bbb_hide_presentation',\n  listenOnlyMode: 'bbb_listen_only_mode',\n  multiUserPenOnly: 'bbb_multi_user_pen_only',\n  multiUserTools: 'bbb_multi_user_tools',\n  outsideToggleRecording: 'bbb_outside_toggle_recording',\n  outsideToggleSelfVoice: 'bbb_outside_toggle_self_voice',\n  presenterTools: 'bbb_presenter_tools',\n  shortcuts: 'bbb_shortcuts',\n  skipCheck: 'bbb_skip_check_audio',\n};\n\nconst oldParametersKeys = Object.keys(oldParameters);\n\nconst currentParameters = [\n  // APP\n  'bbb_ask_for_feedback_on_logout',\n  'bbb_auto_join_audio',\n  'bbb_client_title',\n  'bbb_force_listen_only',\n  'bbb_listen_only_mode',\n  'bbb_skip_check_audio',\n  // BRANDING\n  'bbb_display_branding_area',\n  // SHORTCUTS\n  'bbb_shortcuts',\n  // KURENTO\n  'bbb_auto_share_webcam',\n  'bbb_preferred_camera_profile',\n  'bbb_enable_screen_sharing',\n  'bbb_enable_video',\n  'bbb_record_video',\n  'bbb_skip_video_preview',\n  'bbb_mirror_own_webcam',\n  // PRESENTATION\n  'bbb_force_restore_presentation_on_new_events',\n  // WHITEBOARD\n  'bbb_multi_user_pen_only',\n  'bbb_presenter_tools',\n  'bbb_multi_user_tools',\n  // SKINNING/THEMMING\n  'bbb_custom_style',\n  'bbb_custom_style_url',\n  // LAYOUT\n  'bbb_auto_swap_layout',\n  'bbb_hide_presentation',\n  'bbb_show_participants_on_login',\n  'bbb_show_public_chat_on_login',\n  // OUTSIDE COMMANDS\n  'bbb_outside_toggle_self_voice',\n  'bbb_outside_toggle_recording',\n];\n\nfunction valueParser(val) {\n  try {\n    const parsedValue = JSON.parse(val.toLowerCase().trim());\n    return parsedValue;\n  } catch (error) {\n    logger.warn(`addUserSettings:Parameter ${val} could not be parsed (was not json)`);\n    return val;\n  }\n}\n\nexport default function addUserSettings(settings) {\n  check(settings, [Object]);\n\n  const { meetingId, requesterUserId: userId } = extractCredentials(this.userId);\n\n  let parameters = {};\n\n  settings.forEach((el) => {\n    const settingKey = Object.keys(el).shift();\n    const normalizedKey = settingKey.trim();\n\n    if (currentParameters.includes(normalizedKey)) {\n      if (!Object.keys(parameters).includes(normalizedKey)) {\n        parameters = {\n          [normalizedKey]: valueParser(el[settingKey]),\n          ...parameters,\n        };\n      } else {\n        parameters[normalizedKey] = el[settingKey];\n      }\n      return;\n    }\n\n    if (oldParametersKeys.includes(normalizedKey)) {\n      const matchingNewKey = oldParameters[normalizedKey];\n      if (!Object.keys(parameters).includes(matchingNewKey)) {\n        parameters = {\n          [matchingNewKey]: valueParser(el[settingKey]),\n          ...parameters,\n        };\n      }\n      return;\n    }\n\n    logger.warn(`Parameter ${normalizedKey} not handled`);\n  });\n\n  const settingsAdded = [];\n  Object.entries(parameters).forEach((el) => {\n    const setting = el[0];\n    const value = el[1];\n    settingsAdded.push(addUserSetting(meetingId, userId, setting, value));\n  });\n\n  return settingsAdded;\n}\n","import { check } from 'meteor/check';\nimport UserSettings from '/imports/api/users-settings';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function addUserSetting(meetingId, userId, setting, value) {\n  check(meetingId, String);\n  check(userId, String);\n  check(setting, String);\n  check(value, Match.Any);\n\n  const selector = {\n    meetingId,\n    userId,\n    setting,\n  };\n  const modifier = {\n    $set: {\n      meetingId,\n      userId,\n      setting,\n      value,\n    },\n  };\n\n  try {\n    const { numberAffected } = UserSettings.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.verbose('Upserted user setting', { meetingId, userId, setting });\n    }\n  } catch (err) {\n    Logger.error(`Adding user setting to collection: ${err}`);\n  }\n}\n","import UserSettings from '/imports/api/users-settings';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function clearUsersSettings(meetingId) {\n  try {\n    const numberAffected = UserSettings.remove({ meetingId });\n\n    if (numberAffected) {\n      Logger.info(`Cleared User Settings (${meetingId})`);\n    }\n  } catch (err) {\n    Logger.error(`Error on clearing User Settings (${meetingId}). ${err}`);\n  }\n}\n","import './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport addUserSettings from './methods/addUserSettings';\n\nMeteor.methods({\n  addUserSettings,\n});\n","import { Meteor } from 'meteor/meteor';\nimport UserSettings from '/imports/api/users-settings';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\nimport User from '/imports/api/users';\n\nfunction userSettings() {\n  if (!this.userId) {\n    return UserSettings.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const currentUser = User.findOne({ userId: requesterUserId });\n\n  if (currentUser && currentUser.breakoutProps.isBreakoutUser) {\n    const { parentId } = currentUser.breakoutProps;\n\n    const [externalId] = currentUser.extId.split('-');\n\n    const mainRoomUserSettings = UserSettings.find({ meetingId: parentId, userId: externalId });\n\n    mainRoomUserSettings.map(({ setting, value }) => ({\n      meetingId,\n      setting,\n      userId: requesterUserId,\n      value,\n    })).forEach((doc) => {\n      const selector = {\n        meetingId,\n        setting: doc.setting,\n      };\n\n      UserSettings.upsert(selector, doc);\n    });\n\n    Logger.debug('Publishing user settings', { requesterUserId });\n\n    return UserSettings.find({ meetingId, userId: requesterUserId });\n  }\n\n  Logger.debug('Publishing user settings', { requesterUserId });\n\n  return UserSettings.find({ meetingId, userId: requesterUserId });\n}\n\nfunction publish(...args) {\n  const boundUserSettings = userSettings.bind(this);\n  return boundUserSettings(...args);\n}\n\nMeteor.publish('users-settings', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst UserSettings = new Mongo.Collection('users-settings');\n\nif (Meteor.isServer) {\n  UserSettings._ensureIndex({\n    meetingId: 1, userId: 1,\n  });\n}\n\nexport default UserSettings;\n","import { check } from 'meteor/check';\nimport sharedWebcam from '../modifiers/sharedWebcam';\nimport { isValidStream } from '/imports/api/video-streams/server/helpers';\n\nexport default function handleUserSharedHtml5Webcam({ header, body }, meetingId) {\n  const { userId, stream } = body;\n\n  check(header, Object);\n  check(meetingId, String);\n  check(userId, String);\n  check(stream, String);\n\n  if (!isValidStream(stream)) return false;\n\n  return sharedWebcam(meetingId, userId, stream);\n}\n","import { check } from 'meteor/check';\nimport unsharedWebcam from '../modifiers/unsharedWebcam';\nimport { isValidStream } from '/imports/api/video-streams/server/helpers';\n\nexport default function handleUserUnsharedHtml5Webcam({ header, body }, meetingId) {\n  const { userId, stream } = body;\n\n  check(header, Object);\n  check(meetingId, String);\n  check(userId, String);\n  check(stream, String);\n\n  if (!isValidStream(stream)) return false;\n\n  return unsharedWebcam(meetingId, userId, stream);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function userShareWebcam(stream) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'UserBroadcastCamStartMsg';\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.info(`user sharing webcam: ${meetingId} ${requesterUserId}`);\n\n  check(stream, String);\n\n  // const actionName = 'joinVideo';\n  /* TODO throw an error if user has no permission to share webcam\n  if (!isAllowedTo(actionName, credentials)) {\n    throw new Meteor.Error('not-allowed', `You are not allowed to share webcam`);\n  } */\n\n  const payload = {\n    stream,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function userUnshareWebcam(stream) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'UserBroadcastCamStopMsg';\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.info(`user unsharing webcam: ${meetingId} ${requesterUserId}`);\n\n  check(stream, String);\n\n  // const actionName = 'joinVideo';\n  /* TODO throw an error if user has no permission to share webcam\n  if (!isAllowedTo(actionName, credentials)) {\n    throw new Meteor.Error('not-allowed', `You are not allowed to share webcam`);\n  } */\n\n  const payload = {\n    stream,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import Logger from '/imports/startup/server/logger';\nimport VideoStreams from '/imports/api/video-streams';\n\nexport default function clearVideoStreams(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = VideoStreams.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared VideoStreams in (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing VideoStreams (${ meetingId }). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = VideoStreams.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared VideoStreams in all meetings');\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing VideoStreams (all). ${err}`);\n    }\n  }\n}\n","import Logger from '/imports/startup/server/logger';\nimport VideoStreams from '/imports/api/video-streams';\nimport { check } from 'meteor/check';\nimport {\n  getDeviceId,\n  getUserName,\n} from '/imports/api/video-streams/server/helpers';\n\nexport default function sharedWebcam(meetingId, userId, stream) {\n  check(meetingId, String);\n  check(userId, String);\n  check(stream, String);\n\n  const deviceId = getDeviceId(stream);\n  const name = getUserName(userId);\n\n  const selector = {\n    meetingId,\n    userId,\n    deviceId,\n  };\n\n  const modifier = {\n    $set: {\n      stream,\n      name,\n    },\n  };\n\n  try {\n    const { insertedId } = VideoStreams.upsert(selector, modifier);\n\n    if (insertedId) {\n      Logger.info(`Updated stream=${stream} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Error setting stream: ${err}`);\n  }\n}\n","import Logger from '/imports/startup/server/logger';\nimport VideoStreams from '/imports/api/video-streams';\nimport { check } from 'meteor/check';\nimport { getDeviceId } from '/imports/api/video-streams/server/helpers';\n\nexport default function unsharedWebcam(meetingId, userId, stream) {\n  check(meetingId, String);\n  check(userId, String);\n  check(stream, String);\n\n  const deviceId = getDeviceId(stream);\n\n  const selector = {\n    meetingId,\n    userId,\n    deviceId,\n  };\n\n  try {\n    VideoStreams.remove(selector);\n\n    Logger.info(`Removed stream=${stream} meeting=${meetingId}`);\n  } catch (err) {\n    Logger.error(`Error removing stream: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handleUserSharedHtml5Webcam from './handlers/userSharedHtml5Webcam';\nimport handleUserUnsharedHtml5Webcam from './handlers/userUnsharedHtml5Webcam';\n\nRedisPubSub.on('UserBroadcastCamStartedEvtMsg', handleUserSharedHtml5Webcam);\nRedisPubSub.on('UserBroadcastCamStoppedEvtMsg', handleUserUnsharedHtml5Webcam);\n","import Logger from '/imports/startup/server/logger';\nimport Users from '/imports/api/users';\n\nconst FLASH_STREAM_REGEX = /^([A-z0-9]+)-([A-z0-9]+)-([A-z0-9]+)(-recorded)?$/;\nconst TOKEN = '_';\n\nconst isValidStream = stream => !FLASH_STREAM_REGEX.test(stream);\nconst getDeviceId = (stream) => {\n  const splitStream = stream.split(TOKEN);\n  if (splitStream.length === 3) return splitStream[2];\n  Logger.warn(`Could not get deviceId from stream=${stream}`);\n  return stream;\n};\n\nconst getUserName = (userId) => {\n  const user = Users.findOne(\n    { userId },\n    { fields: { name: 1 } },\n  );\n  if (user) return user.name;\n  return userId;\n};\n\nexport {\n  isValidStream,\n  getDeviceId,\n  getUserName,\n};\n","import './eventHandlers';\nimport './methods';\nimport './publisher';\n","import { Meteor } from 'meteor/meteor';\nimport userShareWebcam from './methods/userShareWebcam';\nimport userUnshareWebcam from './methods/userUnshareWebcam';\n\nMeteor.methods({\n  userShareWebcam,\n  userUnshareWebcam,\n});\n","import { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport VideoStreams from '/imports/api/video-streams';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction videoStreams() {\n  if (!this.userId) {\n    return VideoStreams.find({ meetingId: '' });\n  }\n  const { meetingId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing video users', { meetingId });\n\n  const selector = {\n    meetingId,\n  };\n\n  return VideoStreams.find(selector);\n}\n\nfunction publish(...args) {\n  const boundVideoStreams = videoStreams.bind(this);\n  return boundVideoStreams(...args);\n}\n\nMeteor.publish('video-streams', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst VideoStreams = new Mongo.Collection('video-streams');\n\nif (Meteor.isServer) {\n  // types of queries for the video users:\n  // 2. meetingId\n\n  VideoStreams._ensureIndex({ meetingId: 1 });\n}\n\nexport default VideoStreams;\n","import { check } from 'meteor/check';\nimport VoiceCallState from '/imports/api/voice-call-states';\nimport Logger from '/imports/startup/server/logger';\n\n// \"CALL_STARTED\", \"IN_ECHO_TEST\", \"IN_CONFERENCE\", \"CALL_ENDED\"\n\nexport default function handleVoiceCallStateEvent({ body }, meetingId) {\n  const {\n    voiceConf,\n    clientSession,\n    userId,\n    callerName,\n    callState,\n  } = body;\n\n  check(meetingId, String);\n  check(voiceConf, String);\n  check(clientSession, String);\n  check(userId, String);\n  check(callerName, String);\n  check(callState, String);\n\n  const selector = {\n    meetingId,\n    userId,\n    clientSession,\n  };\n\n  const modifier = {\n    $set: {\n      meetingId,\n      userId,\n      voiceConf,\n      clientSession,\n      callState,\n    },\n  };\n\n  try {\n    const { numberAffected } = VoiceCallState.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.debug('Update voice call', {\n        state: userId, meetingId, clientSession, callState,\n      });\n    }\n  } catch (err) {\n    Logger.error(`Update voice call state=${userId}: ${err}`);\n  }\n}\n","import Logger from '/imports/startup/server/logger';\nimport VoiceCallStates from '/imports/api/voice-call-states';\n\nexport default function clearVoiceCallStates(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = VoiceCallStates.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared VoiceCallStates in (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.info(`Error on clearing VoiceCallStates in (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = VoiceCallStates.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared VoiceCallStates in all meetings');\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing VoiceCallStates in all meetings. ${err}`);\n    }\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport handleVoiceCallStateEvent from './handlers/voiceCallStateEvent';\n\nRedisPubSub.on('VoiceCallStateEvtMsg', handleVoiceCallStateEvent);\n","import './eventHandlers';\nimport './publishers';\n","import VoiceCallStates from '/imports/api/voice-call-states';\nimport { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction voiceCallStates() {\n  if (!this.userId) {\n    return VoiceCallStates.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing Voice Call States', { meetingId, requesterUserId });\n\n  return VoiceCallStates.find({ meetingId, userId: requesterUserId });\n}\n\nfunction publish(...args) {\n  const boundVoiceCallStates = voiceCallStates.bind(this);\n  return boundVoiceCallStates(...args);\n}\n\nMeteor.publish('voice-call-states', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst VoiceCallStates = new Mongo.Collection('voiceCallStates');\n\nif (Meteor.isServer) {\n  // types of queries for the voice users:\n  // 1. intId\n  // 2. meetingId, intId\n\n  VoiceCallStates._ensureIndex({ meetingId: 1, userId: 1 });\n}\n\nexport default VoiceCallStates;\n","import { check } from 'meteor/check';\nimport VoiceUsers from '/imports/api/voice-users/';\nimport Meetings from '/imports/api/meetings';\nimport addVoiceUser from '../modifiers/addVoiceUser';\nimport removeVoiceUser from '../modifiers/removeVoiceUser';\nimport updateVoiceUser from '../modifiers/updateVoiceUser';\n\nexport default function handleGetVoiceUsers({ body }, meetingId) {\n  const { users } = body;\n\n  check(meetingId, String);\n  check(users, Array);\n\n  const meeting = Meetings.findOne({ meetingId }, { fields: { 'voiceProp.voiceConf': 1 } });\n  const usersIds = users.map(m => m.intId);\n\n  const voiceUsersIdsToUpdate = VoiceUsers.find({\n    meetingId,\n    intId: { $in: usersIds },\n  }, { fields: { intId: 1 } }).fetch().map(m => m.intId);\n\n  const voiceUsersUpdated = [];\n  users.forEach((user) => {\n    if (voiceUsersIdsToUpdate.indexOf(user.intId) >= 0) {\n      // user already exist, then update\n      voiceUsersUpdated.push(updateVoiceUser(meetingId, {\n        intId: user.intId,\n        voiceUserId: user.voiceUserId,\n        talking: user.talking,\n        muted: user.muted,\n        voiceConf: meeting.voiceProp.voiceConf,\n        joined: true,\n      }));\n    } else {\n      // user doesn't exist yet, then add it\n      addVoiceUser(meetingId, {\n        voiceUserId: user.voiceUserId,\n        intId: user.intId,\n        callerName: user.callerName,\n        callerNum: user.callerNum,\n        muted: user.muted,\n        talking: user.talking,\n        callingWith: user.callingWith,\n        listenOnly: user.listenOnly,\n        voiceConf: meeting.voiceProp.voiceConf,\n        joined: true,\n      });\n    }\n  });\n\n  // removing extra users already existing in Mongo\n  const voiceUsersToRemove = VoiceUsers.find({\n    meetingId,\n    intId: { $nin: usersIds },\n  }).fetch();\n  voiceUsersToRemove.forEach(user => removeVoiceUser(meetingId, {\n    voiceConf: meeting.voiceProp.voiceConf,\n    voiceUserId: user.voiceUserId,\n    intId: user.intId,\n  }));\n\n  return voiceUsersUpdated;\n}\n","import { check } from 'meteor/check';\nimport Users from '/imports/api/users';\nimport addDialInUser from '/imports/api/users/server/modifiers/addDialInUser';\nimport addVoiceUser from '../modifiers/addVoiceUser';\n\n\nexport default function handleJoinVoiceUser({ body }, meetingId) {\n  const voiceUser = body;\n  voiceUser.joined = true;\n\n  check(meetingId, String);\n  check(voiceUser, {\n    voiceConf: String,\n    intId: String,\n    voiceUserId: String,\n    callerName: String,\n    callerNum: String,\n    muted: Boolean,\n    talking: Boolean,\n    callingWith: String,\n    listenOnly: Boolean,\n    joined: Boolean,\n  });\n\n  const {\n    intId,\n  } = voiceUser;\n\n  const User = Users.findOne({\n    meetingId,\n    intId,\n    connectionStatus: 'online',\n  });\n\n  if (!User) {\n    /* voice-only user - called into the conference */\n    addDialInUser(meetingId, voiceUser);\n  }\n\n  return addVoiceUser(meetingId, voiceUser);\n}\n","import { check } from 'meteor/check';\n\nimport removeVoiceUser from '/imports/api/voice-users/server/modifiers/removeVoiceUser';\nimport removeUser from '/imports/api/users/server/modifiers/removeUser';\nimport Users from '/imports/api/users';\n\nexport default function handleVoiceUpdate({ body }, meetingId) {\n  const voiceUser = body;\n\n  check(meetingId, String);\n  check(voiceUser, {\n    voiceConf: String,\n    intId: String,\n    voiceUserId: String,\n  });\n\n  const {\n    intId,\n    voiceUserId,\n  } = voiceUser;\n\n  const isDialInUser = (userId, meetingID) => !!Users.findOne({ meetingId: meetingID, userId, clientType: 'dial-in-user' });\n\n  // if the user is dial-in, leaving voice also means leaving userlist\n  if (isDialInUser(voiceUserId, meetingId)) removeUser(meetingId, intId);\n\n  return removeVoiceUser(meetingId, voiceUser);\n}\n","import changeMuteMeeting from '../modifiers/changeMuteMeeting';\n\nexport default function handleMeetingMuted({ body }, meetingId) {\n  changeMuteMeeting(meetingId, body);\n}\n","import { check } from 'meteor/check';\n\nimport updateVoiceUser from '../modifiers/updateVoiceUser';\n\nexport default function handleVoiceUpdate({ body }, meetingId) {\n  const voiceUser = body;\n\n  check(meetingId, String);\n\n  // If a person is muted we have to force them to not talking\n  if (voiceUser.muted) {\n    voiceUser.talking = false;\n  }\n\n  return updateVoiceUser(meetingId, voiceUser);\n}\n","import { check } from 'meteor/check';\n\nimport updateVoiceUser from '../modifiers/updateVoiceUser';\n\nexport default function handleVoiceUpdate({ body }, meetingId) {\n  const voiceUser = body;\n\n  check(meetingId, String);\n\n  return updateVoiceUser(meetingId, voiceUser);\n}\n","import VoiceUsers from '/imports/api/voice-users/';\nimport Meetings from '/imports/api/meetings';\nimport addDialInUser from '/imports/api/users/server/modifiers/addDialInUser';\nimport removeVoiceUser from '../modifiers/removeVoiceUser';\nimport updateVoiceUser from '../modifiers/updateVoiceUser';\nimport addVoiceUser from '../modifiers/addVoiceUser';\n\n\nexport default function handleVoiceUsers({ header, body }) {\n  const { voiceUsers } = body;\n  const { meetingId } = header;\n\n  const meeting = Meetings.findOne({ meetingId }, { fields: { 'voiceProp.voiceConf': 1 } });\n  const usersIds = voiceUsers.map(m => m.intId);\n\n  const voiceUsersIdsToUpdate = VoiceUsers.find({\n    meetingId,\n    intId: { $in: usersIds },\n  }, { fields: { intId: 1 } }).fetch().map(m => m.intId);\n\n  const voiceUsersUpdated = [];\n  voiceUsers.forEach((voice) => {\n    if (voiceUsersIdsToUpdate.indexOf(voice.intId) >= 0) {\n      // user already exist, then update\n      voiceUsersUpdated.push(updateVoiceUser(meetingId, {\n        intId: voice.intId,\n        voiceUserId: voice.voiceUserId,\n        talking: voice.talking,\n        muted: voice.muted,\n        voiceConf: meeting.voiceProp.voiceConf,\n        joined: true,\n      }));\n    } else {\n      // user doesn't exist yet, then add it\n      addVoiceUser(meetingId, {\n        voiceUserId: voice.voiceUserId,\n        intId: voice.intId,\n        callerName: voice.callerName,\n        callerNum: voice.callerNum,\n        muted: voice.muted,\n        talking: voice.talking,\n        callingWith: voice.callingWith,\n        listenOnly: voice.listenOnly,\n        voiceConf: meeting.voiceProp.voiceConf,\n        joined: true,\n      });\n\n      addDialInUser(meetingId, voice);\n    }\n  });\n\n  // removing extra users already existing in Mongo\n  const voiceUsersToRemove = VoiceUsers.find({\n    meetingId,\n    intId: { $nin: usersIds },\n  }, { fields: { voiceUserId: 1, intId: 1 } }).fetch();\n  voiceUsersToRemove.forEach(user => removeVoiceUser(meetingId, {\n    voiceConf: meeting.voiceProp.voiceConf,\n    voiceUserId: user.voiceUserId,\n    intId: user.intId,\n  }));\n\n  return voiceUsersUpdated;\n}\n","import { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function ejectUserFromVoice(userId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'EjectUserFromVoiceCmdMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  check(userId, String);\n\n  const payload = {\n    userId,\n    ejectedBy: requesterUserId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Meetings from '/imports/api/meetings';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function muteAllExceptPresenterToggle() {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'MuteAllExceptPresentersCmdMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const meeting = Meetings.findOne({ meetingId });\n  const toggleMeetingMuted = !meeting.voiceProp.muteOnStart;\n\n  const payload = {\n    mutedBy: requesterUserId,\n    mute: toggleMeetingMuted,\n  };\n\n  RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Meetings from '/imports/api/meetings';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function muteAllToggle() {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'MuteMeetingCmdMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  const meeting = Meetings.findOne({ meetingId });\n  const toggleMeetingMuted = !meeting.voiceProp.muteOnStart;\n\n  const payload = {\n    mutedBy: requesterUserId,\n    mute: toggleMeetingMuted,\n  };\n\n  RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { Meteor } from 'meteor/meteor';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\nimport RedisPubSub from '/imports/startup/server/redis';\nimport Users from '/imports/api/users';\nimport VoiceUsers from '/imports/api/voice-users';\nimport Meetings from '/imports/api/meetings';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function muteToggle(uId, toggle) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'MuteUserCmdMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n  const userToMute = uId || requesterUserId;\n\n  const requester = Users.findOne({\n    meetingId,\n    userId: requesterUserId,\n  });\n\n  const voiceUser = VoiceUsers.findOne({\n    intId: userToMute,\n    meetingId,\n  });\n\n  if (!requester || !voiceUser) return;\n\n  const { listenOnly, muted } = voiceUser;\n  if (listenOnly) return;\n\n  // if allowModsToUnmuteUsers is false, users will be kicked out for attempting to unmute others\n  if (requesterUserId !== userToMute && muted) {\n    const meeting = Meetings.findOne({ meetingId },\n      { fields: { 'usersProp.allowModsToUnmuteUsers': 1 } });\n    if (meeting.usersProp && !meeting.usersProp.allowModsToUnmuteUsers) {\n      Logger.warn(`Attempted unmuting by another user meetingId:${meetingId} requester: ${requesterUserId} userId: ${userToMute}`);\n      return;\n    }\n  }\n\n  let _muted;\n\n  if ((toggle === undefined) || (toggle === null)) {\n    _muted = !muted;\n  } else {\n    _muted = !!toggle;\n  }\n\n  const payload = {\n    userId: userToMute,\n    mutedBy: requesterUserId,\n    mute: _muted,\n  };\n\n  RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport VoiceUsers from '/imports/api/voice-users';\nimport Users from '/imports/api/users';\nimport flat from 'flat';\n\nexport default function addVoiceUser(meetingId, voiceUser) {\n  check(meetingId, String);\n  check(voiceUser, {\n    voiceUserId: String,\n    intId: String,\n    callerName: String,\n    callerNum: String,\n    muted: Boolean,\n    talking: Boolean,\n    callingWith: String,\n    listenOnly: Boolean,\n    voiceConf: String,\n    joined: Boolean, // This is a HTML5 only param.\n  });\n\n  const { intId, talking } = voiceUser;\n\n  const selector = {\n    meetingId,\n    intId,\n  };\n\n  const modifier = {\n    $set: Object.assign(\n      { meetingId, spoke: talking },\n      flat(voiceUser),\n    ),\n  };\n\n  const user = Users.findOne({ meetingId, userId: intId }, {\n    fields: {\n      color: 1,\n    },\n  });\n\n  if (user) modifier.$set.color = user.color;\n\n  try {\n    const { numberAffected } = VoiceUsers.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Add voice user=${intId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Add voice user=${intId}: ${err}`);\n  }\n}\n","import Meetings from '/imports/api/meetings';\nimport { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\n\nexport default function changeMuteMeeting(meetingId, payload) {\n  check(meetingId, String);\n  check(payload, {\n    muted: Boolean,\n    mutedBy: String,\n  });\n\n  const selector = {\n    meetingId,\n  };\n\n  const modifier = {\n    $set: {\n      'voiceProp.muteOnStart': payload.muted,\n    },\n  };\n\n  try {\n    const { numberAffected } = Meetings.upsert(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Changed meeting mute status meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Changing meeting mute status meeting={${meetingId}} ${err}`);\n  }\n}\n","import Logger from '/imports/startup/server/logger';\nimport VoiceUsers from '/imports/api/voice-users';\n\nexport default function clearVoiceUser(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = VoiceUsers.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared VoiceUsers in (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing VoiceUsers in ${meetingId}. ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = VoiceUsers.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared VoiceUsers in all meetings');\n      }\n    } catch (err) {\n      Logger.error(`Error on clearing VoiceUsers. ${err}`);\n    }\n  }\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport VoiceUsers from '/imports/api/voice-users';\nimport { clearSpokeTimeout } from '/imports/api/common/server/helpers';\n\nexport default function removeVoiceUser(meetingId, voiceUser) {\n  check(meetingId, String);\n  check(voiceUser, {\n    voiceConf: String,\n    voiceUserId: String,\n    intId: String,\n  });\n\n  const { intId } = voiceUser;\n\n  const selector = {\n    meetingId,\n    intId,\n  };\n\n  const modifier = {\n    $set: {\n      muted: false,\n      talking: false,\n      listenOnly: false,\n      joined: false,\n      spoke: false,\n    },\n  };\n\n  try {\n    clearSpokeTimeout(meetingId, intId);\n    const numberAffected = VoiceUsers.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.info(`Remove voiceUser=${intId} meeting=${meetingId}`);\n    }\n  } catch (err) {\n    Logger.error(`Remove voiceUser=${intId}: ${err}`);\n  }\n}\n","import { Match, check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport VoiceUsers from '/imports/api/voice-users';\nimport flat from 'flat';\nimport { spokeTimeoutHandles, clearSpokeTimeout } from '/imports/api/common/server/helpers';\n\nconst TALKING_TIMEOUT = 6000;\n\nexport default function updateVoiceUser(meetingId, voiceUser) {\n  check(meetingId, String);\n  check(voiceUser, {\n    intId: String,\n    voiceUserId: String,\n    talking: Match.Maybe(Boolean),\n    muted: Match.Maybe(Boolean),\n    voiceConf: String,\n    joined: Match.Maybe(Boolean),\n  });\n\n  const { intId } = voiceUser;\n\n  const selector = {\n    meetingId,\n    intId,\n  };\n\n  const modifier = {\n    $set: Object.assign(\n      flat(voiceUser),\n    ),\n  };\n\n  if (voiceUser.talking) {\n    const user = VoiceUsers.findOne({ meetingId, intId }, {\n      fields: {\n        startTime: 1,\n      },\n    });\n\n    if (user && !user.startTime) modifier.$set.startTime = Date.now();\n    modifier.$set.spoke = true;\n    modifier.$set.endTime = null;\n    clearSpokeTimeout(meetingId, intId);\n  }\n\n  if (!voiceUser.talking) {\n    const timeoutHandle = Meteor.setTimeout(() => {\n      const user = VoiceUsers.findOne({ meetingId, intId }, {\n        fields: {\n          endTime: 1,\n          talking: 1,\n        },\n      });\n\n      if (user) {\n        const { endTime, talking } = user;\n        const spokeDelay = ((Date.now() - endTime) < TALKING_TIMEOUT);\n        if (talking || spokeDelay) return;\n        modifier.$set.spoke = false;\n        modifier.$set.startTime = null;\n        try {\n          const numberAffected = VoiceUsers.update(selector, modifier);\n\n          if (numberAffected) {\n            Logger.debug('Update voiceUser', { voiceUser: intId, meetingId });\n          }\n        } catch (err) {\n          Logger.error(`Update voiceUser=${intId}: ${err}`);\n        }\n      }\n    }, TALKING_TIMEOUT);\n\n    spokeTimeoutHandles[`${meetingId}-${intId}`] = timeoutHandle;\n    modifier.$set.endTime = Date.now();\n  }\n\n  try {\n    const numberAffected = VoiceUsers.update(selector, modifier);\n\n    if (numberAffected) {\n      Logger.debug('Update voiceUser', { voiceUser: intId, meetingId });\n    }\n  } catch (err) {\n    Logger.error(`Update voiceUser=${intId}: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { processForHTML5ServerOnly } from '/imports/api/common/server/helpers';\nimport handleJoinVoiceUser from './handlers/joinVoiceUser';\nimport handleLeftVoiceUser from './handlers/leftVoiceUser';\nimport handleTalkingVoiceUser from './handlers/talkingVoiceUser';\nimport handleMutedVoiceUser from './handlers/mutedVoiceUser';\nimport handleGetVoiceUsers from './handlers/getVoiceUsers';\nimport handleVoiceUsers from './handlers/voiceUsers';\nimport handleMeetingMuted from './handlers/meetingMuted';\n\nRedisPubSub.on('UserLeftVoiceConfToClientEvtMsg', handleLeftVoiceUser);\nRedisPubSub.on('UserJoinedVoiceConfToClientEvtMsg', handleJoinVoiceUser);\nRedisPubSub.on('UserTalkingVoiceEvtMsg', handleTalkingVoiceUser);\nRedisPubSub.on('UserMutedVoiceEvtMsg', handleMutedVoiceUser);\nRedisPubSub.on('GetVoiceUsersMeetingRespMsg', processForHTML5ServerOnly(handleGetVoiceUsers));\nRedisPubSub.on('SyncGetVoiceUsersRespMsg', handleVoiceUsers);\nRedisPubSub.on('MeetingMutedEvtMsg', handleMeetingMuted);\n","import './eventHandlers';\nimport './publishers';\nimport './methods';\n","import { Meteor } from 'meteor/meteor';\nimport muteToggle from './methods/muteToggle';\nimport muteAllToggle from './methods/muteAllToggle';\nimport muteAllExceptPresenterToggle from './methods/muteAllExceptPresenterToggle';\nimport ejectUserFromVoice from './methods/ejectUserFromVoice';\n\nMeteor.methods({\n  toggleVoice: muteToggle,\n  muteAllUsers: muteAllToggle,\n  muteAllExceptPresenter: muteAllExceptPresenterToggle,\n  ejectUserFromVoice,\n});\n","import VoiceUsers from '/imports/api/voice-users';\nimport { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\nimport ejectUserFromVoice from './methods/ejectUserFromVoice';\n\nfunction voiceUser() {\n  if (!this.userId) {\n    return VoiceUsers.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(meetingId, String);\n  check(requesterUserId, String);\n  const onCloseConnection = Meteor.bindEnvironment(() => {\n    try {\n      // I used user because voiceUser is the function's name\n      const User = VoiceUsers.findOne({ meetingId, requesterUserId });\n      if (User) {\n        ejectUserFromVoice(requesterUserId);\n      }\n    } catch (e) {\n      Logger.error(`Exception while executing ejectUserFromVoice for ${requesterUserId}: ${e}`);\n    }\n  });\n\n  Logger.debug('Publishing Voice User', { meetingId, requesterUserId });\n\n  this._session.socket.on('close', _.debounce(onCloseConnection, 100));\n  return VoiceUsers.find({ meetingId });\n}\n\nfunction publish(...args) {\n  const boundVoiceUser = voiceUser.bind(this);\n  return boundVoiceUser(...args);\n}\n\nMeteor.publish('voiceUsers', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst VoiceUsers = new Mongo.Collection('voiceUsers');\n\nif (Meteor.isServer) {\n  // types of queries for the voice users:\n  // 1. intId\n  // 2. meetingId, intId\n\n  VoiceUsers._ensureIndex({ intId: 1 });\n  VoiceUsers._ensureIndex({ meetingId: 1, intId: 1 });\n}\n\nexport default VoiceUsers;\n","import { check } from 'meteor/check';\nimport modifyWhiteboardAccess from '../modifiers/modifyWhiteboardAccess';\n\nexport default function handleModifyWhiteboardAccess({ body }, meetingId) {\n  const { multiUser, whiteboardId } = body;\n\n  check(multiUser, Boolean);\n  check(whiteboardId, String);\n  check(meetingId, String);\n\n  return modifyWhiteboardAccess(meetingId, whiteboardId, multiUser);\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { Meteor } from 'meteor/meteor';\nimport { check } from 'meteor/check';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nexport default function changeWhiteboardAccess(multiUser, whiteboardId) {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n  const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n  const EVENT_NAME = 'ModifyWhiteboardAccessPubMsg';\n\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  check(multiUser, Boolean);\n  check(whiteboardId, String);\n\n  const payload = {\n    multiUser,\n    whiteboardId,\n  };\n\n  return RedisPubSub.publishUserMessage(CHANNEL, EVENT_NAME, meetingId, requesterUserId, payload);\n}\n","import Logger from '/imports/startup/server/logger';\nimport WhiteboardMultiUser from '/imports/api/whiteboard-multi-user';\n\nexport default function clearWhiteboardMultiUser(meetingId) {\n  if (meetingId) {\n    try {\n      const numberAffected = WhiteboardMultiUser.remove({ meetingId });\n\n      if (numberAffected) {\n        Logger.info(`Cleared WhiteboardMultiUser (${meetingId})`);\n      }\n    } catch (err) {\n      Logger.info(`Error clearing WhiteboardMultiUser (${meetingId}). ${err}`);\n    }\n  } else {\n    try {\n      const numberAffected = WhiteboardMultiUser.remove({});\n\n      if (numberAffected) {\n        Logger.info('Cleared WhiteboardMultiUser (all)');\n      }\n    } catch (err) {\n      Logger.info(`Error clearing WhiteboardMultiUser (all). ${err}`);\n    }\n  }\n}\n","import { check } from 'meteor/check';\nimport Logger from '/imports/startup/server/logger';\nimport WhiteboardMultiUser from '/imports/api/whiteboard-multi-user/';\n\nexport default function modifyWhiteboardAccess(meetingId, whiteboardId, multiUser) {\n  check(meetingId, String);\n  check(whiteboardId, String);\n  check(multiUser, Boolean);\n\n  const selector = {\n    meetingId,\n    whiteboardId,\n  };\n\n  const modifier = {\n    meetingId,\n    whiteboardId,\n    multiUser,\n  };\n\n  try {\n    const { insertedId } = WhiteboardMultiUser.upsert(selector, modifier);\n    if (insertedId) {\n      Logger.info(`Added multiUser flag=${multiUser} meetingId=${meetingId} whiteboardId=${whiteboardId}`);\n    } else {\n      Logger.info(`Upserted multiUser flag=${multiUser} meetingId=${meetingId} whiteboardId=${whiteboardId}`);\n    }\n  } catch (err) {\n    Logger.error(`Error while adding an entry to Multi-User collection: ${err}`);\n  }\n}\n","import RedisPubSub from '/imports/startup/server/redis';\nimport { processForHTML5ServerOnly } from '/imports/api/common/server/helpers';\nimport handleGetWhiteboardAccess from './handlers/modifyWhiteboardAccess';\n\nRedisPubSub.on('GetWhiteboardAccessRespMsg', processForHTML5ServerOnly(handleGetWhiteboardAccess));\nRedisPubSub.on('SyncGetWhiteboardAccessRespMsg', handleGetWhiteboardAccess);\nRedisPubSub.on('ModifyWhiteboardAccessEvtMsg', handleGetWhiteboardAccess);\n","import './eventHandlers';\nimport './methods';\nimport './publishers';\n","import { Meteor } from 'meteor/meteor';\nimport changeWhiteboardAccess from './methods/changeWhiteboardAccess';\n\nMeteor.methods({\n  changeWhiteboardAccess,\n});\n","import WhiteboardMultiUser from '/imports/api/whiteboard-multi-user/';\nimport { Meteor } from 'meteor/meteor';\nimport Logger from '/imports/startup/server/logger';\nimport { extractCredentials } from '/imports/api/common/server/helpers';\n\nfunction whiteboardMultiUser() {\n  if (!this.userId) {\n    return WhiteboardMultiUser.find({ meetingId: '' });\n  }\n  const { meetingId, requesterUserId } = extractCredentials(this.userId);\n\n  Logger.debug('Publishing whiteboard-multi-user', { meetingId, requesterUserId });\n\n  return WhiteboardMultiUser.find({ meetingId });\n}\n\n\nfunction publish(...args) {\n  const boundMultiUser = whiteboardMultiUser.bind(this);\n  return boundMultiUser(...args);\n}\n\nMeteor.publish('whiteboard-multi-user', publish);\n","import { Meteor } from 'meteor/meteor';\n\nconst WhiteboardMultiUser = new Mongo.Collection('whiteboard-multi-user');\n\nif (Meteor.isServer) {\n  // types of queries for the whiteboard-multi-user:\n  // 1. meetingId\n\n  WhiteboardMultiUser._ensureIndex({ meetingId: 1 });\n}\n\nexport default WhiteboardMultiUser;\n","import sha1 from 'crypto-js/sha1';\nimport Users from '/imports/api/users';\n\nconst MSG_DIRECT_TYPE = 'DIRECT';\nconst NODE_USER = 'nodeJSapp';\n\nexport const spokeTimeoutHandles = {};\nexport const clearSpokeTimeout = (meetingId, userId) => {\n  if (spokeTimeoutHandles[`${meetingId}-${userId}`]) {\n    Meteor.clearTimeout(spokeTimeoutHandles[`${meetingId}-${userId}`]);\n    delete spokeTimeoutHandles[`${meetingId}-${userId}`];\n  }\n};\n\nexport const indexOf = [].indexOf || function (item) {\n  for (let i = 0, l = this.length; i < l; i += 1) {\n    if (i in this && this[i] === item) {\n      return i;\n    }\n  }\n\n  return -1;\n};\n\nexport const processForHTML5ServerOnly = fn => (message, ...args) => {\n  const { envelope } = message;\n  const { routing } = envelope;\n  const { msgType, meetingId, userId } = routing;\n\n  const selector = {\n    userId,\n    meetingId,\n  };\n\n  const user = Users.findOne(selector);\n\n  const shouldSkip = user && msgType === MSG_DIRECT_TYPE && userId !== NODE_USER && user.clientType !== 'HTML5';\n  if (shouldSkip) return () => { };\n  return fn(message, ...args);\n};\n\nexport const hashSHA1 = (str) => sha1(str).toString();\n\nexport const extractCredentials = (credentials) => {\n  if (!credentials) return {};\n  const credentialsArray = credentials.split('--');\n  const meetingId = credentialsArray[0];\n  const requesterUserId = credentialsArray[1];\n  return { meetingId, requesterUserId };\n};\n","import { Meteor } from 'meteor/meteor';\nimport { WebAppInternals } from 'meteor/webapp';\nimport Langmap from 'langmap';\nimport fs from 'fs';\nimport path from 'path';\nimport heapdump from 'heapdump';\nimport Users from '/imports/api/users';\nimport './settings';\nimport { lookup as lookupUserAgent } from 'useragent';\nimport { check } from 'meteor/check';\nimport memwatch from 'memwatch-next';\nimport Logger from './logger';\nimport Redis from './redis';\nimport setMinBrowserVersions from './minBrowserVersion';\nimport userLeaving from '/imports/api/users/server/methods/userLeaving';\n\nconst AVAILABLE_LOCALES = fs.readdirSync('assets/app/locales');\n\nprocess.on('uncaughtException', (err) => {\n  Logger.error(`uncaughtException: ${err}`);\n  process.exit(1);\n});\n\nMeteor.startup(() => {\n  const APP_CONFIG = Meteor.settings.public.app;\n  const INTERVAL_IN_SETTINGS = (Meteor.settings.public.pingPong.clearUsersInSeconds) * 1000;\n  const INTERVAL_TIME = INTERVAL_IN_SETTINGS < 10000 ? 10000 : INTERVAL_IN_SETTINGS;\n  const env = Meteor.isDevelopment ? 'development' : 'production';\n  const CDN_URL = APP_CONFIG.cdn;\n\n  const { customHeartbeat } = APP_CONFIG;\n\n  if (customHeartbeat) {\n    Logger.warn('Custom heartbeat functions are enabled');\n    // https://github.com/sockjs/sockjs-node/blob/1ef08901f045aae7b4df0f91ef598d7a11e82897/lib/transport/websocket.js#L74-L82\n    const newHeartbeat = function heartbeat() {\n      const currentTime = new Date().getTime();\n\n      // Skipping heartbeat, because websocket is sending data\n      if (currentTime - this.ws.lastSentFrameTimestamp < 10000) {\n        try {\n          Logger.info('Skipping heartbeat, because websocket is sending data', {\n            currentTime,\n            lastSentFrameTimestamp: this.ws.lastSentFrameTimestamp,\n            userId: this.session.connection._meteorSession.userId,\n          });\n          return;\n        } catch (err) {\n          Logger.error(`Skipping heartbeat error: ${err}`);\n        }\n      }\n\n      const supportsHeartbeats = this.ws.ping(null, () => clearTimeout(this.hto_ref));\n      if (supportsHeartbeats) {\n        this.hto_ref = setTimeout(() => {\n          try {\n            Logger.info('Heartbeat timeout', { userId: this.session.connection._meteorSession.userId, sentAt: currentTime, now: new Date().getTime() });\n          } catch (err) {\n            Logger.error(`Heartbeat timeout error: ${err}`);\n          }\n        }, Meteor.server.options.heartbeatTimeout);\n      } else {\n        Logger.error('Unexpected error supportsHeartbeats=false');\n      }\n    };\n\n    // https://github.com/davhani/hagty/blob/6a5c78e9ae5a5e4ade03e747fb4cc8ea2df4be0c/faye-websocket/lib/faye/websocket/api.js#L84-L88\n    const newSend = function send(data) {\n      try {\n        this.lastSentFrameTimestamp = new Date().getTime();\n\n        if (this.meteorHeartbeat) {\n          // Call https://github.com/meteor/meteor/blob/1e7e56eec8414093cd0c1c70750b894069fc972a/packages/ddp-common/heartbeat.js#L80-L88\n          this.meteorHeartbeat._seenPacket = true;\n          if (this.meteorHeartbeat._heartbeatTimeoutHandle) {\n            this.meteorHeartbeat._clearHeartbeatTimeoutTimer();\n          }\n        }\n\n        if (this.readyState > 1/* API.OPEN = 1 */) return false;\n        if (!(data instanceof Buffer)) data = String(data);\n        return this._driver.messages.write(data);\n      } catch (err) {\n        console.error('Error on send data', err);\n        return false;\n      }\n    };\n\n    Meteor.setInterval(() => {\n      for (const session of Meteor.server.sessions.values()) {\n        const { socket } = session;\n        const recv = socket._session.recv;\n\n        if (session.bbbFixApplied || !recv || !recv.ws) {\n          continue;\n        }\n\n        recv.ws.meteorHeartbeat = session.heartbeat;\n        recv.__proto__.heartbeat = newHeartbeat;\n        recv.ws.__proto__.send = newSend;\n        session.bbbFixApplied = true;\n      }\n    }, 5000);\n  }\n\n  const memoryMonitoringSettings = Meteor.settings.private.memoryMonitoring;\n  let heapDumpMbThreshold = memoryMonitoringSettings.heapdump.thresholdMb;\n  const { heapdumpFolderPath } = memoryMonitoringSettings.heapdump;\n\n  if (memoryMonitoringSettings.stat.enabled) {\n    memwatch.on('stats', (stats) => {\n      let heapDumpTriggered = false;\n\n      if (memoryMonitoringSettings.heapdump.enabled) {\n        heapDumpTriggered = (stats.current_base / 1048576) > heapDumpMbThreshold;\n      }\n      Logger.info('memwatch stats', { ...stats });\n\n      if (heapDumpTriggered) {\n        heapdump.writeSnapshot(path.join(heapdumpFolderPath, `heapdump-stats-${Date.now()}.heapsnapshot`));\n        heapDumpMbThreshold += memoryMonitoringSettings.heapdump.thresholdMb;\n      }\n    });\n  }\n\n  // if (memoryMonitoringSettings.leak.enabled) {\n  //   memwatch.on('leak', (info) => {\n  //     Logger.info('memwatch leak', info);\n  //   });\n  // }\n\n  // if (memoryMonitoringSettings.heapdump.enabled) {\n  //   const { heapdumpFolderPath, heapdumpIntervalMs } = memoryMonitoringSettings.heapdump;\n  //   Meteor.setInterval(() => {\n  //     heapdump.writeSnapshot(path.join(heapdumpFolderPath, `${new Date().toISOString()}.heapsnapshot`));\n  //     Logger.info('Heapsnapshot file successfully written');\n  //   }, heapdumpIntervalMs);\n  // }\n\n  if (CDN_URL.trim()) {\n    // Add CDN\n    BrowserPolicy.content.disallowEval();\n    BrowserPolicy.content.allowInlineScripts();\n    BrowserPolicy.content.allowInlineStyles();\n    BrowserPolicy.content.allowImageDataUrl(CDN_URL);\n    BrowserPolicy.content.allowFontDataUrl(CDN_URL);\n    BrowserPolicy.content.allowOriginForAll(CDN_URL);\n    WebAppInternals.setBundledJsCssPrefix(CDN_URL + APP_CONFIG.basename);\n\n    const fontRegExp = /\\.(eot|ttf|otf|woff|woff2)$/;\n\n    WebApp.rawConnectHandlers.use('/', (req, res, next) => {\n      if (fontRegExp.test(req._parsedUrl.pathname)) {\n        res.setHeader('Access-Control-Allow-Origin', '*');\n        res.setHeader('Vary', 'Origin');\n        res.setHeader('Pragma', 'public');\n        res.setHeader('Cache-Control', '\"public\"');\n      }\n      return next();\n    });\n  }\n\n  setMinBrowserVersions();\n\n  Meteor.setInterval(() => {\n    const currentTime = Date.now();\n    Logger.info('Checking for inactive users');\n    const users = Users.find({\n      connectionStatus: 'online',\n      clientType: 'HTML5',\n      lastPing: {\n        $lt: (currentTime - INTERVAL_TIME), // get user who has not pinged in the last 10 seconds\n      },\n      loginTime: {\n        $lt: (currentTime - INTERVAL_TIME),\n      },\n    }).fetch();\n    if (!users.length) return Logger.info('No inactive users');\n    Logger.info('Removing inactive users');\n    users.forEach((user) => {\n      Logger.info(`Detected inactive user, userId:${user.userId}, meetingId:${user.meetingId}`);\n      return userLeaving(user.meetingId, user.userId, user.connectionId);\n    });\n    return Logger.info('All inactive users have been removed');\n  }, INTERVAL_TIME);\n\n  Logger.warn(`SERVER STARTED.\\nENV=${env},\\nnodejs version=${process.version}\\nCDN=${CDN_URL}\\n`, APP_CONFIG);\n});\n\nWebApp.connectHandlers.use('/check', (req, res) => {\n  const payload = { html5clientStatus: 'running' };\n\n  res.setHeader('Content-Type', 'application/json');\n  res.writeHead(200);\n  res.end(JSON.stringify(payload));\n});\n\nWebApp.connectHandlers.use('/locale', (req, res) => {\n  const APP_CONFIG = Meteor.settings.public.app;\n  const fallback = APP_CONFIG.defaultSettings.application.fallbackLocale;\n  const override = APP_CONFIG.defaultSettings.application.overrideLocale;\n  const browserLocale = override && req.query.init === 'true'\n    ? override.split(/[-_]/g) : req.query.locale.split(/[-_]/g);\n\n  const localeList = [fallback];\n\n  const usableLocales = AVAILABLE_LOCALES\n    .map(file => file.replace('.json', ''))\n    .reduce((locales, locale) => (locale.match(browserLocale[0])\n      ? [...locales, locale]\n      : locales), []);\n\n  const regionDefault = usableLocales.find(locale => browserLocale[0] === locale);\n\n  if (regionDefault) localeList.push(regionDefault);\n  if (!regionDefault && usableLocales.length) localeList.push(usableLocales[0]);\n\n  let normalizedLocale;\n  let messages = {};\n\n  if (browserLocale.length > 1) {\n    normalizedLocale = `${browserLocale[0]}_${browserLocale[1].toUpperCase()}`;\n    localeList.push(normalizedLocale);\n  }\n\n  localeList.forEach((locale) => {\n    try {\n      const data = Assets.getText(`locales/${locale}.json`);\n      messages = Object.assign(messages, JSON.parse(data));\n      normalizedLocale = locale;\n    } catch (e) {\n      Logger.warn(`'Could not process locale ${locale}:${e}`);\n      // Getting here means the locale is not available in the current locale files.\n    }\n  });\n\n  res.setHeader('Content-Type', 'application/json');\n  res.end(JSON.stringify({ normalizedLocale, messages }));\n});\n\nWebApp.connectHandlers.use('/locales', (req, res) => {\n  let locales = [];\n  try {\n    locales = AVAILABLE_LOCALES\n      .map(file => file.replace('.json', ''))\n      .map(file => file.replace('_', '-'))\n      .map(locale => ({\n        locale,\n        name: Langmap[locale].nativeName,\n      }));\n  } catch (e) {\n    Logger.warn(`'Could not process locales error: ${e}`);\n  }\n\n  res.setHeader('Content-Type', 'application/json');\n  res.writeHead(200);\n  res.end(JSON.stringify(locales));\n});\n\nWebApp.connectHandlers.use('/feedback', (req, res) => {\n  req.on('data', Meteor.bindEnvironment((data) => {\n    const body = JSON.parse(data);\n    const {\n      meetingId,\n      userId,\n      authToken,\n      userName: reqUserName,\n      comment,\n      rating,\n    } = body;\n\n    check(meetingId, String);\n    check(userId, String);\n    check(authToken, String);\n    check(reqUserName, String);\n    check(comment, String);\n    check(rating, Number);\n\n    const user = Users.findOne({\n      meetingId,\n      userId,\n      connectionStatus: 'offline',\n      authToken,\n    });\n\n    if (!user) {\n      Logger.warn('Couldn\\'t find user for feedback');\n    }\n\n    res.setHeader('Content-Type', 'application/json');\n    res.writeHead(200);\n    res.end(JSON.stringify({ status: 'ok' }));\n\n    body.userName = user ? user.name : `[unconfirmed] ${reqUserName}`;\n\n    const feedback = {\n      ...body,\n    };\n    Logger.info('FEEDBACK LOG:', feedback);\n  }));\n});\n\nWebApp.connectHandlers.use('/useragent', (req, res) => {\n  const userAgent = req.headers['user-agent'];\n  let response = 'No user agent found in header';\n  if (userAgent) {\n    response = lookupUserAgent(userAgent).toString();\n  }\n\n  Logger.info(`The requesting user agent is ${response}`);\n\n  // res.setHeader('Content-Type', 'application/json');\n  res.writeHead(200);\n  res.end(response);\n});\n\nexport const eventEmitter = Redis.emitter;\n\nexport const redisPubSub = Redis;\n","import { Meteor } from 'meteor/meteor';\nimport { createLogger, format, transports } from 'winston';\n\nconst LOG_CONFIG = Meteor.settings.private.serverLog || {};\nconst { level } = LOG_CONFIG;\n\nconst Logger = createLogger({\n  level,\n  format: format.combine(\n    format.colorize({ level: true }),\n    format.splat(),\n    format.simple(),\n  ),\n  transports: [\n    // console logging\n    new transports.Console({\n      prettyPrint: false,\n      humanReadableUnhandledException: true,\n      colorize: true,\n      handleExceptions: true,\n      level,\n    }),\n  ],\n});\n\nexport default Logger;\n\nexport const logger = Logger;\n","/* eslint-disable no-prototype-builtins */\n\nimport fs from 'fs';\nimport path from 'path';\nimport { Meteor } from 'meteor/meteor';\nimport Logger from './logger';\n\nconst {\n  metricsDumpIntervalMs,\n  metricsFolderPath,\n  removeMeetingOnEnd,\n} = Meteor.settings.private.redis.metrics;\n\nclass Metrics {\n  constructor() {\n    this.metrics = {};\n  }\n\n  addEvent(meetingId, eventName, messageLength) {\n    if (!this.metrics.hasOwnProperty(meetingId)) {\n      this.metrics[meetingId] = {\n        currentlyInQueue: {},\n        wasInQueue: {},\n      };\n    }\n\n    const { currentlyInQueue } = this.metrics[meetingId];\n\n    if (!currentlyInQueue.hasOwnProperty(eventName)) {\n      currentlyInQueue[eventName] = {\n        count: 1,\n        payloadSize: messageLength,\n      };\n    } else {\n      currentlyInQueue[eventName].count += 1;\n      currentlyInQueue[eventName].payloadSize += messageLength;\n    }\n  }\n\n  processEvent(meetingId, eventName, size, processingStartTimestamp) {\n    const currentProcessingTimestamp = Date.now();\n    const processTime = currentProcessingTimestamp - processingStartTimestamp;\n\n    if (!this.metrics[meetingId].wasInQueue.hasOwnProperty(eventName)) {\n      this.metrics[meetingId].wasInQueue[eventName] = {\n        count: 1,\n        payloadSize: {\n          min: size,\n          max: size,\n          last: size,\n          total: size,\n          avg: size,\n        },\n        processingTime: {\n          min: processTime,\n          max: processTime,\n          last: processTime,\n          total: processTime,\n          avg: processTime,\n        },\n      };\n      this.metrics[meetingId].currentlyInQueue[eventName].count -= 1;\n\n      if (!this.metrics[meetingId].currentlyInQueue[eventName].count) {\n        delete this.metrics[meetingId].currentlyInQueue[eventName];\n      }\n    } else {\n      const { currentlyInQueue, wasInQueue } = this.metrics[meetingId];\n\n      currentlyInQueue[eventName].count -= 1;\n\n      if (!currentlyInQueue[eventName].count) {\n        delete currentlyInQueue[eventName];\n      }\n\n      const { payloadSize, processingTime } = wasInQueue[eventName];\n\n      wasInQueue[eventName].count += 1;\n\n      payloadSize.last = size;\n      payloadSize.total += size;\n\n      if (payloadSize.min > size) payloadSize.min = size;\n      if (payloadSize.max < size) payloadSize.max = size;\n\n      payloadSize.avg = payloadSize.total / wasInQueue[eventName].count;\n\n      if (processingTime.min > processTime) processingTime.min = processTime;\n      if (processingTime.max < processTime) processingTime.max = processTime;\n\n      processingTime.last = processTime;\n      processingTime.total += processTime;\n      processingTime.avg = processingTime.total / wasInQueue[eventName].count;\n    }\n  }\n\n  setAnnotationQueueLength(meetingId, size) {\n    this.metrics[meetingId].annotationQueueLength = size;\n  }\n\n  startDumpFile() {\n    Meteor.setInterval(() => {\n      try {\n        const fileDate = new Date();\n        const fullYear = fileDate.getFullYear();\n        const month = (fileDate.getMonth() + 1).toString().padStart(2, '0');\n        const day = fileDate.getDate().toString().padStart(2, '0');\n        const hour = fileDate.getHours().toString().padStart(2, '0');\n        const minutes = fileDate.getMinutes().toString().padStart(2, '0');\n        const seconds = fileDate.getSeconds().toString().padStart(2, '0');\n\n        const folderName = `${fullYear}${month}${day}_${hour}`;\n        const fileName = `${folderName}${minutes}${seconds}_metrics.json`;\n\n        const folderPath = path.join(metricsFolderPath, folderName);\n        const fullFilePath = path.join(folderPath, fileName);\n\n        if (!fs.existsSync(folderPath)) {\n          Logger.debug(`Creating folder: ${folderPath}`);\n          fs.mkdirSync(folderPath);\n        }\n\n        fs.writeFileSync(fullFilePath, JSON.stringify(this.metrics));\n\n        Logger.info('Metric file successfully written');\n      } catch (err) {\n        Logger.error('Error on writing metrics to disk.', err);\n      }\n    }, metricsDumpIntervalMs);\n  }\n\n  removeMeeting(meetingId) {\n    if (removeMeetingOnEnd) {\n      Logger.info(`Removing meeting ${meetingId} from metrics`);\n      delete this.metrics[meetingId];\n    } else {\n      Logger.info(`Skipping remove of meeting ${meetingId} from metrics`);\n    }\n  }\n}\n\nconst metricsSingleton = new Metrics();\n\nexport default metricsSingleton;\n","import { Meteor } from 'meteor/meteor';\nimport { setMinimumBrowserVersions } from 'meteor/modern-browsers';\n\nconst setMinBrowserVersions = () => {\n  const { minBrowserVersions } = Meteor.settings.private;\n\n  const versions = {};\n\n  minBrowserVersions.forEach((elem) => {\n    let { version } = elem;\n    if (version === 'Infinity') version = Infinity;\n\n    versions[elem.browser] = version;\n  });\n\n  setMinimumBrowserVersions(versions, 'bbb-min');\n};\n\nexport default setMinBrowserVersions;\n","/* global PowerQueue */\nimport Redis from 'redis';\nimport { Meteor } from 'meteor/meteor';\nimport { EventEmitter2 } from 'eventemitter2';\nimport { check } from 'meteor/check';\nimport fs from 'fs';\nimport Logger from './logger';\nimport Metrics from './metrics';\n\n// Fake meetingId used for messages that have no meetingId\nconst NO_MEETING_ID = '_';\n\nconst { queueMetrics } = Meteor.settings.private.redis.metrics;\n\nconst makeEnvelope = (channel, eventName, header, body, routing) => {\n  const envelope = {\n    envelope: {\n      name: eventName,\n      routing: routing || {\n        sender: 'bbb-apps-akka',\n        // sender: 'html5-server', // TODO\n      },\n      timestamp: Date.now(),\n    },\n    core: {\n      header,\n      body,\n    },\n  };\n\n  return JSON.stringify(envelope);\n};\n\nclass MeetingMessageQueue {\n  constructor(eventEmitter, asyncMessages = [], redisDebugEnabled = false) {\n    this.asyncMessages = asyncMessages;\n    this.emitter = eventEmitter;\n    this.queue = new PowerQueue();\n    this.redisDebugEnabled = redisDebugEnabled;\n\n    this.handleTask = this.handleTask.bind(this);\n    this.queue.taskHandler = this.handleTask;\n  }\n\n  handleTask(data, next) {\n    const { channel } = data;\n    const { envelope } = data.parsedMessage;\n    const { header } = data.parsedMessage.core;\n    const { body } = data.parsedMessage.core;\n    const { meetingId } = header;\n    const eventName = header.name;\n    const isAsync = this.asyncMessages.includes(channel)\n      || this.asyncMessages.includes(eventName);\n\n    const beginHandleTimestamp = Date.now();\n    let called = false;\n\n    check(eventName, String);\n    check(body, Object);\n\n    const callNext = () => {\n      if (called) return;\n      if (this.redisDebugEnabled) {\n        Logger.debug(`Redis: ${eventName} completed ${isAsync ? 'async' : 'sync'}`);\n      }\n      called = true;\n\n      if (queueMetrics) {\n        const queueId = meetingId || NO_MEETING_ID;\n        const dataLength = JSON.stringify(data).length;\n\n        Metrics.processEvent(queueId, eventName, dataLength, beginHandleTimestamp);\n      }\n\n      const queueLength = this.queue.length();\n      if (queueLength > 100) {\n        Logger.warn(`Redis: MeetingMessageQueue for meetingId=${meetingId} has queue size=${queueLength} `);\n      }\n      next();\n    };\n\n    const onError = (reason) => {\n      Logger.error(`${eventName}: ${reason.stack ? reason.stack : reason}`);\n      callNext();\n    };\n\n    try {\n      if (this.redisDebugEnabled) {\n        Logger.debug(`Redis: ${JSON.stringify(data.parsedMessage.core)} emitted`);\n      }\n\n      if (isAsync) {\n        callNext();\n      }\n\n      this.emitter\n        .emitAsync(eventName, { envelope, header, body }, meetingId)\n        .then(callNext)\n        .catch(onError);\n    } catch (reason) {\n      onError(reason);\n    }\n  }\n\n  add(...args) {\n    return this.queue.add(...args);\n  }\n}\n\nclass RedisPubSub {\n  static handlePublishError(err) {\n    if (err) {\n      Logger.error(err);\n    }\n  }\n\n  constructor(config = {}) {\n    this.config = config;\n\n    this.didSendRequestEvent = false;\n    const host = process.env.REDIS_HOST || Meteor.settings.private.redis.host;\n    const redisConf = Meteor.settings.private.redis;\n    const { password, port } = redisConf;\n\n    if (password) {\n      this.pub = Redis.createClient({ host, port, password });\n      this.sub = Redis.createClient({ host, port, password });\n      this.pub.auth(password);\n      this.sub.auth(password);\n    } else {\n      this.pub = Redis.createClient({ host, port });\n      this.sub = Redis.createClient({ host, port });\n    }\n\n    if (queueMetrics) {\n      Metrics.startDumpFile();\n    }\n\n    this.emitter = new EventEmitter2();\n    this.mettingsQueues = {};\n\n    this.handleSubscribe = this.handleSubscribe.bind(this);\n    this.handleMessage = this.handleMessage.bind(this);\n  }\n\n  init() {\n    this.sub.on('psubscribe', Meteor.bindEnvironment(this.handleSubscribe));\n    this.sub.on('pmessage', Meteor.bindEnvironment(this.handleMessage));\n\n    const channelsToSubscribe = this.config.subscribeTo;\n\n    channelsToSubscribe.forEach((channel) => {\n      this.sub.psubscribe(channel);\n    });\n\n    if (this.redisDebugEnabled) {\n      Logger.debug(`Redis: Subscribed to '${channelsToSubscribe}'`);\n    }\n  }\n\n  updateConfig(config) {\n    this.config = Object.assign({}, this.config, config);\n    this.redisDebugEnabled = this.config.debug;\n  }\n\n\n  // TODO: Move this out of this class, maybe pass as a callback to init?\n  handleSubscribe() {\n    if (this.didSendRequestEvent) return;\n\n    // populate collections with pre-existing data\n    const REDIS_CONFIG = Meteor.settings.private.redis;\n    const CHANNEL = REDIS_CONFIG.channels.toAkkaApps;\n    const EVENT_NAME = 'GetAllMeetingsReqMsg';\n\n    const body = {\n      requesterId: 'nodeJSapp',\n    };\n\n    this.publishSystemMessage(CHANNEL, EVENT_NAME, body);\n    this.didSendRequestEvent = true;\n  }\n\n  handleMessage(pattern, channel, message) {\n    const parsedMessage = JSON.parse(message);\n    const { name: eventName, meetingId } = parsedMessage.core.header;\n    const { ignored: ignoredMessages, async } = this.config;\n\n    if (ignoredMessages.includes(channel)\n      || ignoredMessages.includes(eventName)) {\n      if (eventName === 'CheckAlivePongSysMsg') {\n        return;\n      }\n      if (this.redisDebugEnabled) {\n        Logger.debug(`Redis: ${eventName} skipped`);\n      }\n      return;\n    }\n\n    const queueId = meetingId || NO_MEETING_ID;\n\n    if (queueMetrics) {\n      Metrics.addEvent(queueId, eventName, message.length);\n    }\n\n    if (!(queueId in this.mettingsQueues)) {\n      this.mettingsQueues[meetingId] = new MeetingMessageQueue(this.emitter, async, this.redisDebugEnabled);\n    }\n\n    this.mettingsQueues[meetingId].add({\n      pattern,\n      channel,\n      eventName,\n      parsedMessage,\n    });\n  }\n\n  destroyMeetingQueue(id) {\n    delete this.mettingsQueues[id];\n  }\n\n  on(...args) {\n    return this.emitter.on(...args);\n  }\n\n  publishVoiceMessage(channel, eventName, voiceConf, payload) {\n    const header = {\n      name: eventName,\n      voiceConf,\n    };\n\n    const envelope = makeEnvelope(channel, eventName, header, payload);\n\n    return this.pub.publish(channel, envelope, RedisPubSub.handlePublishError);\n  }\n\n  publishSystemMessage(channel, eventName, payload) {\n    const header = {\n      name: eventName,\n    };\n\n    const envelope = makeEnvelope(channel, eventName, header, payload);\n\n    return this.pub.publish(channel, envelope, RedisPubSub.handlePublishError);\n  }\n\n  publishMeetingMessage(channel, eventName, meetingId, payload) {\n    const header = {\n      name: eventName,\n      meetingId,\n    };\n\n    const envelope = makeEnvelope(channel, eventName, header, payload);\n\n    return this.pub.publish(channel, envelope, RedisPubSub.handlePublishError);\n  }\n\n  publishUserMessage(channel, eventName, meetingId, userId, payload) {\n    const header = {\n      name: eventName,\n      meetingId,\n      userId,\n    };\n\n    if (!meetingId || !userId) {\n      Logger.warn(`Publishing ${eventName} with potentially missing data userId=${userId} meetingId=${meetingId}`);\n    }\n    const envelope = makeEnvelope(channel, eventName, header, payload, { meetingId, userId });\n\n    return this.pub.publish(channel, envelope, RedisPubSub.handlePublishError);\n  }\n}\n\nconst RedisPubSubSingleton = new RedisPubSub();\n\nMeteor.startup(() => {\n  const REDIS_CONFIG = Meteor.settings.private.redis;\n\n  RedisPubSubSingleton.updateConfig(REDIS_CONFIG);\n  RedisPubSubSingleton.init();\n});\n\nexport default RedisPubSubSingleton;\n","import { Meteor } from 'meteor/meteor';\nimport fs from 'fs';\nimport YAML from 'yaml';\n\nconst YAML_FILE_PATH = 'assets/app/config/settings.yml';\n\ntry {\n  if (fs.existsSync(YAML_FILE_PATH)) {\n    const SETTINGS = YAML.parse(fs.readFileSync(YAML_FILE_PATH, 'utf-8'));\n\n    Meteor.settings = SETTINGS;\n    __meteor_runtime_config__.PUBLIC_SETTINGS = SETTINGS.public;\n  } else {\n    throw new Error('File doesn\\'t exists');\n  }\n} catch (error) {\n  console.error('Error on load configuration file.', error);\n}\n","// Used in Flash and HTML to show a legitimate break in the line\nconst BREAK_LINE = '<br/>';\n\n// Soft return in HTML to signify a broken line without\n// displaying the escaped '<br/>' line break text\nconst CARRIAGE_RETURN = '\\r';\n\n// Handle this the same as carriage return, in case text copied has this\nconst NEW_LINE = '\\n';\n\nexport { BREAK_LINE, CARRIAGE_RETURN, NEW_LINE };\n","export const XLS = 'application/vnd.ms-excel';\nexport const XLSX = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';\nexport const DOC = 'application/msword';\nexport const DOCX = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document';\nexport const PPT = 'application/vnd.ms-powerpoint';\nexport const PPTX = 'application/vnd.openxmlformats-officedocument.presentationml.presentation';\nexport const ODT = 'application/vnd.oasis.opendocument.text';\nexport const RTF = 'application/rtf';\nexport const TXT = 'text/plain';\nexport const ODS = 'application/vnd.oasis.opendocument.spreadsheet';\nexport const ODP = 'application/vnd.oasis.opendocument.presentation';\nexport const PDF = 'application/pdf';\nexport const JPEG = 'image/jpeg';\nexport const PNG = 'image/png';\nexport const SVG = 'image/svg+xml';\n\nexport const UPLOAD_SUPORTED = [\n  XLS,\n  XLSX,\n  DOC,\n  DOCX,\n  PPT,\n  PPTX,\n  ODT,\n  RTF,\n  TXT,\n  ODS,\n  ODP,\n  PDF,\n  JPEG,\n  PNG,\n];\n","//\n// Regular Expression for URL validation\n//\n// Author: Diego Perini\n// Updated: 2010/12/05\n// License: MIT\n//\n// Copyright (c) 2010-2013 Diego Perini (http://www.iport.it)\n//\n// Permission is hereby granted, free of charge, to any person\n// obtaining a copy of this software and associated documentation\n// files (the \"Software\"), to deal in the Software without\n// restriction, including without limitation the rights to use,\n// copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the\n// Software is furnished to do so, subject to the following\n// conditions:\n//\n// The above copyright notice and this permission notice shall be\n// included in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n// HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n// WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n// OTHER DEALINGS IN THE SOFTWARE.\n//\n// the regular expression composed & commented\n// could be easily tweaked for RFC compliance,\n// it was expressly modified to fit & satisfy\n// these test for an URL shortener:\n//\n//   http://mathiasbynens.be/demo/url-regex\n//\n// Notes on possible differences from a standard/generic validation:\n//\n// - utf-8 char class take in consideration the full Unicode range\n// - TLDs have been made mandatory so single names like \"localhost\" fails\n// - protocols have been restricted to ftp, http and https only as requested\n//\n// Changes:\n//\n// - IP address dotted notation validation, range: 1.0.0.0 - 223.255.255.255\n//   first and last IP address of each class is considered invalid\n//   (since they are broadcast/network addresses)\n//\n// - Added exclusion of private, reserved and/or local networks ranges\n//\n// - Made starting path slash optional (http://example.com?foo=bar)\n//\n// - Allow a dot (.) at the end of hostnames (http://example.com.)\n//\n// Compressed one-line versions:\n//\n// Javascript version (merge into one line)\n//\n// /^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})\n// (?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})\n// (?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}\n// (?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)\n// (?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)\n// (?::\\d{2,5})?(?:[/?#]\\S*)?$/i\n//\n// PHP version (merge into one line)\n//\n// _^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)\n// (?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])\n// (?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5]))\n// {2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\x{00a1}-\\x{ffff}0-9]-*)\n// *[a-z\\x{00a1}-\\x{ffff}0-9]+)(?:\\.(?:[a-z\\x{00a1}-\\x{ffff}0-9]-*)*[a-z\\x{00a1}-\\x{ffff}0-9]+)\n// *(?:\\.(?:[a-z\\x{00a1}-\\x{ffff}]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$_iuS\n//\n\nexport default new RegExp(\n\n  // protocol identifier\n  '(?:(?:https?|ftp)://)' +\n\n  // user:pass authentication\n  '(?:\\\\S+(?::\\\\S*)?@)?' +\n  '(?:' +\n\n    // IP address exclusion\n    // private & local networks\n    '(?!(?:10|127)(?:\\\\.\\\\d{1,3}){3})' +\n    '(?!(?:169\\\\.254|192\\\\.168)(?:\\\\.\\\\d{1,3}){2})' +\n    '(?!172\\\\.(?:1[6-9]|2\\\\d|3[0-1])(?:\\\\.\\\\d{1,3}){2})' +\n\n    // IP address dotted notation octets\n    // excludes loopback network 0.0.0.0\n    // excludes reserved space >= 224.0.0.0\n    // excludes network & broacast addresses\n    // (first & last IP address of each class)\n    '(?:[1-9]\\\\d?|1\\\\d\\\\d|2[01]\\\\d|22[0-3])' +\n    '(?:\\\\.(?:1?\\\\d{1,2}|2[0-4]\\\\d|25[0-5])){2}' +\n    '(?:\\\\.(?:[1-9]\\\\d?|1\\\\d\\\\d|2[0-4]\\\\d|25[0-4]))' +\n  '|' +\n\n    // host name\n    '(?:(?:[a-z\\\\u00a1-\\\\uffff0-9]-*)*[a-z\\\\u00a1-\\\\uffff0-9]+)' +\n\n    // domain name\n    '(?:\\\\.(?:[a-z\\\\u00a1-\\\\uffff0-9]-*)*[a-z\\\\u00a1-\\\\uffff0-9]+)*' +\n\n    // TLD identifier\n    '(?:\\\\.(?:[a-z\\\\u00a1-\\\\uffff]{2,}))' +\n\n    // TLD may end with dot\n    '\\\\.?' +\n  ')' +\n\n  // port number\n  '(?::\\\\d{2,5})?' +\n\n  // resource path\n  '(?:[/?#]\\\\S*)?', 'img',\n);\n","import '/imports/startup/server';\n\n// 2x\nimport '/imports/api/meetings/server';\nimport '/imports/api/users/server';\nimport '/imports/api/annotations/server';\nimport '/imports/api/cursor/server';\nimport '/imports/api/polls/server';\nimport '/imports/api/captions/server';\nimport '/imports/api/presentations/server';\nimport '/imports/api/presentation-pods/server';\nimport '/imports/api/presentation-upload-token/server';\nimport '/imports/api/slides/server';\nimport '/imports/api/breakouts/server';\nimport '/imports/api/group-chat/server';\nimport '/imports/api/group-chat-msg/server';\nimport '/imports/api/screenshare/server';\nimport '/imports/api/users-settings/server';\nimport '/imports/api/voice-users/server';\nimport '/imports/api/whiteboard-multi-user/server';\nimport '/imports/api/video-streams/server';\nimport '/imports/api/network-information/server';\nimport '/imports/api/users-infos/server';\nimport '/imports/api/note/server';\nimport '/imports/api/external-videos/server';\nimport '/imports/api/guest-users/server';\nimport '/imports/api/ping-pong/server';\nimport '/imports/api/local-settings/server';\nimport '/imports/api/voice-call-states/server';\n\n// Commons\nimport '/imports/api/log-client/server';\nimport '/imports/api/common/server/helpers';\nimport '/imports/startup/server/logger';\n\n// Needed for Atmosphere package RocketChat/meteor-streamer\n// It is out of date and was written when Meteor contained lodash\n// package. However, we now import lodash as an npm package\n// in order to control versions, update flexibly, etc..\n// Setting the global._ to utilize the npm lodash package is an interim fix\n// and its introduction was inspired by\n// https://github.com/RocketChat/meteor-streamer/issues/40#issuecomment-497627893\nimport _ from 'lodash';\n\nglobal._ = _;\n"]}